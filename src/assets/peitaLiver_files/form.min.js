"use strict";!function(){function e(e){try{var o='.personalization [persona-color-radio][persona-sku="'+e+'"]:checked',n=document.querySelector(o),r={};return n?(r.code=n.getAttribute("persona-color-code"),r.hexa=n.getAttribute("persona-color-hexa"),r.name=n.getAttribute("persona-color-name"),r):null}catch(t){return console.error("personalization.form.getPersonaObject",t),null}}function o(o){var n={sku:null,value:null};try{if(!o)return n;n.sku=o.getAttribute("persona-sku")||null,n.value="string"==typeof o.value?o.value:null;var r=e(n.sku);return r&&(n.color=r),n}catch(t){return console.error("personalization.form.getPersonaObject",t),n}}function n(){try{for(var e=document.querySelectorAll(".personalization [persona-input]"),n=e.length,r=[];n--;)c(e[n])&&r.push(o(e[n]));return r}catch(t){return console.error("personalization.form.getPersonaList",t),[]}}function r(e){var o=[];try{y&&(o=n())}catch(r){console.error("personalization.form.getPersonaValues",r)}finally{e(o,!0)}}function t(){try{var e={},o=document.forms[h];return o&&(e.name=o.querySelector("[data-personalization-name]")||null,e.number=o.querySelector("[data-personalization-number]")||null,e.color=o.querySelector("[radio-input]:checked")||null,e.text=o.querySelector("[data-personalization-text]")||null),e}catch(n){return console.error("personalization.form.getInputs",n),{}}}function a(){try{var e=t(),o=e.name,n=e.number,r=e.color,a=e.text;S.name=o&&o.value?o.value:S.name,S.number=n&&n.value?n.value:S.number,S.text=a&&a.value?a.value:S.text,S.color=r||S.color,S.status=y}catch(u){console.error("personalization.form.savePersonaState",u)}}function u(){try{var e=t(),o=e.name,n=e.number,r=e.text;r&&S.text&&(r.value=S.text),o&&S.name&&(o.value=S.name),n&&S.number&&(n.value=S.number),window.freedom.nsPubSub.pub("personalization.form.set.inputs",S),window.freedom.nsPubSub.pub("personalization.form.set.status",S.status)}catch(a){console.error("personalization.form.setPersonaState",a)}}function i(){try{var e=document.querySelector('#customization-name[name="cname"]'),o=document.querySelector('#customization-number[name="cnumber"]'),n=document.querySelector('#customization-text[name="ctext"]'),r=document.querySelector('[name="persona-color"]'),t=!!document.querySelector('[name="persona-color"]:checked');return{name:{name:"cname",status:c(e),active:e},number:{name:"cnumber",status:c(o),active:o},text:{name:"ctext",status:c(n),active:n},color:{name:"persona-color",status:t,active:r}}}catch(a){return console.error("personalization.getFormConfig"),{}}}function l(){try{window.freedom.nsPubSub.pub("personalization.form.toggleStatus",!1);var e=document.querySelectorAll('.personalization input[type="text"]'),o=document.querySelectorAll('.personalization input[type="radio"]');if(e)for(var n=e.length;n--;)e[n].addEventListener("input",function(){window.freedom.nsPubSub.pub("personalization.form.validate.changed",s())});if(o)for(var r=o.length;r--;)o[r].addEventListener("change",function(){window.freedom.nsPubSub.pub("personalization.form.validate.changed",s())})}catch(t){console.error("personalization.form.initObserveInputs",t)}}function s(){try{var e=i();return!(!(e.name.status||e.number.status||e.text.status)||e.color.active&&!e.color.status)}catch(o){return console.error("personalization.form.getFormValidate",o),!0}}function c(e){try{if(!e)return!1;var o=e.value.trim();return o.length>0}catch(n){return console.error("personalization.form.validateInput",n),!0}}function m(e){y=void 0===e?!y:e,window.freedom.nsPubSub.pub("personalization.form.toggle.status",y)}function f(e,o){try{return o.preventDefault(),!e.length||(z.showErrors(o.target,e),!1)}catch(n){return console.error("personalization.form.setPersonaState",n),!1}}function d(){try{window.freedom.nsPubSub.sub("formValidationCore.loaded",function(e){z=e,window.setTimeout(function(){window.freedom.nsPubSub.pub("formValidation.validateForm",{formName:h,validationCallback:f})},0)})}catch(e){console.error("personalization.form.initValidationForm",e)}}function b(e){try{e(w?s():!0)}catch(o){console.error("personalization.validatePersonaBuy",o),e(!0)}}function p(e){try{w=e}catch(o){console.error("personalization.changePersonaOpenStatus",o)}}function v(){try{window.freedom.nsPubSub.sub("personalization.get",r),window.freedom.nsPubSub.sub("color-flavor-size.changeHtml.before",a),window.freedom.nsPubSub.sub("color-flavor-size.changeHtml.after",u),window.freedom.nsPubSub.sub("personalization.restart",l),window.freedom.nsPubSub.sub("color-flavor-size.changeHtml.after",d),window.freedom.nsPubSub.sub("personalization.form.toggleStatus",m),window.freedom.nsPubSub.sub("personalization.form.changeOpenClosed",p),window.freedom.nsPubSub.sub("ColorFlavorSize.handleBuyEvent.checkPersona",b)}catch(e){console.error("personalization.form.initPubSub",e)}}var z,h="personalization-form",S={name:null,number:null,text:null,color:null,status:!1},w=!1,y=!1;l(),d(),v()}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl9yZWZhY3RvcmluZy9fdGVtcGxhdGVzL3BlcnNvbmFsaXphdGlvbi9mb3JtL2FsbC9mb3JtLm1pbi5qcyJdLCJuYW1lcyI6WyJnZXRQZXJzb25hQ29sb3IiLCJwZXJzb25hU2t1IiwicXVlcnkiLCJjb2xvckVsZW1lbnQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjb2xvck9iamVjdCIsImdldEF0dHJpYnV0ZSIsImVycm9yIiwiY29uc29sZSIsImdldFBlcnNvbmFPYmplY3QiLCJlbGVtZW50IiwicGVyc29uYU9iamVjdCIsInNrdSIsInZhbHVlIiwiY29sb3IiLCJnZXRQZXJzb25hTGlzdCIsImlucHV0cyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJpIiwibGVuZ3RoIiwicGVyc29uYUxpc3QiLCJ2YWxpZGF0ZUlucHV0IiwicHVzaCIsImdldFBlcnNvbmFWYWx1ZXMiLCJjYWxsYmFjayIsInBlcnNvbmFTdGF0dXMiLCJnZXRJbnB1dHMiLCJmb3JtIiwiZm9ybXMiLCJDVVNUT01fUEVSU09OQUxJWkFUSU9OX0ZPUk1fTkFNRSIsInNhdmVQZXJzb25hU3RhdGUiLCJuYW1lIiwibnVtYmVyIiwidGV4dCIsIlBFUlNPTkEiLCJzdGF0dXMiLCJzZXRQZXJzb25hU3RhdGUiLCJ3aW5kb3ciLCJmcmVlZG9tIiwibnNQdWJTdWIiLCJwdWIiLCJnZXRGb3JtQ29uZmlnIiwiY29sb3JTdGF0dXMiLCJhY3RpdmUiLCJpbml0T2JzZXJ2ZUlucHV0cyIsInBlcnNvbmFJbnB1dHMiLCJwZXJzb25hUmFkaW9zIiwiYWRkRXZlbnRMaXN0ZW5lciIsImdldEZvcm1WYWxpZGF0ZSIsImluZGV4IiwiZm9ybUNvbmZpZyIsImlucHV0IiwiaW5wdXRWYWx1ZSIsInRyaW0iLCJ0b2dnbGVQZXJzb25hU3RhdHVzIiwidW5kZWZpbmVkIiwidmFsaWRhdGlvbkNhbGxiYWNrIiwiZXJyb3JzIiwiZXZlbnQiLCJwcmV2ZW50RGVmYXVsdCIsIkZPUk1fVkFMSURBVElPTl9DT1JFIiwic2hvd0Vycm9ycyIsInRhcmdldCIsImluaXRWYWxpZGF0aW9uRm9ybSIsInN1YiIsImZvcm1WYWxpZGF0aW9uQ29yZSIsInNldFRpbWVvdXQiLCJmb3JtTmFtZSIsInZhbGlkYXRlUGVyc29uYUJ1eSIsInBlcnNvbmFJc09wZW4iLCJjaGFuZ2VQZXJzb25hT3BlblN0YXR1cyIsImluaXRQdWJTdWIiXSwibWFwcGluZ3MiOiJBQUFBLGNBRUMsV0FrQkMsUUFBU0EsR0FBZ0JDLEdBQ3ZCLElBQ0UsR0FBSUMsR0FBUSx1REFBeURELEVBQWEsYUFDOUVFLEVBQWVDLFNBQVNDLGNBQWNILEdBQ3RDSSxJQUVKLE9BQUlILElBQ0pHLEVBQWtCLEtBQUlILEVBQWFJLGFBQWEsc0JBQ2hERCxFQUFrQixLQUFJSCxFQUFhSSxhQUFhLHNCQUNoREQsRUFBa0IsS0FBSUgsRUFBYUksYUFBYSxzQkFFekNELEdBTGtCLEtBTXpCLE1BQU9FLEdBRVAsTUFEQUMsU0FBUUQsTUFBTSx3Q0FBeUNBLEdBQ2hELE1BU1gsUUFBU0UsR0FBaUJDLEdBQ3hCLEdBQUlDLElBQ0ZDLElBQUssS0FDTEMsTUFBTyxLQUVULEtBQ0UsSUFBSUgsRUFBUyxNQUFPQyxFQUVwQkEsR0FBY0MsSUFBTUYsRUFBUUosYUFBYSxnQkFBa0IsS0FDM0RLLEVBQWNFLE1BQWtDLGdCQUFsQkgsR0FBUUcsTUFBc0JILEVBQVFHLE1BQVEsSUFFNUUsSUFBSUMsR0FBUWYsRUFBZ0JZLEVBQWNDLElBSzFDLE9BSkdFLEtBQ0RILEVBQXFCLE1BQUlHLEdBR3BCSCxFQUNQLE1BQU9KLEdBRVAsTUFEQUMsU0FBUUQsTUFBTSx3Q0FBeUNBLEdBQ2hESSxHQVFYLFFBQVNJLEtBQ1AsSUFLRSxJQUpBLEdBQUlDLEdBQVNiLFNBQVNjLGlCQUFpQixvQ0FDbkNDLEVBQUlGLEVBQU9HLE9BQ1hDLEtBRUVGLEtBQ0RHLEVBQWNMLEVBQU9FLEtBQ3RCRSxFQUFZRSxLQUFLYixFQUFpQk8sRUFBT0UsSUFJN0MsT0FBT0UsR0FDUCxNQUFPYixHQUVQLE1BREFDLFNBQVFELE1B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LEdBQzFCLElBRUlBLEVBREM2QyxFQUNRckIsS0FFQSxHQUVYLE1BQU96QyxHQUNQQyxRQUFRRCxNQUFNLHFDQUFzQ0EsR0FDcERpQixHQUFTLElBUWIsUUFBUzhDLEdBQXdCbkMsR0FDL0IsSUFDRWtDLEVBQWdCbEMsRUFDaEIsTUFBTzVCLEdBQ1BDLFFBQVFELE1BQU0sMENBQTJDQSxJQU83RCxRQUFTZ0UsS0FDUCxJQUNFbEMsT0FBT0MsUUFBUUMsU0FBU3lCLElBQUksc0JBQXVCekMsR0FDbkRjLE9BQU9DLFFBQVFDLFNBQVN5QixJQUFJLHNDQUF1Q2xDLEdBQ25FTyxPQUFPQyxRQUFRQyxTQUFTeUIsSUFBSSxxQ0FBc0M1QixHQUNsRUMsT0FBT0MsUUFBUUMsU0FBU3lCLElBQUksMEJBQTJCcEIsR0FDdkRQLE9BQU9DLFFBQVFDLFNBQVN5QixJQUFJLHFDQUFzQ0QsR0FDbEUxQixPQUFPQyxRQUFRQyxTQUFTeUIsSUFBSSxvQ0FBcUNWLEdBQ2pFakIsT0FBT0MsUUFBUUMsU0FBU3lCLElBQUksd0NBQXlDTSxHQUNyRWpDLE9BQU9DLFFBQVFDLFNBQVN5QixJQUFJLDhDQUErQ0ksR0FDM0UsTUFBTzdELEdBQ1BDLFFBQVFELE1BQU0sa0NBQW1DQSxJQXhackQsR0FDRXFELEdBREUvQixFQUFtQyx1QkFHckNLLEdBQ0VILEtBQU0sS0FDTkMsT0FBUSxLQUNSQyxLQUFNLEtBQ05uQixNQUFPLEtBQ1BxQixRQUFRLEdBRVZrQyxHQUFnQixFQUNoQjVDLEdBQWdCLENBaVpsQm1CLEtBQ0FtQixJQUNBUSIsImZpbGUiOiJfcmVmYWN0b3JpbmcvX3RlbXBsYXRlcy9wZXJzb25hbGl6YXRpb24vZm9ybS9hbGwvZm9ybS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbigpIHtcbiAgdmFyIENVU1RPTV9QRVJTT05BTElaQVRJT05fRk9STV9OQU1FID0gJ3BlcnNvbmFsaXphdGlvbi1mb3JtJyxcbiAgICBGT1JNX1ZBTElEQVRJT05fQ09SRSxcbiAgICAvL1RvRG8gLSByZWZhYyBwZXJzb25hIGFqYXggc3RhdHVzIHdpdGggbmV3IHBlcnNvbmEgYXJyYXlcbiAgICBQRVJTT05BID0ge1xuICAgICAgbmFtZTogbnVsbCxcbiAgICAgIG51bWJlcjogbnVsbCxcbiAgICAgIHRleHQ6IG51bGwsXG4gICAgICBjb2xvcjogbnVsbCxcbiAgICAgIHN0YXR1czogZmFsc2VcbiAgICB9LFxuICAgIHBlcnNvbmFJc09wZW4gPSBmYWxzZSxcbiAgICBwZXJzb25hU3RhdHVzID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIGZ1bmN0aW9uIHRvIGdldCB0aGUgc2VsZWN0ZWQgY29sb3IgdG8gcmVzcGVjdGl2ZSBwZXJzb25hU2t1IFtUTyBDUkVBVEUgUEFZTE9BRF1cbiAgICogQHBhcmFtIHtzdHJpbmd9IHBlcnNvbmFTa3UgLSBzdHJpbmcgb2YgcGVyc29uYSBjb2xvciB0byBnZXRcbiAgICovXG4gIGZ1bmN0aW9uIGdldFBlcnNvbmFDb2xvcihwZXJzb25hU2t1KSB7XG4gICAgdHJ5IHtcbiAgICAgIHZhciBxdWVyeSA9ICcucGVyc29uYWxpemF0aW9uIFtwZXJzb25hLWNvbG9yLXJhZGlvXVtwZXJzb25hLXNrdT1cIicgKyBwZXJzb25hU2t1ICsgJ1wiXTpjaGVja2VkJztcbiAgICAgIHZhciBjb2xvckVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHF1ZXJ5KTtcbiAgICAgIHZhciBjb2xvck9iamVjdCA9IHt9O1xuXG4gICAgICBpZighY29sb3JFbGVtZW50KSByZXR1cm4gbnVsbDtcbiAgICAgIGNvbG9yT2JqZWN0Wydjb2RlJ10gPSBjb2xvckVsZW1lbnQuZ2V0QXR0cmlidXRlKCdwZXJzb25hLWNvbG9yLWNvZGUnKTtcbiAgICAgIGNvbG9yT2JqZWN0WydoZXhhJ10gPSBjb2xvckVsZW1lbnQuZ2V0QXR0cmlidXRlKCdwZXJzb25hLWNvbG9yLWhleGEnKTtcbiAgICAgIGNvbG9yT2JqZWN0WyduYW1lJ10gPSBjb2xvckVsZW1lbnQuZ2V0QXR0cmlidXRlKCdwZXJzb25hLWNvbG9yLW5hbWUnKTtcblxuICAgICAgcmV0dXJuIGNvbG9yT2JqZWN0O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdwZXJzb25hbGl6YXRpb24uZm9ybS5nZXRQZXJzb25hT2JqZWN0JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIGZ1bmN0aW9uIHRvIGdldCB0aGUgcGVyc29uYU9iamVjdCBieSBhIHBlcnNvbmEgZWxlbWVudCBbVE8gQ1JFQVRFIFBBWUxPQURdXG4gICAqIEByZXR1cm4ge29iamVjdH0gLSBwZXJzb25hIG9iamVjdFxuICAgKiBAcGFyYW0ge0VsZW1lbnR9IGVsZW1lbnQgLSBwZXJzb25hIGVsZW1lbnRcbiAgICovXG4gIGZ1bmN0aW9uIGdldFBlcnNvbmFPYmplY3QoZWxlbWVudCkge1xuICAgIHZhciBwZXJzb25hT2JqZWN0ID0ge1xuICAgICAgc2t1OiBudWxsLFxuICAgICAgdmFsdWU6IG51bGxcbiAgICB9O1xuICAgIHRyeSB7XG4gICAgICBpZighZWxlbWVudCkgcmV0dXJuIHBlcnNvbmFPYmplY3Q7XG5cbiAgICAgIHBlcnNvbmFPYmplY3Quc2t1ID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ3BlcnNvbmEtc2t1JykgfHwgbnVsbDtcbiAgICAgIHBlcnNvbmFPYmplY3QudmFsdWUgPSAodHlwZW9mIGVsZW1lbnQudmFsdWUgPT09ICdzdHJpbmcnKSA/IGVsZW1lbnQudmFsdWUgOiBudWxsO1xuICAgICAgLy9hZGQgY29sb3Iga2V5LCBqdXN0IGlmIGhhcyBjb2xvciBvYmplY3QuXG4gICAgICB2YXIgY29sb3IgPSBnZXRQZXJzb25hQ29sb3IocGVyc29uYU9iamVjdC5za3UpO1xuICAgICAgaWYoY29sb3IpIHtcbiAgICAgICAgcGVyc29uYU9iamVjdFsnY29sb3InXSA9IGNvbG9yO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcGVyc29uYU9iamVjdDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcigncGVyc29uYWxpemF0aW9uLmZvcm0uZ2V0UGVyc29uYU9iamVjdCcsIGVycm9yKTtcbiAgICAgIHJldHVybiBwZXJzb25hT2JqZWN0O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBmdW5jdGlvbiB0byBnZXQgdGhlIHBlcnNvbmEgbGlzdCBmcm9tIERPTS4gW1RPIENSRUFURSBQQVlMT0FEXVxuICAgKiBAcmV0dXJuIHthcnJheX0gLSBhcnJheSBvZiBwZXJzb25hIGVsZW1lbnRzXG4gICAqL1xuICBmdW5jdGlvbiBnZXRQZXJzb25hTGlzdCgpIHtcbiAgICB0cnkge1xuICAgICAgdmFyIGlucHV0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wZXJzb25hbGl6YXRpb24gW3BlcnNvbmEtaW5wdXRdJyk7XG4gICAgICB2YXIgaSA9IGlucHV0cy5sZW5ndGg7XG4gICAgICB2YXIgcGVyc29uYUxpc3QgPSBbXTtcblxuICAgICAgd2hpbGUoaS0tKSB7XG4gICAgICAgIGlmKHZhbGlkYXRlSW5wdXQoaW5wdXRzW2ldKSl7XG4gICAgICAgICAgcGVyc29uYUxpc3QucHVzaChnZXRQZXJzb25hT2JqZWN0KGlucHV0c1tpXSkpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBwZXJzb25hTGlzdDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcigncGVyc29uYWxpemF0aW9uLmZvcm0uZ2V0UGVyc29uYUxpc3QnLCBlcnJvcik7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIGdldCBwZXJzb25hbGl6YXRpb24gdmFsdWVzIGluIGZvcm0gYW5kIHNlbmQgaXQgYmFjayB0byBmdW5jdGlvbiBjYWxsYmFjayBbVE8gQ1JFQVRFIFBBWUxPQURdXG4gICAqIEBwYXJhbSAgICB7RnVuY3Rpb259IGNhbGxiYWNrIFtGdW5jdGlvbiBjYWxsYmFjayB0byByZXNvbHZlIHRoaXMgZXZlbnRdXG4gICAqIEBjYWxsYmFjayB7RnVuY3Rpb259IHBlcnNvbmEgIFtQZXJzb25hbGl6YXRpb24gb2JqZWN0IHZhbHVlc11cbiAgICovXG4gIGZ1bmN0aW9uIGdldFBlcnNvbmFWYWx1ZXMoY2FsbGJhY2spIHtcbiAgICB2YXIgcGVyc29uYUxpc3QgPSBbXTtcblxuICAgIHRyeSB7XG4gICAgICBpZiAocGVyc29uYVN0YXR1cykge1xuICAgICAgICBwZXJzb25hTGlzdCA9IGdldFBlcnNvbmFMaXN0KCk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ3BlcnNvbmFsaXphdGlvbi5mb3JtLmdldFBlcnNvbmFWYWx1ZXMnLCBlcnJvcik7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIGNhbGxiYWNrKHBlcnNvbmFMaXN0LCB0cnVlKTtcbiAgICB9XG4gIH1cblxuICAgIC8qKlxuICAgKiBmdW5jdGlvbiB0byBnZXQgZm9ybSBpbnB1dHMgW1RPIE1BTklQVUxBVEUgU1RBVEUgT05MWV1cbiAgICogQHJldHVybiB7b2JqZWN0fVxuICAgKi9cbiAgZnVuY3Rpb24gZ2V0SW5wdXRzKCkge1xuICAgIHRyeSB7XG4gICAgICB2YXIgaW5wdXRzID0ge307XG4gICAgICB2YXIgZm9ybSA9IGRvY3VtZW50LmZvcm1zW0NVU1RPTV9QRVJTT05BTElaQVRJT05fRk9STV9OQU1FXTtcblxuICAgICAgaWYgKGZvcm0pIHtcbiAgICAgICAgaW5wdXRzWyduYW1lJ10gPSBmb3JtLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXBlcnNvbmFsaXphdGlvbi1uYW1lXScpIHx8IG51bGw7XG4gICAgICAgIGlucHV0c1snbnVtYmVyJ10gPSBmb3JtLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXBlcnNvbmFsaXphdGlvbi1udW1iZXJdJykgfHwgbnVsbDtcbiAgICAgICAgaW5wdXRzWydjb2xvciddID0gZm9ybS5xdWVyeVNlbGVjdG9yKCdbcmFkaW8taW5wdXRdOmNoZWNrZWQnKSB8fCBudWxsO1xuICAgICAgICBpbnB1dHNbJ3RleHQnXSA9IGZvcm0ucXVlcnlTZWxlY3RvcignW2RhdGEtcGVyc29uYWxpemF0aW9uLXRleHRdJykgfHwgbnVsbDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGlucHV0cztcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcigncGVyc29uYWxpemF0aW9uLmZvcm0uZ2V0SW5wdXRzJywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHt9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBbc2F2ZVBlcnNvbmFTdGF0ZV1cbiAgICogc2F2ZSBwZXJzb25hbGl6YXRpb24gdmFsdWVzIGluIGNvbnN0YW50IFtUTyBNQU5JUFVMQVRFIFNUQVRFIE9OTFldXG4gICAqIEByZXR1cm4ge31cbiAgICovXG4gIGZ1bmN0aW9uIHNhdmVQZXJzb25hU3RhdGUoKSB7XG4gICAgdHJ5IHtcbiAgICAgIHZhciBpbnB1dHMgPSBnZXRJbnB1dHMoKTtcbiAgICAgIHZhciBuYW1lID0gaW5wdXRzLm5hbWU7XG4gICAgICB2YXIgbnVtYmVyID0gaW5wdXRzLm51bWJlcjtcbiAgICAgIHZhciBjb2xvciA9IGlucHV0cy5jb2xvcjtcbiAgICAgIHZhciB0ZXh0ID0gaW5wdXRzLnRleHQ7XG5cbiAgICAgIC8vaWYgdGhlIGZpZWxzIGFyZSBlbXB0eSBkb250IGNoYW5nZSB0aGUgc3RhdHVzXG4gICAgICAvL0lmIHR3byByZXF1ZXN0cyBjYWxsIHRoZSBtZXRob2QgdGhlIHN0YXRlIHN0YXkgb24gdGhlIHBlcnNvbmEgb2JqZWN0XG4gICAgICBQRVJTT05BLm5hbWUgPSAobmFtZSAmJiBuYW1lLnZhbHVlKSA/IG5hbWUudmFsdWUgOiBQRVJTT05BLm5hbWU7XG4gICAgICBQRVJTT05BLm51bWJlciA9IChudW1iZXIgJiYgbnVtYmVyLnZhbHVlKSA/IG51bWJlci52YWx1ZSA6IFBFUlNPTkEubnVtYmVyO1xuICAgICAgUEVSU09OQS50ZXh0ID0gKHRleHQgJiYgdGV4dC52YWx1ZSkgPyB0ZXh0LnZhbHVlIDogUEVSU09OQS50ZXh0O1xuICAgICAgLy9pdHMgYSBlbGVtZW50IGNvbG9yIG5vdCBhIHN0cmluZyBjb2xvclxuICAgICAgUEVSU09OQS5jb2xvciA9IGNvbG9yIHx8IFBFUlNPTkEuY29sb3I7XG4gICAgICBQRVJTT05BLnN0YXR1cyA9IHBlcnNvbmFTdGF0dXM7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ3BlcnNvbmFsaXphdGlvbi5mb3JtLnNhdmVQZXJzb25hU3RhdGUnLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFtzZXRQZXJzb25hU3RhdGVdXG4gICAqIGdldCBwZXJzb25hbGl6YXRpb24gdmFsdWVzIGluIGZvcm0gYW5kIHNlbmQgaXQgYmFjayB0byBmdW5jdGlvbiBjYWxsYmFjayBbVE8gTUFOSVBVTEFURSBTVEFURSBPTkxZXVxuICAgKiBAcmV0dXJuIHt9XG4gICAqL1xuICBmdW5jdGlvbiBzZXRQZXJzb25hU3RhdGUoKSB7XG4gICAgdHJ5IHtcbiAgICAgIHZhciBpbnB1dHMgPSBnZXRJbnB1dHMoKTtcbiAgICAgIHZhciBuYW1lID0gaW5wdXRzLm5hbWU7XG4gICAgICB2YXIgbnVtYmVyID0gaW5wdXRzLm51bWJlcjtcbiAgICAgIHZhciB0ZXh0ID0gaW5wdXRzLnRleHQ7XG5cbiAgICAgIGlmICh0ZXh0ICYmIFBFUlNPTkEudGV4dCkge1xuICAgICAgICB0ZXh0LnZhbHVlID0gUEVSU09OQS50ZXh0O1xuICAgICAgfVxuXG4gICAgICBpZiAobmFtZSAmJiBQRVJTT05BLm5hbWUpIHtcbiAgICAgICAgbmFtZS52YWx1ZSA9IFBFUlNPTkEubmFtZTtcbiAgICAgIH1cblxuICAgICAgaWYgKG51bWJlciAmJiBQRVJTT05BLm51bWJlcikge1xuICAgICAgICBudW1iZXIudmFsdWUgPSBQRVJTT05BLm51bWJlcjtcbiAgICAgIH1cblxuICAgICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIucHViKCdwZXJzb25hbGl6YXRpb24uZm9ybS5zZXQuaW5wdXRzJywgUEVSU09OQSk7XG4gICAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ3BlcnNvbmFsaXphdGlvbi5mb3JtLnNldC5zdGF0dXMnLCBQRVJTT05BLnN0YXR1cyk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ3BlcnNvbmFsaXphdGlvbi5mb3JtLnNldFBlcnNvbmFTdGF0ZScsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICAgIC8qKlxuICAgKiBmdW5jdGlvbiB0byBnZXQgdGhlIGZvcm0gY29uZmlnIHVwZGF0ZWRcbiAgICogdGhlIGFjdGl2ZSBrZXkgaXMgdXNlZCB0byBrbm93IGlmIHRoZSBlbGVtZW50IGlzIGN1cnJlbnR5IHNob3dpbmcgaW50byB0aGUgRE9NLlxuICAgKi9cbiAgZnVuY3Rpb24gZ2V0Rm9ybUNvbmZpZygpIHtcbiAgICB0cnkge1xuICAgICAgdmFyIG5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjY3VzdG9taXphdGlvbi1uYW1lW25hbWU9XCJjbmFtZVwiXScpO1xuICAgICAgdmFyIG51bWJlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNjdXN0b21pemF0aW9uLW51bWJlcltuYW1lPVwiY251bWJlclwiXScpO1xuICAgICAgdmFyIHRleHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjY3VzdG9taXphdGlvbi10ZXh0W25hbWU9XCJjdGV4dFwiXScpO1xuICAgICAgdmFyIGNvbG9yID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW25hbWU9XCJwZXJzb25hLWNvbG9yXCJdJyk7XG4gICAgICB2YXIgY29sb3JTdGF0dXMgPSAhIWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lPVwicGVyc29uYS1jb2xvclwiXTpjaGVja2VkJyk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIG5hbWU6IHtcbiAgICAgICAgICBuYW1lOiAnY25hbWUnLFxuICAgICAgICAgIHN0YXR1czogdmFsaWRhdGVJbnB1dChuYW1lKSxcbiAgICAgICAgICBhY3RpdmU6IG5hbWVcbiAgICAgICAgfSxcbiAgICAgICAgbnVtYmVyOiB7XG4gICAgICAgICAgbmFtZTogJ2NudW1iZXInLFxuICAgICAgICAgIHN0YXR1czogdmFsaWRhdGVJbnB1dChudW1iZXIpLFxuICAgICAgICAgIGFjdGl2ZTogbnVtYmVyXG4gICAgICAgIH0sXG4gICAgICAgIHRleHQ6IHtcbiAgICAgICAgICBuYW1lOiAnY3RleHQnLFxuICAgICAgICAgIHN0YXR1czogdmFsaWRhdGVJbnB1dCh0ZXh0KSxcbiAgICAgICAgICBhY3RpdmU6IHRleHRcbiAgICAgICAgfSxcbiAgICAgICAgY29sb3I6IHtcbiAgICAgICAgICBuYW1lOiAncGVyc29uYS1jb2xvcicsXG4gICAgICAgICAgc3RhdHVzOiBjb2xvclN0YXR1cyxcbiAgICAgICAgICBhY3RpdmU6IGNvbG9yXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ3BlcnNvbmFsaXphdGlvbi5nZXRGb3JtQ29uZmlnJyk7XG4gICAgICByZXR1cm4ge307XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFtpbml0T2JzZXJ2ZUlucHV0c11cbiAgICogRnVuY3Rpb24gdG8gb2JzZXJ2ZSB0aGUgdGV4dHMgaW5wdXQgYW5kIHJhZGlvcyBhbmQgcHVibGlzaCB0aGUgY3VycmVudCBhY3RpdmUgc3RhdHVzXG4gICAqIEByZXR1cm4ge31cbiAgICovXG4gIGZ1bmN0aW9uIGluaXRPYnNlcnZlSW5wdXRzKCkge1xuICAgIHRyeSB7XG4gICAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ3BlcnNvbmFsaXphdGlvbi5mb3JtLnRvZ2dsZVN0YXR1cycsIGZhbHNlKTtcbiAgICAgIHZhciBwZXJzb25hSW5wdXRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBlcnNvbmFsaXphdGlvbiBpbnB1dFt0eXBlPVwidGV4dFwiXScpO1xuICAgICAgdmFyIHBlcnNvbmFSYWRpb3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucGVyc29uYWxpemF0aW9uIGlucHV0W3R5cGU9XCJyYWRpb1wiXScpO1xuXG4gICAgICBpZihwZXJzb25hSW5wdXRzKSB7XG4gICAgICAgIHZhciBpID0gcGVyc29uYUlucHV0cy5sZW5ndGg7XG5cbiAgICAgICAgd2hpbGUoaS0tKSB7XG4gICAgICAgICAgcGVyc29uYUlucHV0c1tpXS5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIucHViKCdwZXJzb25hbGl6YXRpb24uZm9ybS52YWxpZGF0ZS5jaGFuZ2VkJywgZ2V0Rm9ybVZhbGlkYXRlKCkpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmKHBlcnNvbmFSYWRpb3MpIHtcbiAgICAgICAgdmFyIGluZGV4ID0gcGVyc29uYVJhZGlvcy5sZW5ndGg7XG5cbiAgICAgICAgd2hpbGUoaW5kZXgtLSkge1xuICAgICAgICAgIHBlcnNvbmFSYWRpb3NbaW5kZXhdLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIucHViKCdwZXJzb25hbGl6YXRpb24uZm9ybS52YWxpZGF0ZS5jaGFuZ2VkJywgZ2V0Rm9ybVZhbGlkYXRlKCkpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcigncGVyc29uYWxpemF0aW9uLmZvcm0uaW5pdE9ic2VydmVJbnB1dHMnLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFRoaXMgZnVuY3Rpb24gcmV0dXJuIHRoZSBjdXJyZW50eSB2YWxpZCBzdGF0dXMgb2YgZm9ybVxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IHN0YXR1cyAtc3RhdHVzIG9mIHZhbGlkYXRpb25cbiAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgIC0gbmFtZSBvZiBpbnB1dFxuICAgKi9cbiAgZnVuY3Rpb24gZ2V0Rm9ybVZhbGlkYXRlKCkge1xuICAgIHRyeSB7XG4gICAgICB2YXIgZm9ybUNvbmZpZyA9IGdldEZvcm1Db25maWcoKTtcbiAgICAgIGlmKGZvcm1Db25maWcubmFtZS5zdGF0dXMgfHwgZm9ybUNvbmZpZy5udW1iZXIuc3RhdHVzIHx8IGZvcm1Db25maWcudGV4dC5zdGF0dXMpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIGlmIHRoZSBjb2xvciBpcyBhY3RpdmUgb24gZG9tLCByZXR1cm4gdGhlIGN1cnJlbnR5IHN0YXR1cyBlbHNlIHJldHVybiB0cnVlXG4gICAgICAgICAqIGJlY2F1c2UgdGhlcmUgbm8gdmFsaWRhdGlvbnMgdG8gY29uc2lkZXJcbiAgICAgICAgICovXG4gICAgICAgIGlmKGZvcm1Db25maWcuY29sb3IuYWN0aXZlID8gZm9ybUNvbmZpZy5jb2xvci5zdGF0dXMgOiB0cnVlKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ3BlcnNvbmFsaXphdGlvbi5mb3JtLmdldEZvcm1WYWxpZGF0ZScsIGVycm9yKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBmdW5jdGlvbiB0byBjaGVjayB0aGUgZG9tIGVsZW1lbnQgYW5kIGVtbWl0IGV2ZW50IGFmdGVyIHZhbGlkYXRvblxuICAgKiBAcGFyYW0ge0VsZW1lbnR9IGlucHV0IC0gaW5wdXQgZWxlbWVudCB0byBiZSB2YWxpZGF0ZVxuICAgKiBAcmV0dXJuIHtib29sZWFufVxuICAgKi9cbiAgZnVuY3Rpb24gdmFsaWRhdGVJbnB1dChpbnB1dCkge1xuICAgIHRyeSB7XG4gICAgICBpZighaW5wdXQpIHJldHVybiBmYWxzZTtcblxuICAgICAgdmFyIGlucHV0VmFsdWUgPSBpbnB1dC52YWx1ZS50cmltKCk7XG5cbiAgICAgIGlmKGlucHV0VmFsdWUubGVuZ3RoID4gMCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdwZXJzb25hbGl6YXRpb24uZm9ybS52YWxpZGF0ZUlucHV0JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIGZ1bmN0aW9uIHRvIHRvZ2dsZSBmb3JtIHN0YXR1c1xuICAgKiBAcGFyYW0ge2Jvb2xlYW59IHN0YXR1cyAtIHZhbHVlIG9mIGZvcm0gc3RhdHVzIChvcHRpb25hbClcbiAgICogQHJldHVybiB7fVxuICAgKi9cbiAgZnVuY3Rpb24gdG9nZ2xlUGVyc29uYVN0YXR1cyhzdGF0dXMpIHtcbiAgICBpZiAoc3RhdHVzID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHBlcnNvbmFTdGF0dXMgPSAhcGVyc29uYVN0YXR1cztcbiAgICB9IGVsc2Uge1xuICAgICAgcGVyc29uYVN0YXR1cyA9IHN0YXR1cztcbiAgICB9XG5cbiAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ3BlcnNvbmFsaXphdGlvbi5mb3JtLnRvZ2dsZS5zdGF0dXMnLCBwZXJzb25hU3RhdHVzKTtcbiAgfVxuXG4gICAgLyoqXG4gICAqIFt2YWxpZGF0aW9uQ2FsbGJhY2tdXG4gICAqIGZvcm0gdmFsaWRhdGlvbiBwZXJzb25hIGNhbGxiYWNrXG4gICAqIEBwYXJhbSAge09iamVjdH0gICBlcnJvcnMgIFtlcnJvcyBpbiBwZXJzb25hbGl6YXRpb24gZm9ybV1cbiAgICogQHBhcmFtICB7RE9NRXZlbnR9IGV2ZW50XG4gICAqIEByZXR1cm4ge0Jvb2xlYW59ICAgICAgICAgIFt0cnVlIGlmIGhhcyBlcnJvcnMsIGZhbHNlIGlmIG5vdF1cbiAgICovXG4gIGZ1bmN0aW9uIHZhbGlkYXRpb25DYWxsYmFjayhlcnJvcnMsIGV2ZW50KSB7XG4gICAgdHJ5IHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBpZiAoIWVycm9ycy5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICBGT1JNX1ZBTElEQVRJT05fQ09SRS5zaG93RXJyb3JzKGV2ZW50LnRhcmdldCwgZXJyb3JzKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcigncGVyc29uYWxpemF0aW9uLmZvcm0uc2V0UGVyc29uYVN0YXRlJywgZXJyb3IpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBGdW5jdGlvbiB0byBpbml0IHRoZSB2YWxpZGF0aW9uIGZvcm1cbiAgICovXG4gIGZ1bmN0aW9uIGluaXRWYWxpZGF0aW9uRm9ybSgpIHtcbiAgICB0cnkge1xuICAgICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIuc3ViKCdmb3JtVmFsaWRhdGlvbkNvcmUubG9hZGVkJywgZnVuY3Rpb24oZm9ybVZhbGlkYXRpb25Db3JlKSB7XG4gICAgICAgIEZPUk1fVkFMSURBVElPTl9DT1JFID0gZm9ybVZhbGlkYXRpb25Db3JlO1xuXG4gICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnB1YignZm9ybVZhbGlkYXRpb24udmFsaWRhdGVGb3JtJywge1xuICAgICAgICAgICAgZm9ybU5hbWU6IENVU1RPTV9QRVJTT05BTElaQVRJT05fRk9STV9OQU1FLFxuICAgICAgICAgICAgdmFsaWRhdGlvbkNhbGxiYWNrOiB2YWxpZGF0aW9uQ2FsbGJhY2tcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSwgMCk7XG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcigncGVyc29uYWxpemF0aW9uLmZvcm0uaW5pdFZhbGlkYXRpb25Gb3JtJywgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gICAgLyoqXG4gICAqIGZ1bmN0aW9uIHRvIHZhbGlkYXRlIGlmIHRoZSBwZXJzb25hIGlzIHBhcnRpYWwgY29tcGxldGVkXG4gICAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrIC0gY2FsbGJhY2sgdG8gcmVjZWl2ZSB0aGUgcGVyc29uYSBmaWVsZHMgc3RhdHVzXG4gICAqL1xuICBmdW5jdGlvbiB2YWxpZGF0ZVBlcnNvbmFCdXkoY2FsbGJhY2spIHtcbiAgICB0cnkge1xuICAgICAgaWYocGVyc29uYUlzT3Blbikge1xuICAgICAgICBjYWxsYmFjayhnZXRGb3JtVmFsaWRhdGUoKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjYWxsYmFjayh0cnVlKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcigncGVyc29uYWxpemF0aW9uLnZhbGlkYXRlUGVyc29uYUJ1eScsIGVycm9yKTtcbiAgICAgIGNhbGxiYWNrKHRydWUpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBmdW5jdGlvbiB0byBtYW5pcHVsYXRlIHRoZSBwZXJzb25hIGZvcm0gc3RhdHVzXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gc3RhdHVzIHN0YXR1cyBvZiBmb3JtIHBlcnNvbmEgb3BlblxuICAgKi9cbiAgZnVuY3Rpb24gY2hhbmdlUGVyc29uYU9wZW5TdGF0dXMoc3RhdHVzKSB7XG4gICAgdHJ5IHtcbiAgICAgIHBlcnNvbmFJc09wZW4gPSBzdGF0dXM7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ3BlcnNvbmFsaXphdGlvbi5jaGFuZ2VQZXJzb25hT3BlblN0YXR1cycsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogZnVuY3Rpb24gdG8gaW50aSB0aGUgcHViIHN1YiBkZXBlbmRlbmNpZXMgb25jZSB0aW1lXG4gICAqL1xuICBmdW5jdGlvbiBpbml0UHViU3ViKCkge1xuICAgIHRyeSB7XG4gICAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5zdWIoJ3BlcnNvbmFsaXphdGlvbi5nZXQnLCBnZXRQZXJzb25hVmFsdWVzKTtcbiAgICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnN1YignY29sb3ItZmxhdm9yLXNpemUuY2hhbmdlSHRtbC5iZWZvcmUnLCBzYXZlUGVyc29uYVN0YXRlKTtcbiAgICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnN1YignY29sb3ItZmxhdm9yLXNpemUuY2hhbmdlSHRtbC5hZnRlcicsIHNldFBlcnNvbmFTdGF0ZSk7XG4gICAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5zdWIoJ3BlcnNvbmFsaXphdGlvbi5yZXN0YXJ0JywgaW5pdE9ic2VydmVJbnB1dHMpO1xuICAgICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIuc3ViKCdjb2xvci1mbGF2b3Itc2l6ZS5jaGFuZ2VIdG1sLmFmdGVyJywgaW5pdFZhbGlkYXRpb25Gb3JtKTtcbiAgICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnN1YigncGVyc29uYWxpemF0aW9uLmZvcm0udG9nZ2xlU3RhdHVzJywgdG9nZ2xlUGVyc29uYVN0YXR1cyk7XG4gICAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5zdWIoJ3BlcnNvbmFsaXphdGlvbi5mb3JtLmNoYW5nZU9wZW5DbG9zZWQnLCBjaGFuZ2VQZXJzb25hT3BlblN0YXR1cyk7XG4gICAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5zdWIoJ0NvbG9yRmxhdm9yU2l6ZS5oYW5kbGVCdXlFdmVudC5jaGVja1BlcnNvbmEnLCB2YWxpZGF0ZVBlcnNvbmFCdXkpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdwZXJzb25hbGl6YXRpb24uZm9ybS5pbml0UHViU3ViJywgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIGluaXRPYnNlcnZlSW5wdXRzKCk7XG4gIGluaXRWYWxpZGF0aW9uRm9ybSgpO1xuICBpbml0UHViU3ViKCk7XG59KCkpO1xuIl19
