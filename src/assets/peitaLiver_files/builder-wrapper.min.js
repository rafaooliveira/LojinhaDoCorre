"use strict";!function(){function e(){try{var e=document.querySelector("[data-builder-downloaded]").value,r=JSON.parse(e),o={builderJson:r};p.dispatch(p.actionTypes.CHANGE_PERSONA_BUILDER,o)}catch(n){console.error("builder-combo.saveState",n)}}function r(){var e=null;try{e=document.querySelector("[builder-wrapper-target]")}catch(r){console.error("builder-wrapper.getTarget",r)}finally{return e}}function o(o){try{window.freedom.nsPubSub.pub("builder-wrapper.before.rendered",{});var t=r();t.innerHTML=o,b.builderOnTheDom=!0,e(),n(),window.freedom.nsPubSub.pub("callToAction.hide.main-button",!0),window.freedom.nsPubSub.pub("builder-wrapper.after.rendered",{}),window.freedom.nsPubSub.pub("modal.restart"),window.freedom.nsPubSub.pub("SlidePush.restart","personalization-page-preview")}catch(u){console.error("builder-wrapper.insertIntoDom",u),b.builderOnTheDom=!1,window.freedom.nsPubSub.pub("callToAction.hide.main-button",!1)}}function n(){try{var e=p.getState(["pdp","persona","builder","builderJson","steps"]),r=e?e[0]:null;r&&r.multiOptions&&window.freedom.nsPubSub.pub("builder-wrapper.open.multi-options",{})}catch(o){console.error("builder-wrapper.notifyMultiOptions",o)}}function t(e){try{var r=document.querySelector("[builder-wrapper-image-preview]"),o=r?r.value:null,n=document.querySelector("[data-product-sku]").getAttribute("data-product-sku"),t=document.querySelector("[product-data-seller]").getAttribute("product-data-seller");window.freedom.restClient.request("/personalization/get-builder",{method:"post",data:{image:o,sku:n,sellerId:t},complete:e})}catch(u){console.error("builder-wrapper.getBuilder",u)}}function u(){try{b.builderOnTheDom=!!document.querySelector("[builder-container]")}catch(e){console.error("builder-wrapper.fetchBuilderOnTheDom",e)}}function i(){try{u(),!r()||b.builderOnTheDom||b.fetching||(b.fetching=!0,c("show"),t(function(e){b.fetching=!1,c("hide"),"string"==typeof e&&o(e)}))}catch(e){console.error("builder-wrapper.render",e)}}function d(){try{s.open&&i()}catch(e){console.error("builder-wrapper.renderOnLoad",e)}}function a(){try{b.builderOnTheDom=!1}catch(e){console.error("builder-wrapper.setBuilderNoVisible",e)}}function l(e){try{e&&b.builderOnTheDom?window.freedom.nsPubSub.pub("callToAction.hide.main-button",!0):window.freedom.nsPubSub.pub("callToAction.hide.main-button",!1),s.open=e}catch(r){console.error("builder-wrapper.handlePersonaState",r)}}function c(e){try{var r=document.querySelector("[builder-wrapper-loader]");r&&window.freedom.nsPubSub.pub("spin.loading.animate",r,e)}catch(o){console.error("builder-wrapper.handlePersonaState",o)}}var b={builderOnTheDom:!1,fetching:!1},p=window.freedom.NsStore,s={open:!1};window.freedom.nsPubSub.sub("personalization.open.after",i),window.freedom.nsPubSub.sub("personalization.form.changeOpenClosed",l),window.freedom.nsPubSub.sub("color-flavor-size.changeHtml.before",a),window.freedom.nsPubSub.sub("color-flavor-size.changeHtml.after",d)}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl9yZWZhY3RvcmluZy9fdGVtcGxhdGVzL3BlcnNvbmFsaXphdGlvbi9idWlsZGVyL2J1aWxkZXItd3JhcHBlci9hbGwvYnVpbGRlci13cmFwcGVyLm1pbi5qcyJdLCJuYW1lcyI6WyJ1cGRhdGVTdG9yZSIsImpzb25TdHJpbmciLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJ2YWx1ZSIsImJ1aWxkZXJKc29uIiwiSlNPTiIsInBhcnNlIiwicGF5bG9hZCIsInN0b3JlIiwiZGlzcGF0Y2giLCJhY3Rpb25UeXBlcyIsIkNIQU5HRV9QRVJTT05BX0JVSUxERVIiLCJlcnJvciIsImNvbnNvbGUiLCJnZXRUYXJnZXQiLCJ0YXJnZXQiLCJpbnNlcnRJbnRvRG9tIiwiaHRtbCIsIndpbmRvdyIsImZyZWVkb20iLCJuc1B1YlN1YiIsInB1YiIsImJ1aWxkZXJUYXJnZXQiLCJpbm5lckhUTUwiLCJzdGF0ZSIsImJ1aWxkZXJPblRoZURvbSIsIm5vdGlmeU11bHRpT3B0aW9ucyIsInN0ZXBzIiwiZ2V0U3RhdGUiLCJjdXJyU3RlcCIsIm11bHRpT3B0aW9ucyIsImdldEJ1aWxkZXIiLCJjYWxsYmFjayIsImltZ1VybEVsIiwiaW1nVXJsIiwicHJvZHVjdFNrdSIsImdldEF0dHJpYnV0ZSIsInNlbGxlcklkIiwicmVzdENsaWVudCIsInJlcXVlc3QiLCJtZXRob2QiLCJkYXRhIiwiaW1hZ2UiLCJza3UiLCJjb21wbGV0ZSIsImZldGNoQnVpbGRlck9uVGhlRG9tIiwicmVuZGVyIiwiZmV0Y2hpbmciLCJoYW5kbGVMb2FkZXIiLCJyZXNwb25zZSIsInJlbmRlck9uTG9hZCIsInBlcnNvbmFTdGF0ZSIsIm9wZW4iLCJzZXRCdWlsZGVyTm9WaXNpYmxlIiwiaGFuZGxlUGVyc29uYVN0YXRlIiwiYWN0aW9uIiwibG9hZGVyRWwiLCJOc1N0b3JlIiwic3ViIl0sIm1hcHBpbmdzIjoiQUFBQSxjQUVDLFdBZUMsUUFBU0EsS0FDUCxJQUNFLEdBQUlDLEdBQWFDLFNBQVNDLGNB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QXVCbUMsRUFBVUQsR0FFL0QsTUFBTzNDLEdBQ1BDLFFBQVFELE1BQU0scUNBQXNDQSxJQXRNeEQsR0FBSVksSUFDRkMsaUJBQWlCLEVBQ2pCc0IsVUFBVSxHQUdSdkMsRUFBUVUsT0FBT0MsUUFBUXNDLFFBRXZCTixHQUNGQyxNQUFNLEVBa01SbEMsUUFBT0MsUUFBUUMsU0FBU3NDLElBQUksNkJBQThCWixHQUMxRDVCLE9BQU9DLFFBQVFDLFNBQVNzQyxJQUFJLHdDQUF5Q0osR0FDckVwQyxPQUFPQyxRQUFRQyxTQUFTc0MsSUFBSSxzQ0FBdUNMLEdBQ25FbkMsT0FBT0MsUUFBUUMsU0FBU3NDLElBQUkscUNBQXNDUiIsImZpbGUiOiJfcmVmYWN0b3JpbmcvX3RlbXBsYXRlcy9wZXJzb25hbGl6YXRpb24vYnVpbGRlci9idWlsZGVyLXdyYXBwZXIvYWxsL2J1aWxkZXItd3JhcHBlci5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbigpe1xuICB2YXIgc3RhdGUgPSB7XG4gICAgYnVpbGRlck9uVGhlRG9tOiBmYWxzZSxcbiAgICBmZXRjaGluZzogZmFsc2VcbiAgfTtcblxuICB2YXIgc3RvcmUgPSB3aW5kb3cuZnJlZWRvbS5Oc1N0b3JlO1xuXG4gIHZhciBwZXJzb25hU3RhdGUgPSB7XG4gICAgb3BlbjogZmFsc2VcbiAgfTtcblxuICAvKipcbiAgICogZnVuY3Rpb24gdG8gZGlzcGF0Y2ggbG9jYWwgc3RhdGUgdG8gc3RvcmVcbiAgICovXG4gIGZ1bmN0aW9uIHVwZGF0ZVN0b3JlKCkge1xuICAgIHRyeSB7XG4gICAgICB2YXIganNvblN0cmluZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWJ1aWxkZXItZG93bmxvYWRlZF0nKS52YWx1ZTtcbiAgICAgIHZhciBidWlsZGVySnNvbiA9IEpTT04ucGFyc2UoanNvblN0cmluZyk7XG4gICAgICB2YXIgcGF5bG9hZCA9IHtcbiAgICAgICAgYnVpbGRlckpzb246IGJ1aWxkZXJKc29uXG4gICAgICB9O1xuXG4gICAgICBzdG9yZS5kaXNwYXRjaChzdG9yZS5hY3Rpb25UeXBlcy5DSEFOR0VfUEVSU09OQV9CVUlMREVSLCBwYXlsb2FkKTsgLy9kaXNwYXRjaCB0byBzdGF0ZVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdidWlsZGVyLWNvbWJvLnNhdmVTdGF0ZScsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogZnVuY3Rpb24gdG8gZ2V0IHRoZSBidWlsZGVyLXdyYXBwZXIgdGFyZ2V0IGluIERPTVxuICAgKiBAcmV0dXJuIHtFbGVtZW50fSAtIHRhcmdldCBlbGVtZW50IGluIHRoZSBET01cbiAgICovXG4gIGZ1bmN0aW9uIGdldFRhcmdldCgpIHtcbiAgICB2YXIgdGFyZ2V0ID0gbnVsbDtcbiAgICB0cnkge1xuICAgICAgdGFyZ2V0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2J1aWxkZXItd3JhcHBlci10YXJnZXRdJyk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ2J1aWxkZXItd3JhcHBlci5nZXRUYXJnZXQnLCBlcnJvcik7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHJldHVybiB0YXJnZXQ7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIGZ1bmN0aW9uIHRvIGluc2VydCB0aGUgaHRtbCBpbnRvIGJ1aWxkZXIgaHRtbFxuICAgKiBAcGFyYW0ge3N0cmluZ30gLSBodG1sIGFzIHN0cmluZ1xuICAgKi9cbiAgZnVuY3Rpb24gaW5zZXJ0SW50b0RvbShodG1sKSB7XG4gICAgdHJ5IHtcbiAgICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnB1YignYnVpbGRlci13cmFwcGVyLmJlZm9yZS5yZW5kZXJlZCcsIHt9KTtcblxuICAgICAgdmFyIGJ1aWxkZXJUYXJnZXQgPSBnZXRUYXJnZXQoKTtcbiAgICAgIGJ1aWxkZXJUYXJnZXQuaW5uZXJIVE1MID0gaHRtbDtcbiAgICAgIHN0YXRlLmJ1aWxkZXJPblRoZURvbSA9IHRydWU7IC8vc2V0IGFzIHRoZSBidWlsZGVyIGlzIG9uIHRoZSBkb21cbiAgICAgIHVwZGF0ZVN0b3JlKCk7IC8vZGlzcGF0Y2ggZG93bmxvYWRlZCB0YXJnZXRcbiAgICAgIG5vdGlmeU11bHRpT3B0aW9ucygpO1xuICAgICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIucHViKCdjYWxsVG9BY3Rpb24uaGlkZS5tYWluLWJ1dHRvbicsIHRydWUpOyAvL2hpZGUgbWFpbiBidXkgYnV0dG9uXG4gICAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ2J1aWxkZXItd3JhcHBlci5hZnRlci5yZW5kZXJlZCcsIHt9KTtcbiAgICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnB1YignbW9kYWwucmVzdGFydCcpOyAvL3JlaW5pdCBtb2RhbFxuICAgICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIucHViKCdTbGlkZVB1c2gucmVzdGFydCcsICdwZXJzb25hbGl6YXRpb24tcGFnZS1wcmV2aWV3Jyk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ2J1aWxkZXItd3JhcHBlci5pbnNlcnRJbnRvRG9tJywgZXJyb3IpO1xuICAgICAgc3RhdGUuYnVpbGRlck9uVGhlRG9tID0gZmFsc2U7XG4gICAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ2NhbGxUb0FjdGlvbi5oaWRlLm1haW4tYnV0dG9uJywgZmFsc2UpOyAvL3Nob3cgbWFpbiBidXkgYnV0dG9uXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIGZ1bmN0aW9uIHRvIG5vdGlmeSBpZiBtdWx0aSBvcHRpb25zIGlzIHRydWUgaW4gdGhlIGN1cnJlbnQgc3RlcCAodGhlIGZpcnN0IG9ubHkpXG4gICAqL1xuICBmdW5jdGlvbiBub3RpZnlNdWx0aU9wdGlvbnMoKSB7XG4gICAgdHJ5IHtcbiAgICAgIHZhciBzdGVwcyA9IHN0b3JlLmdldFN0YXRlKFsncGRwJywgJ3BlcnNvbmEnLCAnYnVpbGRlcicsICdidWlsZGVySnNvbicsICdzdGVwcyddKVxuICAgICAgICwgY3VyclN0ZXAgPSBzdGVwcyA/IHN0ZXBzWzBdIDogbnVsbDsgLy9vbmx5IHRoZSBmaXJzdCBzdGVwXG5cbiAgICAgIGlmKGN1cnJTdGVwICYmIGN1cnJTdGVwLm11bHRpT3B0aW9ucykge1xuICAgICAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ2J1aWxkZXItd3JhcHBlci5vcGVuLm11bHRpLW9wdGlvbnMnLCB7fSk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ2J1aWxkZXItd3JhcHBlci5ub3RpZnlNdWx0aU9wdGlvbnMnLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIGZ1bmN0aW9uIHRvIG1ha2UgdGhlIHJlcXVlc3RvIHRvIGFwaSBhbmQgYnJpbmcgdGhlIGJ1aWxkZXJcbiAgICovXG4gIGZ1bmN0aW9uIGdldEJ1aWxkZXIoY2FsbGJhY2spIHtcbiAgICB0cnkge1xuICAgICAgdmFyIGltZ1VybEVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2J1aWxkZXItd3JhcHBlci1pbWFnZS1wcmV2aWV3XScpO1xuICAgICAgdmFyIGltZ1VybCA9IGltZ1VybEVsID8gaW1nVXJsRWwudmFsdWUgOiBudWxsO1xuICAgICAgdmFyIHByb2R1Y3RTa3UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1wcm9kdWN0LXNrdV0nKS5nZXRBdHRyaWJ1dGUoJ2RhdGEtcHJvZHVjdC1za3UnKTtcbiAgICAgIHZhciBzZWxsZXJJZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1twcm9kdWN0LWRhdGEtc2VsbGVyXScpLmdldEF0dHJpYnV0ZSgncHJvZHVjdC1kYXRhLXNlbGxlcicpO1xuXG4gICAgICB3aW5kb3cuZnJlZWRvbS5yZXN0Q2xpZW50LnJlcXVlc3QoJy9wZXJzb25hbGl6YXRpb24vZ2V0LWJ1aWxkZXInLCB7XG4gICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgaW1hZ2U6IGltZ1VybCxcbiAgICAgICAgICBza3U6IHByb2R1Y3RTa3UsXG4gICAgICAgICAgc2VsbGVySWQ6IHNlbGxlcklkXG4gICAgICAgIH0sXG4gICAgICAgIGNvbXBsZXRlOiBjYWxsYmFja1xuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ2J1aWxkZXItd3JhcHBlci5nZXRCdWlsZGVyJywgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBmdW5jdGlvbiB0byBmZXRjaCB0aGUgc3RhdHVzIG9mIGJ1aWxkZXIgb24gdGhlIGRvbVxuICAgKi9cbiAgZnVuY3Rpb24gZmV0Y2hCdWlsZGVyT25UaGVEb20oKSB7XG4gICAgdHJ5IHtcbiAgICAgIHN0YXRlLmJ1aWxkZXJPblRoZURvbSA9ICEhIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tidWlsZGVyLWNvbnRhaW5lcl0nKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignYnVpbGRlci13cmFwcGVyLmZldGNoQnVpbGRlck9uVGhlRG9tJywgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBmdW5jdGlvbiB0byBjaGVjayBpZiB0aGUgdGFyZ2V0IGlzIGluIHRoZSBET00gY2FsbCB0aGUgZnVuY3Rpb25cbiAgICovXG4gIGZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICB0cnkge1xuICAgICAgZmV0Y2hCdWlsZGVyT25UaGVEb20oKTtcbiAgICAgIC8vaWYgZXhpc3RzIHRoZSB0YXJnZXQgZGl2IGFuZCB0aGUgYnVpbGRlciB3YXNudCByZW5kZXJlZFxuICAgICAgaWYoZ2V0VGFyZ2V0KCkgJiYgIXN0YXRlLmJ1aWxkZXJPblRoZURvbSAmJiAhc3RhdGUuZmV0Y2hpbmcpIHtcblxuICAgICAgICBzdGF0ZS5mZXRjaGluZyA9IHRydWU7Ly9zZXQgYXMgZG93bmxvYWRpbmcgdGhlIGJ1aWxkZXIgdG8gdHdpY2UgY2FsbFxuICAgICAgICBoYW5kbGVMb2FkZXIoJ3Nob3cnKTsgLy9zaG93IHRoZSBsb2FkZXJcblxuICAgICAgICBnZXRCdWlsZGVyKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgc3RhdGUuZmV0Y2hpbmcgPSBmYWxzZTtcbiAgICAgICAgICBoYW5kbGVMb2FkZXIoJ2hpZGUnKTsgLy9oaWRlIHRoZSBsb2FkZXJcblxuICAgICAgICAgIGlmKHR5cGVvZiByZXNwb25zZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIGluc2VydEludG9Eb20ocmVzcG9uc2UpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ2J1aWxkZXItd3JhcHBlci5yZW5kZXInLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIGZ1bmN0aW9uIHRvIHJlbmRlciB0aGUgYnVpbGRlciBvbiBwYWdlIGxvYWRcbiAgICogYXMgbG9uZyBhcyB0aGUgcGVyc29uYWxpemF0aW9uIGlzIG9wZW5lZFxuICAgKi9cbiAgZnVuY3Rpb24gcmVuZGVyT25Mb2FkKCkge1xuICAgIHRyeSB7XG4gICAgICBpZihwZXJzb25hU3RhdGUub3Blbikge1xuICAgICAgICByZW5kZXIoKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignYnVpbGRlci13cmFwcGVyLnJlbmRlck9uTG9hZCcsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogZnVuY3Rpb24gdG8gc2V0IHRoZSBidWlsZGVyIGFzIG5vIHJlbmRlcmVkXG4gICAqL1xuICBmdW5jdGlvbiBzZXRCdWlsZGVyTm9WaXNpYmxlKCkge1xuICAgIHRyeSB7XG4gICAgICBzdGF0ZS5idWlsZGVyT25UaGVEb20gPSBmYWxzZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignYnVpbGRlci13cmFwcGVyLnNldEJ1aWxkZXJOb1Zpc2libGUnLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIGZ1bmN0aW9uIHRvIG1hbmlwdWxhdGUgdGhlIHBlcnNvbmEgc3RhdGUgcmVmXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gb3BlbiAtIHBlcnNvbmEgc3RhdGVcbiAgICovXG4gIGZ1bmN0aW9uIGhhbmRsZVBlcnNvbmFTdGF0ZShvcGVuKSB7XG4gICAgdHJ5IHtcbiAgICAgIGlmKG9wZW4gJiYgc3RhdGUuYnVpbGRlck9uVGhlRG9tKSB7IC8vaWYgaXMgb3BlbmluZyBhbmQgYnVpbGRlciBpcyBvbiB0aGUgc2NyZWVuXG4gICAgICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnB1YignY2FsbFRvQWN0aW9uLmhpZGUubWFpbi1idXR0b24nLCB0cnVlKTsgLy9oaWRlIG1haW4gYnV5IGJ1dHRvblxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIucHViKCdjYWxsVG9BY3Rpb24uaGlkZS5tYWluLWJ1dHRvbicsIGZhbHNlKTsgLy9zaG93IG1haW4gYnV5IGJ1dHRvblxuICAgICAgfVxuXG4gICAgICBwZXJzb25hU3RhdGUub3BlbiA9IG9wZW47XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ2J1aWxkZXItd3JhcHBlci5oYW5kbGVQZXJzb25hU3RhdGUnLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIGZ1bmN0aW9uIHRvIHRvZ2dsZSB0aGUgbG9hZGVyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBhY3Rpb24gYWN0aW9uIHRvIGFjdGl2ZSBvciBoaWRlIGxvYWRlclxuICAgKi9cbiAgZnVuY3Rpb24gaGFuZGxlTG9hZGVyKGFjdGlvbikge1xuICAgIHRyeSB7XG4gICAgICB2YXIgbG9hZGVyRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbYnVpbGRlci13cmFwcGVyLWxvYWRlcl0nKTtcbiAgICAgIGlmKGxvYWRlckVsKSB7XG4gICAgICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnB1Yignc3Bpbi5sb2FkaW5nLmFuaW1hdGUnLGxvYWRlckVsLCBhY3Rpb24pO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdidWlsZGVyLXdyYXBwZXIuaGFuZGxlUGVyc29uYVN0YXRlJywgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnN1YigncGVyc29uYWxpemF0aW9uLm9wZW4uYWZ0ZXInLCByZW5kZXIpOyAvL2FmdGVyIHRoZSBwZXJzb25hbGl6YXRpb24gb3BlbiBldmVudCByZW5kZXIgdGhlIGJ1aWxkZXJcbiAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIuc3ViKCdwZXJzb25hbGl6YXRpb24uZm9ybS5jaGFuZ2VPcGVuQ2xvc2VkJywgaGFuZGxlUGVyc29uYVN0YXRlKTsgLy90byBrbm93IHdoZW4gdGhlIHBlcnNvbmEgaXMgb3BlbmVkIG9yIGNsb3NlZFxuICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5zdWIoJ2NvbG9yLWZsYXZvci1zaXplLmNoYW5nZUh0bWwuYmVmb3JlJywgc2V0QnVpbGRlck5vVmlzaWJsZSk7IC8vYmVmb3JlIHRoZSBodG1sIGlzIGNoYW5nZWQgc2V0IGFzIG5vIHZpc2libGUgdGhlIGJ1aWxkZXJcbiAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIuc3ViKCdjb2xvci1mbGF2b3Itc2l6ZS5jaGFuZ2VIdG1sLmFmdGVyJywgcmVuZGVyT25Mb2FkKTsgLy9yZW5kZXIgYWZ0ZXIgaHRtbCBjaGFuZ2UgZXZlbnQgKHRoZSB2YWxpZGF0aW9uIHdpbGwgYWxsb3cgb3Igbm90IHRoZSByZW5kZXIgaW4gdGhpcyB0aW1lKVxuXG59KCkpO1xuIl19
