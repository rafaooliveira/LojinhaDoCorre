"use strict";var appZipCode=function(){function e(){var e=document.querySelector(".zip__code-user--button");if(e){var t=window.location.pathname||"",o=window.location.search||"";t&&"/"!==t?e.href="/login?redirect="+t+o:e.href="/login"}}var t={form:"[data-zip-code-form",input:"[data-zip-code-input]",btn_submit:"[data-zip-code-submit]",err_class:".zip__code-err",fail_class:".zip__code-fail-err",empty_class:".zip__code-empty",container:".zipcode-content .zip__code--container",box_input:".zip__code-box",overlay:"overlay.display",tooltip:".zip__code--tooltip",login:".zip__code-user"},o=document.querySelector("section[data-free-shipping-by-zipcode]"),n=document.querySelector("section[data-get-zipcode-info]"),c=dataLayer[0].page?dataLayer[0].page.pageID.toLowerCase():"others",i=function(){document.querySelector(t.input).addEventListener("keyup",function(e){var t=e.target.value.replace(/[^\d]+/g,"");t=t.replace(/(\d{5})(\d)/,"$1-$2"),e.target.value=t})},r=function(e){document.querySelector(t.input).value=e.replace(/(\d{5})(\d)/,"$1-$2")},u=function(){return document.querySelector("html").getAttribute("lang")},d=function(e){return e.replace(/(\d{5})(\d)/,"$1-$2")},s=function(e){var t=document.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)");return t?t[2]:null},a=function(){var e="";return e=null!==s("zipcode")?s("zipcode"):document.querySelector(t.input).value,d(e)},l=function(e){document.querySelector(".text").classList.add("hide");var t=document.querySelector(".text__sucess"),o=t.querySelector("span");o&&(o.innerText=d(e)),t.classList.remove("hide"),document.querySelector(".zipcode-content__block--text")?(document.querySelector(".zipcode-content__block--text").innerHTML='Enviar para: <span class="zipcode-value">'+d(e)+"</span>",document.querySelector(".zipcode-content__block--text").classList.add("filled")):document.querySelector(".zipcode-content__text").innerHTML="Enviar para <span class='zipcode-value'>"+d(e)+"</span>"},p=function(){var e=document.querySelector(t.input),o=document.querySelector(t.login);e.closest(".zip__code-box").classList.add("hide"),o.classList.add("hide"),e=e.value.replace(/[^\d]+/g,"");var n=document.querySelector(t.btn_submit),c=n?n.querySelector("span"):null;c&&(c.innerText="OK");var i=new Date;i.setMonth(i.getMonth()+1);var r="expires="+i.toUTCString();document.cookie="zipcode="+e+";"+r+";path=/",window.freedom.nsPubSub.pub("zipcodeCookie.reinit"),l(e)},m=function(e){e?""!==document.querySelector(t.input).value?(document.querySelector(t.err_class).classList.remove("hide"),document.querySelector(t.empty_class).classList.add("hide"),document.querySelector(t.fail_class).classList.add("hide")):(document.querySelector(t.err_class).classList.add("hide"),document.querySelector(t.fail_class).classList.add("hide"),document.querySelector(t.empty_class).classList.remove("hide")):(document.querySelector(t.err_class).classList.add("hide"),document.querySelector(t.empty_class).classList.add("hide"),document.querySelector(t.fail_class).classList.add("hide"),p())},b=function(e,t){if(""!==e){var o=e.replace(/\D/g,""),n=/^[0-9]{8}$/;return"es-AR"===t?n=/^[0-9]{4}$/:"es-MX"===t&&(n=/^[0-9]{5}$/),n.test(o)}return!1},S=function(){""!==document.querySelector(t.input).value?document.querySelector(t.box_input+" label").classList.remove("hide"):document.querySelector(t.box_input+" label").classList.add("hide")},y=!0,_=function(){y&&(y=!1,document.querySelector(t.input).addEventListener("input",function(){S()}),document.querySelector(t.input).addEventListener("blur",function(){S()}))},f=function(e){var o=document.querySelector(t.btn_submit),n=o?o.querySelector("span"):null;s("zipcode")?n&&(n.innerText="Alterar"):n&&(n.innerText="Consultar"),document.querySelector(".text__sucess").classList.add("hide"),document.querySelector(".text").classList.remove("hide"),document.querySelector(".zip__code-box").classList.remove("hide"),document.querySelector(t.input).setAttribute("value",a()),document.querySelector(t.box_input+" label").classList.remove("hide"),s("uname")?document.querySelector(t.login).classList.add("hide"):document.querySelector(t.login).classList.remove("hide"),e?document.querySelector(".zip__code--rules").classList.remove("hide"):document.querySelector(".zip__code--rules").classList.add("hide"),window.freedom.nsPubSub.pub(t.overlay,"show"),document.querySelector(t.container).classList.remove("hide")},v=function(){document.querySelector(".zipcode-content__block").addEventListener("click",function(){e(),f()});var i=function(){var e=document.querySelector("button[data-zip-code-submit] span");document.querySelector(t.container).classList.add("hide"),window.freedom.nsPubSub.pub(t.overlay,"hide"),e&&(e.innerText="ALTERAR"),document.querySelector(t.tooltip)&&(document.querySelector(t.tooltip).classList.remove("hide"),setTimeout(function(){document.querySelector(t.tooltip).classList.add("hide")},5e3))};document.querySelector(t.btn_submit).addEventListener("click",function(e){var r=this.querySelector(".text");if(e.preventDefault(),e.stopPropagation(),r&&"OK"===r.innerText){if(i(),o||n){var d=s("zipcode");window.zipcodeAPIsAjax=!1,window.freedom.nsPubSub.pub("nsLoading.show",document.body),window.FREESHIPPING_BANNER_CUSTOM_ACTION&&window.freedom.nsPubSub.pub("customBannerAction.zipcodeChanged"),window.freedom.nsPubSub.pub("checkFreeShippingEligibility",d),window.freedom.nsPubSub.pub("getZipcodeFullInfo",d),"product"===c&&window.freedom.nsPubSub.pub("Shipping.restart")}}else{var a=document.querySelector(t.input).value,l=u();m(b(a,l)?!1:!0)}}),window.freedom.live("#overlay","click",function(){var e=document.querySelector(".zip__code--calculate .text");if(window.freedom.nsPubSub.pub(t.overlay,"hide"),document.querySelector(t.container).classList.add("hide"),e&&"OK"===e.innerText&&(o||n)){var i=s("zipcode");window.zipcodeAPIsAjax=!1,window.freedom.nsPubSub.pub("nsLoading.show",document.body),window.FREESHIPPING_BANNER_CUSTOM_ACTION&&window.freedom.nsPubSub.pub("customBannerAction.zipcodeChanged"),window.freedom.nsPubSub.pub("checkFreeShippingEligibility",i),window.freedom.nsPubSub.pub("getZipcodeFullInfo",i),"product"===c&&window.freedom.nsPubSub.pub("Shipping.restart")}}),window.freedom.live(t.input,"click",function(){_()})};try{if(v(),i(),s("zipcode")){var h=s("zipcode");l(h)}window.freedom.nsPubSub.sub("changeHeaderZipcode",l),window.freedom.nsPubSub.sub("changeHeaderZipcode",r),window.freedom.nsPubSub.sub("insertZipcode.showModal",f)}catch(q){console.error("ERROR | Shipping "+q)}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl9yZWZhY3RvcmluZy9fY29tcG9uZW50cy9pbnNlcnQtemlwLWNvZGUvYWxsL2luc2VydC16aXAtY29kZS5taW4uanMiXSwibmFtZXMiOlsiYXBwWmlwQ29kZSIsInNldFVybExvZ2luIiwibG9naW5CdG4iLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJwYXRoIiwid2luZG93IiwibG9jYXRpb24iLCJwYXRobmFtZSIsInNlYXJjaCIsImhyZWYiLCIkZWxlbSIsImZvcm0iLCJpbnB1dCIsImJ0bl9zdWJtaXQiLCJlcnJfY2xhc3MiLCJmYWlsX2NsYXNzIiwiZW1wdHlfY2xhc3MiLCJjb250YWluZXIiLCJib3hfaW5wdXQiLCJvdmVybGF5IiwidG9vbHRpcCIsImxvZ2luIiwiY2hlY2tGcmVlU2hpcHBpbmdFbmFibGVkIiwiZ2V0WmlwY29kZUluZm9FbmFibGVkIiwicGFnZVR5cGUiLCJkYXRhTGF5ZXIiLCJwYWdlIiwicGFnZUlEIiwidG9Mb3dlckNhc2UiLCJhcHBseUlucHV0TWFrcyIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwic3RyIiwidGFyZ2V0IiwidmFsdWUiLCJyZXBsYWNlIiwidXBkYXRlSW5wdXRWYWx1ZSIsInppcGNvZGUiLCJnZXRDb3VudHJ5IiwiZ2V0QXR0cmlidXRlIiwiZm9ybWF0WmlwQ29kZSIsImdldENvb2tpZSIsImNrbmFtZSIsImNvb2tpZSIsIm1hdGNoIiwiZ2V0WmlwQ29kZSIsIm1lc3NhZ2VTdWNlc3MiLCJjbGFzc0xpc3QiLCJhZGQiLCJtc2dzdWNlc3MiLCJzcGFuIiwiaW5uZXJUZXh0IiwicmVtb3ZlIiwiaW5uZXJIVE1MIiwic2V0WmlwQ29kZSIsImxvZ2luTGluayIsImNsb3Nlc3QiLCJidG4iLCJkYXRlIiwiRGF0ZSIsInNldE1vbnRoIiwiZ2V0TW9udGgiLCJleHBpcmVzIiwidG9VVENTdHJpbmciLCJmcmVlZG9tIiwibnNQdWJTdWIiLCJwdWIiLCJ2YWxpZGF0aW9uQ2FsbGJhY2siLCJlcnJvciIsInZhbGlkYXRlWmlwY29kZSIsInoiLCJjIiwicmVnZXgiLCJ0ZXN0IiwiaGlkZU9yU2hvd0xhYmVsIiwiYXV4U2V0Rm9jdXMiLCJvbmZvY3VzIiwic2hvd01vZGFsIiwiYmFubmVyQ2xpY2tlZCIsInNldEF0dHJpYnV0ZSIsInNldExpc3RlbmVycyIsImNsb3NlRm9ybSIsInNldFRpbWVvdXQiLCJ0ZXh0RWwiLCJ0aGlzIiwicHJldmVudERlZmF1bHQiLCJzdG9wUHJvcGFnYXRpb24iLCJ6aXAiLCJ6aXBjb2RlQVBJc0FqYXgiLCJib2R5IiwiRlJFRVNISVBQSU5HX0JBTk5FUl9DVVNUT01fQUNUSU9OIiwiY291bnRyeSIsImxpdmUiLCJzdWIiLCJlcnIiLCJjb25zb2xlIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUVBLElBQUlBLFlBQWMsV0ErUGhCLFFBQVNDLEtBQ1AsR0FBSUMsR0FBV0MsU0FBU0MsY0FBYywwQkFDdEMsSUFBSUYsRUFBVSxDQUNaLEdBQUlHLEdBQU9DLE9BQU9DLFNBQVNDLFVBQVksR0FDbkNDLEVBQVNILE9BQU9DLFNBQVNFLFFBQVUsRUFFbkNKLElBQWlCLE1BQVRBLEVBQ1ZILEVBQVNRLEtBQU8sbUJBQXFCTCxFQUFPSSxFQUU1Q1AsRUFBU1EsS0FBTyxVQXRRdEIsR0FBSUMsSUFDRkMsS0FBTSxzQkFDTkMsTUFBTyx3QkFDUEMsV0FBWSx5QkFDWkMsVUFBVyxpQkFDWEMsV0FBWSxzQkFDWkMsWUFBYSxtQkFDYkMsVUFBVyx5Q0FDWEMsVUFBVyxpQkFDWEMsUUFBUyxrQkFDVEMsUUFBUyxzQkFDVEMsTUFBTyxtQkFFTEMsRUFBMkJwQixTQUFTQyxjQUFjLDBDQUNwRG9CLEVBQXdCckIsU0FBU0MsY0FBYyxrQ0FDL0NxQixFQUFZQyxVQUFVLEdBQU8sS0FBSUEsVUFBVSxHQUFHQyxLQUFLQyxPQUFPQyxjQUFnQixTQU94RUMsRUFBaUIsV0FDbkIzQixTQUFTQyxjQUFjTyxFQUFNRSxPQUFPa0IsaUJBQWlCLFFBQVMsU0FBVUMsR0FDdEUsR0FBSUMsR0FBTUQsRUFBRUUsT0FBT0MsTUFBTUMs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bmcvX2NvbXBvbmVudHMvaW5zZXJ0LXppcC1jb2RlL2FsbC9pbnNlcnQtemlwLWNvZGUubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG52YXIgYXBwWmlwQ29kZSA9IChmdW5jdGlvbiAoKSB7XG4gIC8vIHNlbGV0b3Jlc1xuICB2YXIgJGVsZW0gPSB7XG4gICAgZm9ybTogJ1tkYXRhLXppcC1jb2RlLWZvcm0nLFxuICAgIGlucHV0OiAnW2RhdGEtemlwLWNvZGUtaW5wdXRdJyxcbiAgICBidG5fc3VibWl0OiAnW2RhdGEtemlwLWNvZGUtc3VibWl0XScsXG4gICAgZXJyX2NsYXNzOiAnLnppcF9fY29kZS1lcnInLFxuICAgIGZhaWxfY2xhc3M6ICcuemlwX19jb2RlLWZhaWwtZXJyJyxcbiAgICBlbXB0eV9jbGFzczogJy56aXBfX2NvZGUtZW1wdHknLFxuICAgIGNvbnRhaW5lcjogJy56aXBjb2RlLWNvbnRlbnQgLnppcF9fY29kZS0tY29udGFpbmVyJyxcbiAgICBib3hfaW5wdXQ6ICcuemlwX19jb2RlLWJveCcsXG4gICAgb3ZlcmxheTogJ292ZXJsYXkuZGlzcGxheScsXG4gICAgdG9vbHRpcDogJy56aXBfX2NvZGUtLXRvb2x0aXAnLFxuICAgIGxvZ2luOiAnLnppcF9fY29kZS11c2VyJ1xuICB9O1xuICB2YXIgY2hlY2tGcmVlU2hpcHBpbmdFbmFibGVkID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcignc2VjdGlvbltkYXRhLWZyZWUtc2hpcHBpbmctYnktemlwY29kZV0nKSxcbiAgICBnZXRaaXBjb2RlSW5mb0VuYWJsZWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdzZWN0aW9uW2RhdGEtZ2V0LXppcGNvZGUtaW5mb10nKSxcbiAgICBwYWdlVHlwZSA9IChkYXRhTGF5ZXJbMF0ucGFnZSkgPyBkYXRhTGF5ZXJbMF0ucGFnZS5wYWdlSUQudG9Mb3dlckNhc2UoKSA6ICdvdGhlcnMnO1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIGFwcGx5SW5wdXRNYWtzXG4gICAqIGFwcGx5IHppcGNvZGUgbWFzayAwMDAwMC0wMDBcbiAgICogQHJldHVybiB7fVxuICAgKi9cbiAgdmFyIGFwcGx5SW5wdXRNYWtzID0gZnVuY3Rpb24gKCkge1xuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJGVsZW0uaW5wdXQpLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIHZhciBzdHIgPSBlLnRhcmdldC52YWx1ZS5yZXBsYWNlKC9bXlxcZF0rL2csICcnKTtcbiAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKC8oXFxkezV9KShcXGQpLywgXCIkMS0kMlwiKTtcbiAgICAgIGUudGFyZ2V0LnZhbHVlID0gc3RyO1xuICAgIH0pO1xuICB9O1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIHVwZGF0ZUlucHV0VmFsdWVcbiAgICogYXBwbHkgemlwY29kZSBtYXNrIDAwMDAwLTAwMFxuICAgKiBAcmV0dXJuIHt9XG4gICAqL1xuICB2YXIgdXBkYXRlSW5wdXRWYWx1ZSA9IGZ1bmN0aW9uICh6aXBjb2RlKSB7XG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigkZWxlbS5pbnB1dCkudmFsdWUgPSB6aXBjb2RlLnJlcGxhY2UoLyhcXGR7NX0pKFxcZCkvLCBcIiQxLSQyXCIpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIGdldENvdW50cnlcbiAgICogZ2V0IGNvdW50cnlcbiAgICogQHJldHVybiB7c3RyaW5nfSBbY291bnRyeV1cbiAgICovXG4gIHZhciBnZXRDb3VudHJ5ID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdodG1sJykuZ2V0QXR0cmlidXRlKCdsYW5nJyk7XG4gIH07XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgZm9ybWF0WmlwQ29kZVxuICAgKiByZXR1cm4gemlwY29kZSBmb3JtYXQgMDAwMDAtMDAwXG4gICAqIEByZXR1cm4ge3N0cmluZ31cbiAgICovXG4gIHZhciBmb3JtYXRaaXBDb2RlID0gZnVuY3Rpb24gKHppcGNvZGUpIHtcbiAgICByZXR1cm4gemlwY29kZS5yZXBsYWNlKC8oXFxkezV9KShcXGQpLywgXCIkMS0kMlwiKTtcbiAgfTtcblxuICAvKipcbiAgICogQG1ldGhvZCBnZXRDb29raWVcbiAgICogZ2V0IGNvb2tpZSBieSBuYW1lXG4gICAqIEByZXR1cm4ge3N0cmluZ30gW3ppcGNvZGVdXG4gICAqL1xuICB2YXIgZ2V0Q29va2llID0gZnVuY3Rpb24gKGNrbmFtZSkge1xuICAgIHZhciB6aXBjb2RlID0gZG9jdW1lbnQuY29va2llLm1hdGNoKCcoXnw7KSA/JyArIGNrbmFtZSArICc9KFteO10qKSg7fCQpJyk7XG4gICAgcmV0dXJuIHppcGNvZGUgPyB6aXBjb2RlWzJdIDogbnVsbDtcbiAgfTtcblxuICAvKipcbiAgICogQG1ldGhvZCBnZXRaaXBDb2RlXG4gICAqIGdldCB6aXBjb2RlXG4gICAqIEByZXR1cm4ge3N0cmluZ30gW3ppcGNvZGVdXG4gICAqL1xuICB2YXIgZ2V0WmlwQ29kZSA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgemlwY29kZSA9ICcnO1xuXG4gICAgaWYgKGdldENvb2tpZSgnemlwY29kZScpICE9PSBudWxsKSB7XG4gICAgICB6aXBjb2RlID0gZ2V0Q29va2llKCd6aXBjb2RlJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHppcGNvZGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCRlbGVtLmlucHV0KS52YWx1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gZm9ybWF0WmlwQ29kZSh6aXBjb2RlKTtcbiAgfTtcblxuICAvKipcbiAgICogQG1ldGhvZCBtZXNzYWdlU3VjZXNzXG4gICAqIHNob3cgYm94IHN1Y2VzcyBtZXNzYWdlXG4gICAqIEByZXR1cm4ge31cbiAgICovXG4gIHZhciBtZXNzYWdlU3VjZXNzID0gZnVuY3Rpb24gKHppcGNvZGUpIHtcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudGV4dCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcblxuICAgIHZhciBtc2dzdWNlc3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudGV4dF9fc3VjZXNzJyk7XG4gICAgdmFyIHNwYW4gPSBtc2dzdWNlc3MucXVlcnlTZWxlY3Rvcignc3BhbicpO1xuXG4gICAgaWYgKHNwYW4pIHtcbiAgICAgIHNwYW4uaW5uZXJUZXh0ID0gZm9ybWF0WmlwQ29kZSh6aXBjb2RlKTtcbiAgICB9XG5cbiAgICBtc2dzdWNlc3MuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpO1xuICAgIGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuemlwY29kZS1jb250ZW50X19ibG9jay0tdGV4dCcpKSB7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuemlwY29kZS1jb250ZW50X19ibG9jay0tdGV4dCcpLmlubmVySFRNTCA9ICdFbnZpYXIgcGFyYTogPHNwYW4gY2xhc3M9XCJ6aXBjb2RlLXZhbHVlXCI+JyArIGZvcm1hdFppcENvZGUoemlwY29kZSkgKyAnPC9zcGFuPic7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuemlwY29kZS1jb250ZW50X19ibG9jay0tdGV4dCcpLmNsYXNzTGlzdC5hZGQoJ2ZpbGxlZCcpO1xuICAgIH0gZWxzZSB7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuemlwY29kZS1jb250ZW50X190ZXh0JykuaW5uZXJIVE1MID0gXCJFbnZpYXIgcGFyYSA8c3BhbiBjbGFzcz0nemlwY29kZS12YWx1ZSc+XCIgKyBmb3JtYXRaaXBDb2RlKHppcGNvZGUpICsgJzwvc3Bhbj4nO1xuICAgIH1cbiAgfTtcblxuICAvKipcbiAgICogQG1ldGhvZCBzZXRaaXBDb2RlXG4gICAqIHNhdmUgY29va2llIHppcGNvZGVcbiAgICogQHJldHVybiB7fVxuICAgKi9cbiAgdmFyIHNldFppcENvZGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHppcGNvZGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCRlbGVtLmlucHV0KSxcbiAgICAgIGxvZ2luTGluayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJGVsZW0ubG9naW4pO1xuICAgIHppcGNvZGUuY2xvc2VzdCgnLnppcF9fY29kZS1ib3gnKS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG4gICAgbG9naW5MaW5rLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICB6aXBjb2RlID0gemlwY29kZS52YWx1ZS5yZXBsYWNlKC9bXlxcZF0rL2csICcnKTtcbiAgICB2YXIgYnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigkZWxlbS5idG5fc3VibWl0KTtcbiAgICB2YXIgc3BhbiA9IGJ0biA/IGJ0bi5xdWVyeVNlbGVjdG9yKCdzcGFuJykgOiBudWxsO1xuXG4gICAgaWYgKHNwYW4pIHtcbiAgICAgIHNwYW4uaW5uZXJUZXh0ID0gJ09LJztcbiAgICB9XG5cbiAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgZGF0ZS5zZXRNb250aChkYXRlLmdldE1vbnRoKCkgKyAxKTtcbiAgICB2YXIgZXhwaXJlcyA9ICdleHBpcmVzPScgKyBkYXRlLnRvVVRDU3RyaW5nKCk7XG4gICAgZG9jdW1lbnQuY29va2llID0gJ3ppcGNvZGUnICsgJz0nICsgemlwY29kZSArICc7JyArIGV4cGlyZXMgKyAnO3BhdGg9Lyc7XG5cbiAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ3ppcGNvZGVDb29raWUucmVpbml0Jyk7XG5cbiAgICBtZXNzYWdlU3VjZXNzKHppcGNvZGUpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIHZhbGlkYXRpb25DYWxsYmFja1xuICAgKiBjaGVjayBmb3IgZmllbGQgZXJyb3JcbiAgICogQHBhcmFtICB7Ym9vbGVhbn0gZXJyb3JcbiAgICogQHJldHVybiB7fVxuICAgKi9cbiAgdmFyIHZhbGlkYXRpb25DYWxsYmFjayA9IGZ1bmN0aW9uIChlcnJvcikge1xuICAgIGlmIChlcnJvcikge1xuICAgICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJGVsZW0uaW5wdXQpLnZhbHVlICE9PSBcIlwiKSB7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJGVsZW0uZXJyX2NsYXNzKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJyk7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJGVsZW0uZW1wdHlfY2xhc3MpLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigkZWxlbS5mYWlsX2NsYXNzKS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG5cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJGVsZW0uZXJyX2NsYXNzKS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJGVsZW0uZmFpbF9jbGFzcykuY2xhc3NMaXN0LmFkZCgnaGlkZScpO1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCRlbGVtLmVtcHR5X2NsYXNzKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJyk7XG4gICAgICB9XG5cbiAgICB9IGVsc2Uge1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigkZWxlbS5lcnJfY2xhc3MpLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJGVsZW0uZW1wdHlfY2xhc3MpLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJGVsZW0uZmFpbF9jbGFzcykuY2xhc3NMaXN0LmFkZCgnaGlkZScpO1xuICAgICAgc2V0WmlwQ29kZSgpO1xuICAgIH1cbiAgfTtcblxuICAvKipcbiAgICogQG1ldGhvZCB2YWxpZGF0ZVppcGNvZGVcbiAgICogdGVzdCB0byB2YWxpZGF0ZSBpZiB0aGUgaW5wdXQgemlwY29kZSBpcyB2YWxpZCBhY2NvcmRpbmcgdG8gdGhlIG51bWJlciBvZiBjaGFyYWN0ZXJzXG4gICAqIEBwYXJhbSAge3N0cmluZ30geiBbemlwY29kZV1cbiAgICogQHBhcmFtICB7c3RyaW5nfSBjIFtjb3VudHJ5XVxuICAgKiBAcmV0dXJuIHtib29sZWFufSBbdHJ1ZSBvciBmYWxzZV1cbiAgICovXG4gIHZhciB2YWxpZGF0ZVppcGNvZGUgPSBmdW5jdGlvbiAoeiwgYykge1xuICAgIGlmICh6ICE9PSAnJykge1xuICAgICAgLy8gUmVtb3ZlcyBhbnkgY2hhcmFjdGVyIHRoYXQgaXMgbm90IGEgZGlnaXQgY2hhcmFjdGVyICgwLTkpXG4gICAgICB2YXIgemlwY29kZSA9IHoucmVwbGFjZSgvXFxEL2csICcnKTtcblxuICAgICAgLy8gOCBkaWdpdHMgMCB0byA5XG4gICAgICB2YXIgcmVnZXggPSAvXlswLTldezh9JC87XG5cbiAgICAgIC8vIDQgZGlnaXRzIDAgdG8gOVxuICAgICAgaWYgKGMgPT09ICdlcy1BUicpIHtcbiAgICAgICAgcmVnZXggPSAvXlswLTldezR9JC87XG5cbiAgICAgICAgLy8gNSBkaWdpdHMgMCB0byA5XG4gICAgICB9IGVsc2UgaWYgKGMgPT09ICdlcy1NWCcpIHtcbiAgICAgICAgcmVnZXggPSAvXlswLTldezV9JC87XG4gICAgICB9XG5cbiAgICAgIHJldHVybiByZWdleC50ZXN0KHppcGNvZGUpO1xuXG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgaGlkZU9yU2hvd0xhYmVsXG4gICAqIGF1eCBmb3IgaGlkZS9zaG93IGxhYmVsIG9mIGlucHV0XG4gICAqIEByZXR1cm4ge31cbiAgICovXG4gIHZhciBoaWRlT3JTaG93TGFiZWwgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJGVsZW0uaW5wdXQpLnZhbHVlICE9PSAnJykge1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigkZWxlbS5ib3hfaW5wdXQgKyAnIGxhYmVsJykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpO1xuICAgIH0gZWxzZSB7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCRlbGVtLmJveF9pbnB1dCArICcgbGFiZWwnKS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG4gICAgfVxuICB9O1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIG9uZm9jdXNcbiAgICogYWRkIGV2ZW50IHRvIGlucHV0IGZvY3VzXG4gICAqIFthdXhTZXRGb2N1c10gYXV4IGZvciBub3QgdG8gZHVwbGljYXRlIGV2ZW50c1xuICAgKiBAcmV0dXJuIHt9XG4gICAqL1xuICB2YXIgYXV4U2V0Rm9jdXMgPSB0cnVlO1xuICB2YXIgb25mb2N1cyA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoYXV4U2V0Rm9jdXMpIHtcbiAgICAgIGF1eFNldEZvY3VzID0gZmFsc2U7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCRlbGVtLmlucHV0KS5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaGlkZU9yU2hvd0xhYmVsKCk7XG4gICAgICB9KTtcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJGVsZW0uaW5wdXQpLmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGhpZGVPclNob3dMYWJlbCgpO1xuICAgICAgfSk7XG4gICAgfVxuICB9O1xuXG4gIHZhciBzaG93TW9kYWwgPSBmdW5jdGlvbiAoYmFubmVyQ2xpY2tlZCkge1xuICAgIHZhciBidG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCRlbGVtLmJ0bl9zdWJtaXQpLFxuICAgICAgc3BhbiA9IGJ0biA/IGJ0bi5xdWVyeVNlbGVjdG9yKCdzcGFuJykgOiBudWxsO1xuICAgIGlmIChnZXRDb29raWUoJ3ppcGNvZGUnKSkge1xuICAgICAgaWYgKHNwYW4pIHtcbiAgICAgICAgc3Bhbi5pbm5lclRleHQgPSAnQWx0ZXJhcic7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChzcGFuKSB7XG4gICAgICAgIHNwYW4uaW5uZXJUZXh0ID0gJ0NvbnN1bHRhcic7XG4gICAgICB9XG4gICAgfVxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50ZXh0X19zdWNlc3MnKS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRleHQnKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJyk7XG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnppcF9fY29kZS1ib3gnKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJyk7XG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigkZWxlbS5pbnB1dCkuc2V0QXR0cmlidXRlKCd2YWx1ZScsIGdldFppcENvZGUoKSk7XG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigkZWxlbS5ib3hfaW5wdXQgKyAnIGxhYmVsJykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpO1xuICAgICghZ2V0Q29va2llKCd1bmFtZScpKSA/IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJGVsZW0ubG9naW4pLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGUnKSA6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJGVsZW0ubG9naW4pLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICBpZiAoYmFubmVyQ2xpY2tlZCkge1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnppcF9fY29kZS0tcnVsZXMnKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy56aXBfX2NvZGUtLXJ1bGVzJykuY2xhc3NMaXN0LmFkZCgnaGlkZScpO1xuICAgIH1cbiAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJGVsZW0ub3ZlcmxheSwgJ3Nob3cnKTtcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCRlbGVtLmNvbnRhaW5lcikuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpO1xuICB9O1xuXG4gIGZ1bmN0aW9uIHNldFVybExvZ2luKCkge1xuICAgIHZhciBsb2dpbkJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy56aXBfX2NvZGUtdXNlci0tYnV0dG9uJyk7XG4gICAgaWYgKGxvZ2luQnRuKSB7XG4gICAgICB2YXIgcGF0aCA9IHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSB8fCAnJztcbiAgICAgIHZhciBzZWFyY2ggPSB3aW5kb3cubG9jYXRpb24uc2VhcmNoIHx8ICcnO1xuXG4gICAgICBpZiAocGF0aCAmJiBwYXRoICE9PSAnLycpIHtcbiAgICAgICAgbG9naW5CdG4uaHJlZiA9ICcvbG9naW4/cmVkaXJlY3Q9JyArIHBhdGggKyBzZWFyY2g7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsb2dpbkJ0bi5ocmVmID0gJy9sb2dpbic7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgdmFyIHNldExpc3RlbmVycyA9IGZ1bmN0aW9uICgpIHtcbiAgICAvLyBidXR0b24gb3BlbiBsaWdodGJveCBmcmVpZ3RoXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnppcGNvZGUtY29udGVudF9fYmxvY2snKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHNldFVybExvZ2luKCk7XG4gICAgICBzaG93TW9kYWwoKTtcbiAgICB9KTtcblxuICAgIC8vY2xvc2UgZm9ybSBhbmQgc2hvdyB0b29saXAsIHdoZW4gaXMgbW9iaWxlXG4gICAgdmFyIGNsb3NlRm9ybSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBzcGFuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYnV0dG9uW2RhdGEtemlwLWNvZGUtc3VibWl0XSBzcGFuJyk7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCRlbGVtLmNvbnRhaW5lcikuY2xhc3NMaXN0LmFkZCgnaGlkZScpO1xuICAgICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIucHViKCRlbGVtLm92ZXJsYXksICdoaWRlJyk7XG5cbiAgICAgIGlmIChzcGFuKSB7XG4gICAgICAgIHNwYW4uaW5uZXJUZXh0ID0gXCJBTFRFUkFSXCI7XG4gICAgICB9XG5cbiAgICAgIGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCRlbGVtLnRvb2x0aXApKSB7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJGVsZW0udG9vbHRpcCkuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpO1xuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCRlbGVtLnRvb2x0aXApLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICAgICAgfSwgNTAwMCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8vIHN1Ym1pdFxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJGVsZW0uYnRuX3N1Ym1pdCkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgdmFyIHRleHRFbCA9IHRoaXMucXVlcnlTZWxlY3RvcignLnRleHQnKTtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICBpZiAodGV4dEVsICYmIHRleHRFbC5pbm5lclRleHQgPT09ICdPSycpIHtcbiAgICAgICAgY2xvc2VGb3JtKCk7XG4gICAgICAgIGlmIChjaGVja0ZyZWVTaGlwcGluZ0VuYWJsZWQgfHwgZ2V0WmlwY29kZUluZm9FbmFibGVkKSB7XG4gICAgICAgICAgdmFyIHppcCA9IGdldENvb2tpZSgnemlwY29kZScpO1xuICAgICAgICAgIHdpbmRvdy56aXBjb2RlQVBJc0FqYXggPSBmYWxzZTtcbiAgICAgICAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ25zTG9hZGluZy5zaG93JywgZG9jdW1lbnQuYm9keSk7XG4gICAgICAgICAgaWYgKHdpbmRvdy5GUkVFU0hJUFBJTkdfQkFOTkVSX0NVU1RPTV9BQ1RJT04pIHtcbiAgICAgICAgICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnB1YignY3VzdG9tQmFubmVyQWN0aW9uLnppcGNvZGVDaGFuZ2VkJyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnB1YignY2hlY2tGcmVlU2hpcHBpbmdFbGlnaWJpbGl0eScsIHppcCk7XG4gICAgICAgICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIucHViKCdnZXRaaXBjb2RlRnVsbEluZm8nLCB6aXApO1xuICAgICAgICAgIGlmIChwYWdlVHlwZSA9PT0gJ3Byb2R1Y3QnKSB7XG4gICAgICAgICAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ1NoaXBwaW5nLnJlc3RhcnQnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciB6aXBjb2RlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigkZWxlbS5pbnB1dCkudmFsdWU7XG4gICAgICAgIHZhciBjb3VudHJ5ID0gZ2V0Q291bnRyeSgpO1xuICAgICAgICB2YWxpZGF0ZVppcGNvZGUoemlwY29kZSwgY291bnRyeSkgPyB2YWxpZGF0aW9uQ2FsbGJhY2soZmFsc2UpIDogdmFsaWRhdGlvbkNhbGxiYWNrKHRydWUpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gY2xvc2UgKGJ1dHRvbiBvciBvdmVybGF5KVxuICAgIHdpbmRvdy5mcmVlZG9tLmxpdmUoJyNvdmVybGF5JywgJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHRleHRFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy56aXBfX2NvZGUtLWNhbGN1bGF0ZSAudGV4dCcpO1xuICAgICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIucHViKCRlbGVtLm92ZXJsYXksICdoaWRlJyk7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCRlbGVtLmNvbnRhaW5lcikuY2xhc3NMaXN0LmFkZCgnaGlkZScpO1xuICAgICAgaWYgKHRleHRFbCAmJiB0ZXh0RWwuaW5uZXJUZXh0ID09PSAnT0snKSB7XG4gICAgICAgIGlmIChjaGVja0ZyZWVTaGlwcGluZ0VuYWJsZWQgfHwgZ2V0WmlwY29kZUluZm9FbmFibGVkKSB7XG4gICAgICAgICAgdmFyIHppcCA9IGdldENvb2tpZSgnemlwY29kZScpO1xuICAgICAgICAgIHdpbmRvdy56aXBjb2RlQVBJc0FqYXggPSBmYWxzZTtcbiAgICAgICAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ25zTG9hZGluZy5zaG93JywgZG9jdW1lbnQuYm9keSk7XG4gICAgICAgICAgaWYgKHdpbmRvdy5GUkVFU0hJUFBJTkdfQkFOTkVSX0NVU1RPTV9BQ1RJT04pIHtcbiAgICAgICAgICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnB1YignY3VzdG9tQmFubmVyQWN0aW9uLnppcGNvZGVDaGFuZ2VkJyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnB1YignY2hlY2tGcmVlU2hpcHBpbmdFbGlnaWJpbGl0eScsIHppcCk7XG4gICAgICAgICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIucHViKCdnZXRaaXBjb2RlRnVsbEluZm8nLCB6aXApO1xuICAgICAgICAgIGlmIChwYWdlVHlwZSA9PT0gJ3Byb2R1Y3QnKSB7XG4gICAgICAgICAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ1NoaXBwaW5nLnJlc3RhcnQnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIGNhbGwgdG8gZXZlbnQgZm9jdXNcbiAgICB3aW5kb3cuZnJlZWRvbS5saXZlKCRlbGVtLmlucHV0LCAnY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICBvbmZvY3VzKCk7XG4gICAgfSk7XG4gIH07XG5cbiAgLy8gSW5pdGlhbGl6ZSBhcHBsaWNhdGlvblxuICB0cnkge1xuICAgIHNldExpc3RlbmVycygpO1xuICAgIGFwcGx5SW5wdXRNYWtzKCk7XG5cbiAgICBpZiAoZ2V0Q29va2llKCd6aXBjb2RlJykpIHtcbiAgICAgIHZhciB6aXBjb2RlID0gZ2V0Q29va2llKCd6aXBjb2RlJyk7XG4gICAgICBtZXNzYWdlU3VjZXNzKHppcGNvZGUpO1xuICAgIH1cblxuICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnN1YignY2hhbmdlSGVhZGVyWmlwY29kZScsIG1lc3NhZ2VTdWNlc3MpO1xuICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnN1YignY2hhbmdlSGVhZGVyWmlwY29kZScsIHVwZGF0ZUlucHV0VmFsdWUpO1xuICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnN1YignaW5zZXJ0WmlwY29kZS5zaG93TW9kYWwnLCBzaG93TW9kYWwpO1xuXG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0VSUk9SIHwgU2hpcHBpbmcgJyArIGVycik7XG4gIH1cbn0oKSk7XG4iXX0=
