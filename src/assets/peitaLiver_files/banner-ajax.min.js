"use strict";var cluster=function(){var e=window.freedom.getCookie("clusterId")?decodeURIComponent(window.freedom.getCookie("clusterId")):void 0,t=window.freedom.getCookie("uuid")||void 0,o=window.freedom.getCookie("uf")||null,n=window.freedom.getCookie("cityCode")||null,r=window.freedom.getCookie("zipcode")||void 0,a=document.querySelector("section[data-free-shipping-by-zipcode]"),i=document.querySelector("section[data-get-zipcode-info]"),l=function(e){var t="";return e&&(t=e.filter(function(e){return e.mainAddress===!0})[0]),t},m=function(e,t){return e.reduce(function(e,o,n){return 0===n?e+o[t]:e+","+o[t]},"")},d=function(e,t,o){var n="expires=";o.setTime(o.getTime()+432e5),n+=o.toGMTString(),document.cookie=e+"="+t+"; "+n+"; path=/"},c=function(e,t,o){var n=!1;return!(e&&e.indexOf("anonymous")<0)||t&&o||(n=!0),e||(n=!0),n},u={banner_stripe_home:"banner-stripe-home",home_gamma_full_top_0:"home-gamma-full-top-0",home_gamma_killers_list:"home-gamma-killers-list",home_gamma_triple_line1_rectangle_0:"home-gamma-triple-line1-rectangle-0",home_gamma_triple_line1_rectangle_1:"home-gamma-triple-line1-rectangle-1",home_gamma_categories_list:"home-gamma-categories-list",home_gamma_triple_line2_rectangle_0:"home-gamma-triple-line2-rectangle-0",home_gamma_triple_line2_rectangle_1:"home-gamma-triple-line2-rectangle-1",home_gamma_triple_line2_rectangle_2:"home-gamma-triple-line2-rectangle-3",home_gamma_brands_list:"home-gamma-brands-list",home_gamma_full_buttons_line1:"home-gamma-full-buttons-line1",home_gamma_triple_line3_rectangle:"home-gamma-triple-line3-rectangle",home_gamma_banners_carousel_top:"home-gamma-banners-carousel-top",home_gamma_banners_carousel_middle:"home-gamma-banners-carousel-middle",home_gamma_banners_carousel_middle_2:"home-gamma-banners-carousel-middle-2",home_gamma_banners_carousel_bottom:"home-gamma-banners-carousel-bottom",banner_stripe_pdp:"banner-stripe-pdp",banner_stripe_search:"banner-stripe-search",banner_html_pdp:"banner-html-pdp"},g={banner_stripe_home:"banner-stripe-home",banner_stripe_pdp:"banner-stripe-pdp",banner_stripe_search:"banner-stripe-search",zt_home_triple_line3_rectangle_0:"zt-home-triple-line3-rectangle-0",zt_home_triple_line3_rectangle_1:"zt-home-triple-line3-rectangle-1",zt_home_triple_line3_rectangle_2:"zt-home-triple-line3-rectangle-2",zt_home_full_top_0:"zt-home-full-top-0",zt_home_triple_line1_rectangle_0:"zt-home-triple-line1-rectangle-0",zt_home_triple_line1_rectangle_1:"zt-home-triple-line1-rectangle-1",zt_home_triple_line2_rectangle_0:"zt-home-triple-line2-rectangle-0",zt_home_triple_line2_rectangle_1:"zt-home-triple-line2-rectangle-1",zt_home_triple_line2_rectangle_2:"zt-home-triple-line2-rectangle-2",home_gamma_full_buttons_line1:"home-gamma-full-buttons-line1",zt_home_full_top:"zt-home-full-top",zt_home_full_middle:"zt-home-full-middle",zt_home_full_bottom:"zt-home-full-bottom",zt_home_banner_fixe1:"zt-home-banner-fixe1",zt_home_banner_fixe2:"zt-home-banner-fixe2",banner_html_pdp:"banner-html-pdp"},s=function(){a?window.zipcodeAPIsAjax?window.freedom.nsPubSub.pub("nsLoading.hide",document.body):window.zipcodeAPIsAjax=!0:window.freedom.nsPubSub.pub("nsLoading.hide",document.body)},_=function(){document.querySelectorAll(".ghost-wrapper")&&document.querySelectorAll(".ghost-wrapper").length>0&&document.querySelectorAll(".ghost-wrapper").forEach(function(e){e.querySelectorAll("a img")&&e.querySelectorAll("a img").length>0?e.querySelectorAll("a img").forEach(function(t){var o=setInterval(function(){t.complete&&(e.classList.remove("ghost-wrapper"),clearInterval(o))},250)}):e.classList.remove("ghost-wrapper")}),window.freedom.nsPubSub.pub("bannerCustomAction.freeShipping.afterBannerAjax"),s()},p=function(e,t,o,n,r){"home-gamma-full-top-0"!==e[t]&&"zt-home-full-top-0"!==e[t]||!document.getElementById(e[t])||(document.getElementById(e[t]).querySelectorAll("a img").forEach(function(e){e.removeAttribute("data-campaign-interactive"),e.removeAttribute("data-banner-interactive")}),setTimeout(function(){document.getElementById(e[t])&&document.getElementById(e[t]).querySelectorAll(".bullet")&&document.getElementById(e[t]).querySelectorAll(".bullet").forEach(function(e){e.classList.add("hide")})},500)),o<=n&&e[t]&&document.getElementById(e[t])&&document.getElementById(e[t]).querySelectorAll("a img")&&document.getElementById(e[t]).querySelectorAll("a img").forEach(function(e,t){(r.data.images&&r.data.images[t]||r.data.urlImage)&&(e.src=r.data.images?r.data.images[t].urlImage:r.data.urlImage,e.parentNode.href=r.data.images?r.data.images[t].urlTarget:r.data.urlTarget,e.parentNode&&"free-shipping"===e.parentNode.getAttribute("data-custom-action")&&"free-shipping"!==r.data.metaAction&&(e.parentNode.removeAttribute("data-custom-action"),window.freedom.nsPubSub.pub("bannerCustomAction.freeShipping.removeEvent",e.parentNode)),e.parentNode&&"free-shipping"===r.data.metaAction&&e.parentNode.setAttribute("data-custom-action",r.data.metaAction))})},h=function(e,t,o){if(document.getElementById(e[t])){var n=window.freedom.getCookie("uname")||"",r=o.data.content;r=r.replace("{username}",decodeURI(n)),r=r.replace("{clusterName}",""),document.getElementById(e[t]).innerHTML="",document.getElementById(e[t]).innerHTML=r}},f=function(e){e&&e.length>0&&e.forEach(function(e){var t=window.freedom.getCookie("storeId")&&"L_ZATTINI"===window.freedom.getCookie("storeId")?g:u,o=e.id.replace(/-/g,"_"),n=e.data.images?e.data.images.length:1,r=document.getElementById(t[o])?document.getElementById(t[o]).querySelectorAll("a img").length:0;"HTML"===e.data.type?h(t,o,e):p(t,o,n,r,e)}),_()},b=function(){if(e&&!e.includes("anonymous")||"string"==typeof o||"string"==typeof n){var t=window.freedom.getCookie("campaignCode")||"",r=e||null,a=o,i=n,l="/banner/usercluster/"+r+"/uf/"+a+"/city/"+i+"/"+t,m={method:"get",type:"json",success:function(e){f(e)},error:function(e){console.error(e),_()}};window.freedom.restClient.request(l,m)}else _()},w=function(){e=decodeURIComponent(window.freedom.getCookie("clusterId"))||void 0,t=window.freedom.getCookie("uuid")||void 0,o=window.freedom.getCookie("uf")||null,n=window.freedom.getCookie("cityCode")||null,r=window.freedom.getCookie("zipcode")||void 0,b()},y=function(e){var t=e||{},o=t.clusters?m(t.clusters,"id"):"",n=l(t.addresses),r=new Date;o?d("clusterId",o,r):d("clusterId","anonymous",r),n?(n.zipCode&&(d("zipcode",n.zipCode,r),window.freedom.nsPubSub.pub("changeHeaderZipcode",n.zipCode),window.freedom.nsPubSub.pub("checkFreeShippingEligibility",n.zipCode)),window.freedom.nsPubSub.pub("getZipcodeFullInfo",n.zipCode,!0)):w()},z=function(){if(c(t,e,r)){var a={method:"get",type:"json",success:function(e){y(e)},error:function(e){console.error(e),b()}};window.freedom.restClient.request("/soft-login?cluster=true",a)}else!i||o&&n||!e||!r?b():window.freedom.nsPubSub.pub("getZipcodeFullInfo",r)};try{z(),window.freedom.nsPubSub.sub("getSegmentationBanners",w)}catch(I){console.error("Error trying to get logged user info and generate cookies",I)}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl9yZWZhY3RvcmluZy9fY29tcG9uZW50cy9fYmVoYXZpb3IvYmFubmVyLWFqYXgvYWxsL2Jhbm5lci1hamF4Lm1pbi5qcyJdLCJuYW1lcyI6WyJjbHVzdGVyIiwiVVNFUl9DTFVTVEVSIiwid2luZG93IiwiZnJlZWRvbSIsImdldENvb2tpZSIsImRlY29kZVVSSUNvbXBvbmVudCIsInVuZGVmaW5lZCIsIlVVSUQiLCJBRERSRVNTX1VGIiwiQUREUkVTU19DSVRZIiwiWklQQ09ERSIsIkZSRUVTSElQUElOR19FTkFCTEVEIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiR0VUX1pJUENPREVfSU5GT19FTkFCTEVEIiwiZ2V0TWFpbkFkZHJlc3MiLCJhZGRyZXNzZXMiLCJtYWluIiwiZmlsdGVyIiwiYWRkcmVzcyIsIm1haW5BZGRyZXNzIiwiY29uY2F0Q2x1c3RlcnNQcm9wIiwiY2x1c3RlcnMiLCJwcm9wZXJ0eSIsInJlZHVjZSIsImFjYyIsImVsIiwiaW5kZXgiLCJzZXRDb29raWUiLCJuYW1lIiwidmFsdWUiLCJkYXRlIiwiZXhwaXJlcyIsInNldFRpbWUiLCJnZXRUaW1lIiwidG9HTVRTdHJpbmciLCJjb29raWUiLCJzaG91bGRMb2FkVXNlciIsInV1aWQiLCJjbHVzdGVySWQiLCJ6aXBDb2RlIiwicmV0IiwiaW5kZXhPZiIsImxpc3RCYW5uZXJzSWROZXRzaG9lcyIsImJhbm5lcl9zdHJpcGVfaG9tZSIsImhvbWVfZ2FtbWFfZnVsbF90b3BfMCIsImhvbWVfZ2FtbWFfa2lsbGVyc19saXN0IiwiaG9tZV9nYW1tYV90cmlwbGVfbGluZTFfcmVjdGFuZ2xlXzAiLCJob21lX2dhbW1hX3RyaXBsZV9saW5lMV9yZWN0YW5nbGVfMSIsImhvbWVfZ2FtbWFfY2F0ZWdvcmllc19saXN0IiwiaG9tZV9nYW1tYV90cmlwbGVfbGluZTJfcmVjdGFuZ2xlXzAiLCJob21lX2dhbW1hX3RyaXBsZV9saW5lMl9yZWN0YW5nbGVfMSIsImhvbWVfZ2FtbWFfdHJpcGxlX2xpbmUyX3JlY3RhbmdsZV8yIiwiaG9tZV9nYW1tYV9icmFuZHNfbGlzdCIsImhvbWVfZ2FtbWFfZnVsbF9idXR0b25zX2xpbmUxIiwiaG9tZV9nYW1tYV90cmlwbGVfbGluZTNfcmVjdGFuZ2xlIiwiaG9tZV9nYW1tYV9iYW5uZXJzX2Nhcm91c2VsX3RvcCIsImhvbWVfZ2FtbWFfYmFubmVyc19jYXJvdXNlbF9taWRkbGUiLCJob21lX2dhbW1hX2Jhbm5lcnNfY2Fyb3VzZWxfbWlkZGxlXzIiLCJob21lX2dhbW1hX2Jhbm5lcnNfY2Fyb3VzZWxfYm90dG9tIiwiYmFubmVyX3N0cmlwZV9wZHAiLCJiYW5uZXJfc3RyaXBlX3NlYXJjaCIsImJhbm5lcl9odG1sX3BkcCIsImxpc3RCYW5uZXJzSWRaYXR0aW5pIiwienRfaG9tZV90cmlwbGVfbGluZTNfcmVjdGFuZ2xlXzAiLCJ6dF9ob21lX3RyaXBsZV9saW5lM19yZWN0YW5nbGVfMSIsInp0X2hvbWVfdHJpcGxlX2xpbmUzX3JlY3RhbmdsZV8yIiwienRfaG9tZV9mdWxsX3RvcF8wIiwienRfaG9tZV90cmlwbGVfbGluZTFfcmVjdGFuZ2xlXzAiLCJ6dF9ob21lX3RyaXBsZV9saW5lMV9yZWN0YW5nbGVfMSIsInp0X2hvbWVfdHJpcGxlX2xpbmUyX3JlY3RhbmdsZV8wIiwienRfaG9tZV90cmlwbGVfbGluZTJfcmVjdGFuZ2xlXzEiLCJ6dF9ob21lX3RyaXBsZV9saW5lMl9yZWN0YW5nbGVfMiIsInp0X2hvbWVfZnVsbF90b3AiLCJ6dF9ob21lX2Z1bGxfbWlkZGxlIiwienRfaG9tZV9mdWxsX2JvdHRvbSIsInp0X2hvbWVfYmFubmVyX2ZpeGUxIiwienRfaG9tZV9iYW5uZXJfZml4ZTIiLCJ1cGRhdGVMb2FkaW5nU3RhdGUiLCJ6aXBjb2RlQVBJc0FqYXgiLCJuc1B1YlN1YiIsInB1YiIsImJvZHkiLCJyZW1vdmVQbGFjZWhvbGRlckJhbm5lciIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJsZW5ndGgiLCJmb3JFYWNoIiwiZWxlbWVudCIsImltYWdlIiwicmVtb3ZlUGxhY2Vob2xkZXIiLCJzZXRJbnRlcnZhbCIsImNvbXBsZXRlIiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwiY2xlYXJJbnRlcnZhbCIsImNoYW5nZUJhbm5lcnNJbWFnZSIsImxpc3RCYW5uZXJzSWQiLCJiYW5uZXJJZCIsImJhbm5lcnNDbHVzdGVySWRDb3VudCIsImN1cnJlbnRCYW5uZXJDb3VudCIsImJhbm5lckl0ZW0iLCJnZXRFbGVtZW50QnlJZCIsImltZyIsInJlbW92ZUF0dHJpYnV0ZSIsInNldFRpbWVvdXQiLCJpdGVtIiwiYWRkIiwiZGF0YSIsImltYWdlcyIsInVybEltYWdlIiwic3JjIiwicGFyZW50Tm9kZSIsImhyZWYiLCJ1cmxUYXJnZXQiLCJnZXRBdHRyaWJ1dGUiLCJtZXRhQWN0aW9uIiwic2V0QXR0cmlidXRlIiwiY2hhbmdlQmFubmVyc0h0bWwiLCJ1c2VybmFtZSIsImJhbm5lckNvbnRlbnQiLCJjb250ZW50IiwicmVwbGFjZSIsImRlY29kZVVSSSIsImlubmVySFRNTCIsImNoYW5nZUJhbm5lcnMiLCJiYW5uZXJzQXJyYXkiLCJpZCIsInR5cGUiLCJnZXRCYW5uZXJzIiwiaW5jbHVkZXMiLCJjYW1wYWlnbiIsInVmIiwiY2l0eUNvZGUiLCJ1cmwiLCJvcHRpb25zIiwibWV0aG9kIiwic3VjY2VzcyIsInJlc3VsdCIsImVycm9yIiwiY29uc29sZSIsInJlc3RDbGllbnQiLCJyZXF1ZXN0IiwicmVpbml0VmFyaWFibGVzIiwic2V0Q29va2llcyIsInJlc3BvbnNlIiwiRGF0ZSIsImdldExvZ2dlZFVzZXJBbmRHZW5lcmF0ZUNvb2tpZXMiLCJzdWIiXSwibWFwcGluZ3MiOiJBQUFBLFlBRUEsSUFBSUEsU0FBVyxXQUNiLEdBQUlDLEdBQWVDLE9BQU9DLFFBQVFDLFVBQVUsYUFBZUMsbUJBQW1CSCxPQUFPQyxRQUFRQyxVQUFVLGNBQWdCRSxPQUNySEMsRUFBT0wsT0FBT0MsUUFBUUMsVUFBVSxTQUFXRSxPQUMzQ0UsRUFBYU4sT0FBT0MsUUFBUUMsVUFBVSxPQUFTLEtB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LFNBQVVDLEdBQ2pCTSxFQUFXTixJQUViQyxNQUFPLFNBQVVBLEdBQ2ZDLFFBQVFELE1BQU1BLEdBQ2RWLEtBR0o5SCxRQUFPQyxRQUFReUksV0FBV0MsUUFBUSwyQkFBNEJQLFFBRTFEeEgsR0FBOEJOLEdBQWVDLElBQWlCUixJQUFnQlMsRUFHaEZzSCxJQUZBOUgsT0FBT0MsUUFBUTZFLFNBQVNDLElBQUkscUJBQXNCdkUsR0FPeEQsS0FDRXdJLElBQ0FoSixPQUFPQyxRQUFRNkUsU0FBU21FLElBQUkseUJBQTBCTCxHQUN0RCxNQUFPSixHQUNQQyxRQUFRRCxNQUFNLDREQUE2REEiLCJmaWxlIjoiX3JlZmFjdG9yaW5nL19jb21wb25lbnRzL19iZWhhdmlvci9iYW5uZXItYWpheC9hbGwvYmFubmVyLWFqYXgubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG52YXIgY2x1c3RlciA9IChmdW5jdGlvbiAoKSB7XG4gIHZhciBVU0VSX0NMVVNURVIgPSB3aW5kb3cuZnJlZWRvbS5nZXRDb29raWUoJ2NsdXN0ZXJJZCcpID8gZGVjb2RlVVJJQ29tcG9uZW50KHdpbmRvdy5mcmVlZG9tLmdldENvb2tpZSgnY2x1c3RlcklkJykpIDogdW5kZWZpbmVkLFxuICAgIFVVSUQgPSB3aW5kb3cuZnJlZWRvbS5nZXRDb29raWUoJ3V1aWQnKSB8fCB1bmRlZmluZWQsXG4gICAgQUREUkVTU19VRiA9IHdpbmRvdy5mcmVlZG9tLmdldENvb2tpZSgndWYnKSB8fCBudWxsLFxuICAgIEFERFJFU1NfQ0lUWSA9IHdpbmRvdy5mcmVlZG9tLmdldENvb2tpZSgnY2l0eUNvZGUnKSB8fCBudWxsLFxuICAgIFpJUENPREUgPSB3aW5kb3cuZnJlZWRvbS5nZXRDb29raWUoJ3ppcGNvZGUnKSB8fCB1bmRlZmluZWQ7XG5cbiAgLy8gdGhpcyB2YXIgY2hlY2sgaWYgW2dldC16aXBjb2RlLWluZm9dIG9yIFtmcmVlLXNoaXBwaW5nXSBpcyBlbmFibGVkLCBiZWNhdXNlIHRoZSBbaW5zZXJ0LXppcC1jb2RlXSBpbnRlcmFjdCB3aXRoIGJvdGggQVBJc1xuICAvLyBpdCB3YXMgbmVlZCB0d28gc3luYyB0aGUgbnNMb2FkaW5nIHN0YXRlIG9uIHRoZSBjYWxsYmFjayBmdW5jIG9mIGJvdGggZmVhdHVyZXMgXG4gIHZhciBGUkVFU0hJUFBJTkdfRU5BQkxFRCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3NlY3Rpb25bZGF0YS1mcmVlLXNoaXBwaW5nLWJ5LXppcGNvZGVdJyksXG4gICAgR0VUX1pJUENPREVfSU5GT19FTkFCTEVEID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcignc2VjdGlvbltkYXRhLWdldC16aXBjb2RlLWluZm9dJyk7XG5cbiAgdmFyIGdldE1haW5BZGRyZXNzID0gZnVuY3Rpb24gKGFkZHJlc3Nlcykge1xuICAgIHZhciBtYWluID0gJyc7XG4gICAgaWYgKGFkZHJlc3Nlcykge1xuICAgICAgbWFpbiA9IGFkZHJlc3Nlcy5maWx0ZXIoZnVuY3Rpb24gKGFkZHJlc3MpIHtcbiAgICAgICAgcmV0dXJuIGFkZHJlc3MubWFpbkFkZHJlc3MgPT09IHRydWU7XG4gICAgICB9KVswXTtcbiAgICB9XG4gICAgcmV0dXJuIG1haW47XG4gIH07XG5cbiAgdmFyIGNvbmNhdENsdXN0ZXJzUHJvcCA9IGZ1bmN0aW9uIChjbHVzdGVycywgcHJvcGVydHkpIHtcbiAgICByZXR1cm4gY2x1c3RlcnMucmVkdWNlKGZ1bmN0aW9uIChhY2MsIGVsLCBpbmRleCkge1xuICAgICAgaWYgKGluZGV4ID09PSAwKSByZXR1cm4gYWNjICsgZWxbcHJvcGVydHldO1xuICAgICAgcmV0dXJuIGFjYyArICcsJyArIGVsW3Byb3BlcnR5XTtcbiAgICB9LCAnJyk7XG4gIH07XG5cbiAgdmFyIHNldENvb2tpZSA9IGZ1bmN0aW9uIChuYW1lLCB2YWx1ZSwgZGF0ZSkge1xuICAgIHZhciBleHBpcmVzID0gJ2V4cGlyZXM9JztcbiAgICBkYXRlLnNldFRpbWUoZGF0ZS5nZXRUaW1lKCkgKyAoMTIgKiA2MCAqIDYwICogMTAwMCkpO1xuICAgIGV4cGlyZXMgKz0gZGF0ZS50b0dNVFN0cmluZygpO1xuICAgIGRvY3VtZW50LmNvb2tpZSA9IG5hbWUgKyAnPScgKyB2YWx1ZSArICc7ICcgKyBleHBpcmVzICsgJzsgcGF0aD0vJztcbiAgfTtcblxuICB2YXIgc2hvdWxkTG9hZFVzZXIgPSBmdW5jdGlvbiAodXVpZCwgY2x1c3RlcklkLCB6aXBDb2RlKSB7XG4gICAgdmFyIHJldCA9IGZhbHNlO1xuICAgIGlmICh1dWlkICYmIHV1aWQuaW5kZXhPZignYW5vbnltb3VzJykgPCAwICYmICghY2x1c3RlcklkIHx8ICF6aXBDb2RlKSkge1xuICAgICAgcmV0ID0gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKCF1dWlkKSB7XG4gICAgICByZXQgPSB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xuICB9O1xuXG4gIHZhciBsaXN0QmFubmVyc0lkTmV0c2hvZXMgPSB7XG4gICAgYmFubmVyX3N0cmlwZV9ob21lOiAnYmFubmVyLXN0cmlwZS1ob21lJyxcbiAgICBob21lX2dhbW1hX2Z1bGxfdG9wXzA6ICdob21lLWdhbW1hLWZ1bGwtdG9wLTAnLFxuICAgIGhvbWVfZ2FtbWFfa2lsbGVyc19saXN0OiAnaG9tZS1nYW1tYS1raWxsZXJzLWxpc3QnLFxuICAgIGhvbWVfZ2FtbWFfdHJpcGxlX2xpbmUxX3JlY3RhbmdsZV8wOiAnaG9tZS1nYW1tYS10cmlwbGUtbGluZTEtcmVjdGFuZ2xlLTAnLFxuICAgIGhvbWVfZ2FtbWFfdHJpcGxlX2xpbmUxX3JlY3RhbmdsZV8xOiAnaG9tZS1nYW1tYS10cmlwbGUtbGluZTEtcmVjdGFuZ2xlLTEnLFxuICAgIGhvbWVfZ2FtbWFfY2F0ZWdvcmllc19saXN0OiAnaG9tZS1nYW1tYS1jYXRlZ29yaWVzLWxpc3QnLFxuICAgIGhvbWVfZ2FtbWFfdHJpcGxlX2xpbmUyX3JlY3RhbmdsZV8wOiAnaG9tZS1nYW1tYS10cmlwbGUtbGluZTItcmVjdGFuZ2xlLTAnLFxuICAgIGhvbWVfZ2FtbWFfdHJpcGxlX2xpbmUyX3JlY3RhbmdsZV8xOiAnaG9tZS1nYW1tYS10cmlwbGUtbGluZTItcmVjdGFuZ2xlLTEnLFxuICAgIGhvbWVfZ2FtbWFfdHJpcGxlX2xpbmUyX3JlY3RhbmdsZV8yOiAnaG9tZS1nYW1tYS10cmlwbGUtbGluZTItcmVjdGFuZ2xlLTMnLFxuICAgIGhvbWVfZ2FtbWFfYnJhbmRzX2xpc3Q6ICdob21lLWdhbW1hLWJyYW5kcy1saXN0JyxcbiAgICBob21lX2dhbW1hX2Z1bGxfYnV0dG9uc19saW5lMTogJ2hvbWUtZ2FtbWEtZnVsbC1idXR0b25zLWxpbmUxJyxcbiAgICBob21lX2dhbW1hX3RyaXBsZV9saW5lM19yZWN0YW5nbGU6ICdob21lLWdhbW1hLXRyaXBsZS1saW5lMy1yZWN0YW5nbGUnLFxuICAgIGhvbWVfZ2FtbWFfYmFubmVyc19jYXJvdXNlbF90b3A6ICdob21lLWdhbW1hLWJhbm5lcnMtY2Fyb3VzZWwtdG9wJyxcbiAgICBob21lX2dhbW1hX2Jhbm5lcnNfY2Fyb3VzZWxfbWlkZGxlOiAnaG9tZS1nYW1tYS1iYW5uZXJzLWNhcm91c2VsLW1pZGRsZScsXG4gICAgaG9tZV9nYW1tYV9iYW5uZXJzX2Nhcm91c2VsX21pZGRsZV8yOiAnaG9tZS1nYW1tYS1iYW5uZXJzLWNhcm91c2VsLW1pZGRsZS0yJyxcbiAgICBob21lX2dhbW1hX2Jhbm5lcnNfY2Fyb3VzZWxfYm90dG9tOiAnaG9tZS1nYW1tYS1iYW5uZXJzLWNhcm91c2VsLWJvdHRvbScsXG4gICAgYmFubmVyX3N0cmlwZV9wZHA6ICdiYW5uZXItc3RyaXBlLXBkcCcsXG4gICAgYmFubmVyX3N0cmlwZV9zZWFyY2g6ICdiYW5uZXItc3RyaXBlLXNlYXJjaCcsXG4gICAgYmFubmVyX2h0bWxfcGRwOiAnYmFubmVyLWh0bWwtcGRwJ1xuICB9O1xuXG4gIHZhciBsaXN0QmFubmVyc0lkWmF0dGluaSA9IHtcbiAgICBiYW5uZXJfc3RyaXBlX2hvbWU6ICdiYW5uZXItc3RyaXBlLWhvbWUnLFxuICAgIGJhbm5lcl9zdHJpcGVfcGRwOiAnYmFubmVyLXN0cmlwZS1wZHAnLFxuICAgIGJhbm5lcl9zdHJpcGVfc2VhcmNoOiAnYmFubmVyLXN0cmlwZS1zZWFyY2gnLFxuICAgIHp0X2hvbWVfdHJpcGxlX2xpbmUzX3JlY3RhbmdsZV8wOiAnenQtaG9tZS10cmlwbGUtbGluZTMtcmVjdGFuZ2xlLTAnLFxuICAgIHp0X2hvbWVfdHJpcGxlX2xpbmUzX3JlY3RhbmdsZV8xOiAnenQtaG9tZS10cmlwbGUtbGluZTMtcmVjdGFuZ2xlLTEnLFxuICAgIHp0X2hvbWVfdHJpcGxlX2xpbmUzX3JlY3RhbmdsZV8yOiAnenQtaG9tZS10cmlwbGUtbGluZTMtcmVjdGFuZ2xlLTInLFxuICAgIHp0X2hvbWVfZnVsbF90b3BfMDogXCJ6dC1ob21lLWZ1bGwtdG9wLTBcIixcbiAgICB6dF9ob21lX3RyaXBsZV9saW5lMV9yZWN0YW5nbGVfMDogJ3p0LWhvbWUtdHJpcGxlLWxpbmUxLXJlY3RhbmdsZS0wJyxcbiAgICB6dF9ob21lX3RyaXBsZV9saW5lMV9yZWN0YW5nbGVfMTogJ3p0LWhvbWUtdHJpcGxlLWxpbmUxLXJlY3RhbmdsZS0xJyxcbiAgICB6dF9ob21lX3RyaXBsZV9saW5lMl9yZWN0YW5nbGVfMDogJ3p0LWhvbWUtdHJpcGxlLWxpbmUyLXJlY3RhbmdsZS0wJyxcbiAgICB6dF9ob21lX3RyaXBsZV9saW5lMl9yZWN0YW5nbGVfMTogJ3p0LWhvbWUtdHJpcGxlLWxpbmUyLXJlY3RhbmdsZS0xJyxcbiAgICB6dF9ob21lX3RyaXBsZV9saW5lMl9yZWN0YW5nbGVfMjogJ3p0LWhvbWUtdHJpcGxlLWxpbmUyLXJlY3RhbmdsZS0yJyxcbiAgICBob21lX2dhbW1hX2Z1bGxfYnV0dG9uc19saW5lMTogJ2hvbWUtZ2FtbWEtZnVsbC1idXR0b25zLWxpbmUxJyxcbiAgICB6dF9ob21lX2Z1bGxfdG9wOiAnenQtaG9tZS1mdWxsLXRvcCcsXG4gICAgenRfaG9tZV9mdWxsX21pZGRsZTogJ3p0LWhvbWUtZnVsbC1taWRkbGUnLFxuICAgIHp0X2hvbWVfZnVsbF9ib3R0b206ICd6dC1ob21lLWZ1bGwtYm90dG9tJyxcbiAgICB6dF9ob21lX2Jhbm5lcl9maXhlMTogJ3p0LWhvbWUtYmFubmVyLWZpeGUxJyxcbiAgICB6dF9ob21lX2Jhbm5lcl9maXhlMjogJ3p0LWhvbWUtYmFubmVyLWZpeGUyJyxcbiAgICBiYW5uZXJfaHRtbF9wZHA6ICdiYW5uZXItaHRtbC1wZHAnXG4gIH07XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgdXBkYXRlTG9hZGluZ1N0YXRlXG4gICAqIEZ1bmN0aW9uIHRvIHN5bmMgdGhlIG5zTG9hZGluZyBzdGF0ZSBvbiB0aGUgY2FsbGJhY2sgZnVuYyBvZiB3aGVuIGNoYW5nZSB0aGUgemlwY29kZSBvbiBbaW5zZXJ0LXppcC1jb2RlXVxuICAgKiBbZnJlZS1zaGlwcGluZ10gYW5kIFtnZXQtemlwY29kZS1pbmZvXSByZXNwb25kcyBvbiB6aXBjb2RlIGNvb2tpZSBjaGFuZ2VzXG4gICAqL1xuICB2YXIgdXBkYXRlTG9hZGluZ1N0YXRlID0gZnVuY3Rpb24gKCkge1xuICAgIGlmIChGUkVFU0hJUFBJTkdfRU5BQkxFRCkge1xuICAgICAgaWYgKHdpbmRvdy56aXBjb2RlQVBJc0FqYXgpIHtcbiAgICAgICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIucHViKCduc0xvYWRpbmcuaGlkZScsIGRvY3VtZW50LmJvZHkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgd2luZG93LnppcGNvZGVBUElzQWpheCA9IHRydWU7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnB1YignbnNMb2FkaW5nLmhpZGUnLCBkb2N1bWVudC5ib2R5KTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgcmVtb3ZlUGxhY2Vob2xkZXJCYW5uZXJcbiAgICovXG4gIHZhciByZW1vdmVQbGFjZWhvbGRlckJhbm5lciA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmdob3N0LXdyYXBwZXInKSAmJiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZ2hvc3Qtd3JhcHBlcicpLmxlbmd0aCA+IDApIHtcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5naG9zdC13cmFwcGVyJykuZm9yRWFjaChmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICBpZiAoZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCdhIGltZycpICYmIGVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgnYSBpbWcnKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCdhIGltZycpLmZvckVhY2goZnVuY3Rpb24gKGltYWdlKSB7XG4gICAgICAgICAgICB2YXIgcmVtb3ZlUGxhY2Vob2xkZXIgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIGlmIChpbWFnZS5jb21wbGV0ZSkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnZ2hvc3Qtd3JhcHBlcicpO1xuICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwocmVtb3ZlUGxhY2Vob2xkZXIpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCAyNTApO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnZ2hvc3Qtd3JhcHBlcicpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ2Jhbm5lckN1c3RvbUFjdGlvbi5mcmVlU2hpcHBpbmcuYWZ0ZXJCYW5uZXJBamF4Jyk7XG4gICAgdXBkYXRlTG9hZGluZ1N0YXRlKCk7XG4gIH07XG5cbiAgdmFyIGNoYW5nZUJhbm5lcnNJbWFnZSA9IGZ1bmN0aW9uIChsaXN0QmFubmVyc0lkLCBiYW5uZXJJZCwgYmFubmVyc0NsdXN0ZXJJZENvdW50LCBjdXJyZW50QmFubmVyQ291bnQsIGJhbm5lckl0ZW0pIHtcblxuICAgIGlmICgobGlzdEJhbm5lcnNJZFtiYW5uZXJJZF0gPT09ICdob21lLWdhbW1hLWZ1bGwtdG9wLTAnIHx8IGxpc3RCYW5uZXJzSWRbYmFubmVySWRdID09PSAnenQtaG9tZS1mdWxsLXRvcC0wJykgJiYgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobGlzdEJhbm5lcnNJZFtiYW5uZXJJZF0pKSB7XG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChsaXN0QmFubmVyc0lkW2Jhbm5lcklkXSkucXVlcnlTZWxlY3RvckFsbCgnYSBpbWcnKS5mb3JFYWNoKGZ1bmN0aW9uIChpbWcpIHtcbiAgICAgICAgaW1nLnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS1jYW1wYWlnbi1pbnRlcmFjdGl2ZScpO1xuICAgICAgICBpbWcucmVtb3ZlQXR0cmlidXRlKCdkYXRhLWJhbm5lci1pbnRlcmFjdGl2ZScpO1xuICAgICAgfSk7XG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGxpc3RCYW5uZXJzSWRbYmFubmVySWRdKSAmJiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChsaXN0QmFubmVyc0lkW2Jhbm5lcklkXSkucXVlcnlTZWxlY3RvckFsbCgnLmJ1bGxldCcpKSB7XG4gICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobGlzdEJhbm5lcnNJZFtiYW5uZXJJZF0pLnF1ZXJ5U2VsZWN0b3JBbGwoJy5idWxsZXQnKS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgICBpdGVtLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSwgNTAwKTtcbiAgICB9XG4gICAgaWYgKGJhbm5lcnNDbHVzdGVySWRDb3VudCA8PSBjdXJyZW50QmFubmVyQ291bnQgJiYgbGlzdEJhbm5lcnNJZFtiYW5uZXJJZF0pIHtcbiAgICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChsaXN0QmFubmVyc0lkW2Jhbm5lcklkXSkgJiYgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobGlzdEJhbm5lcnNJZFtiYW5uZXJJZF0pLnF1ZXJ5U2VsZWN0b3JBbGwoJ2EgaW1nJykpIHtcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobGlzdEJhbm5lcnNJZFtiYW5uZXJJZF0pLnF1ZXJ5U2VsZWN0b3JBbGwoJ2EgaW1nJykuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHtcbiAgICAgICAgICBpZiAoYmFubmVySXRlbS5kYXRhLmltYWdlcyAmJiBiYW5uZXJJdGVtLmRhdGEuaW1hZ2VzW2luZGV4XSB8fCBiYW5uZXJJdGVtLmRhdGEudXJsSW1hZ2UpIHtcbiAgICAgICAgICAgIGl0ZW0uc3JjID0gYmFubmVySXRlbS5kYXRhLmltYWdlcyA/IGJhbm5lckl0ZW0uZGF0YS5pbWFnZXNbaW5kZXhdLnVybEltYWdlIDogYmFubmVySXRlbS5kYXRhLnVybEltYWdlO1xuICAgICAgICAgICAgaXRlbS5wYXJlbnROb2RlLmhyZWYgPSBiYW5uZXJJdGVtLmRhdGEuaW1hZ2VzID8gYmFubmVySXRlbS5kYXRhLmltYWdlc1tpbmRleF0udXJsVGFyZ2V0IDogYmFubmVySXRlbS5kYXRhLnVybFRhcmdldDtcblxuICAgICAgICAgICAgaWYgKGl0ZW0ucGFyZW50Tm9kZSAmJiBpdGVtLnBhcmVudE5vZGUuZ2V0QXR0cmlidXRlKCdkYXRhLWN1c3RvbS1hY3Rpb24nKSA9PT0gJ2ZyZWUtc2hpcHBpbmcnICYmIGJhbm5lckl0ZW0uZGF0YS5tZXRhQWN0aW9uICE9PSAnZnJlZS1zaGlwcGluZycpIHtcbiAgICAgICAgICAgICAgaXRlbS5wYXJlbnROb2RlLnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS1jdXN0b20tYWN0aW9uJyk7XG4gICAgICAgICAgICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnB1YignYmFubmVyQ3VzdG9tQWN0aW9uLmZyZWVTaGlwcGluZy5yZW1vdmVFdmVudCcsIGl0ZW0ucGFyZW50Tm9kZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaXRlbS5wYXJlbnROb2RlICYmIGJhbm5lckl0ZW0uZGF0YS5tZXRhQWN0aW9uID09PSAnZnJlZS1zaGlwcGluZycpIHtcbiAgICAgICAgICAgICAgaXRlbS5wYXJlbnROb2RlLnNldEF0dHJpYnV0ZSgnZGF0YS1jdXN0b20tYWN0aW9uJywgYmFubmVySXRlbS5kYXRhLm1ldGFBY3Rpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIHZhciBjaGFuZ2VCYW5uZXJzSHRtbCA9IGZ1bmN0aW9uIChsaXN0QmFubmVyc0lkLCBiYW5uZXJJZCwgYmFubmVySXRlbSkge1xuICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChsaXN0QmFubmVyc0lkW2Jhbm5lcklkXSkpIHtcbiAgICAgIHZhciB1c2VybmFtZSA9IHdpbmRvdy5mcmVlZG9tLmdldENvb2tpZSgndW5hbWUnKSB8fCAnJztcbiAgICAgIHZhciBiYW5uZXJDb250ZW50ID0gYmFubmVySXRlbS5kYXRhLmNvbnRlbnQ7XG5cbiAgICAgIGJhbm5lckNvbnRlbnQgPSBiYW5uZXJDb250ZW50LnJlcGxhY2UoJ3t1c2VybmFtZX0nLCBkZWNvZGVVUkkodXNlcm5hbWUpKTtcbiAgICAgIGJhbm5lckNvbnRlbnQgPSBiYW5uZXJDb250ZW50LnJlcGxhY2UoJ3tjbHVzdGVyTmFtZX0nLCAnJyk7XG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChsaXN0QmFubmVyc0lkW2Jhbm5lcklkXSkuaW5uZXJIVE1MID0gXCJcIjtcbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGxpc3RCYW5uZXJzSWRbYmFubmVySWRdKS5pbm5lckhUTUwgPSBiYW5uZXJDb250ZW50O1xuICAgIH1cbiAgfTtcblxuICB2YXIgY2hhbmdlQmFubmVycyA9IGZ1bmN0aW9uIChiYW5uZXJzQXJyYXkpIHtcbiAgICBpZiAoYmFubmVyc0FycmF5ICYmIGJhbm5lcnNBcnJheS5sZW5ndGggPiAwKSB7XG4gICAgICBiYW5uZXJzQXJyYXkuZm9yRWFjaChmdW5jdGlvbiAoYmFubmVySXRlbSkge1xuICAgICAgICB2YXIgbGlzdEJhbm5lcnNJZCA9IHdpbmRvdy5mcmVlZG9tLmdldENvb2tpZSgnc3RvcmVJZCcpICYmIHdpbmRvdy5mcmVlZG9tLmdldENvb2tpZSgnc3RvcmVJZCcpID09PSAnTF9aQVRUSU5JJyA/IGxpc3RCYW5uZXJzSWRaYXR0aW5pIDogbGlzdEJhbm5lcnNJZE5ldHNob2VzO1xuICAgICAgICB2YXIgYmFubmVySWQgPSBiYW5uZXJJdGVtLmlkLnJlcGxhY2UoLy0vZywgJ18nKTtcbiAgICAgICAgdmFyIGJhbm5lcnNDbHVzdGVySWRDb3VudCA9IGJhbm5lckl0ZW0uZGF0YS5pbWFnZXMgPyBiYW5uZXJJdGVtLmRhdGEuaW1hZ2VzLmxlbmd0aCA6IDE7XG4gICAgICAgIHZhciBjdXJyZW50QmFubmVyQ291bnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChsaXN0QmFubmVyc0lkW2Jhbm5lcklkXSkgPyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChsaXN0QmFubmVyc0lkW2Jhbm5lcklkXSkucXVlcnlTZWxlY3RvckFsbCgnYSBpbWcnKS5sZW5ndGggOiAwO1xuICAgICAgICBpZiAoYmFubmVySXRlbS5kYXRhLnR5cGUgPT09ICdIVE1MJykge1xuICAgICAgICAgIGNoYW5nZUJhbm5lcnNIdG1sKGxpc3RCYW5uZXJzSWQsIGJhbm5lcklkLCBiYW5uZXJJdGVtKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjaGFuZ2VCYW5uZXJzSW1hZ2UobGlzdEJhbm5lcnNJZCwgYmFubmVySWQsIGJhbm5lcnNDbHVzdGVySWRDb3VudCwgY3VycmVudEJhbm5lckNvdW50LCBiYW5uZXJJdGVtKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIHJlbW92ZVBsYWNlaG9sZGVyQmFubmVyKCk7XG4gIH07XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgZ2V0QmFubmVyc1xuICAgKi9cbiAgdmFyIGdldEJhbm5lcnMgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICBpZiAoKFVTRVJfQ0xVU1RFUiAmJiAhVVNFUl9DTFVTVEVSLmluY2x1ZGVzKCdhbm9ueW1vdXMnKSkgfHwgKHR5cGVvZiBBRERSRVNTX1VGID09PSAnc3RyaW5nJyB8fCB0eXBlb2YgQUREUkVTU19DSVRZID09PSAnc3RyaW5nJykpIHtcbiAgICAgIHZhciBjYW1wYWlnbiA9IHdpbmRvdy5mcmVlZG9tLmdldENvb2tpZSgnY2FtcGFpZ25Db2RlJykgfHwgJyc7XG4gICAgICB2YXIgY2x1c3RlcklkID0gVVNFUl9DTFVTVEVSIHx8IG51bGw7XG4gICAgICB2YXIgdWYgPSBBRERSRVNTX1VGO1xuICAgICAgdmFyIGNpdHlDb2RlID0gQUREUkVTU19DSVRZO1xuXG4gICAgICB2YXIgdXJsID0gJy9iYW5uZXIvdXNlcmNsdXN0ZXIvJyArIGNsdXN0ZXJJZCArICcvdWYvJyArIHVmICsgJy9jaXR5LycgKyBjaXR5Q29kZSArICcvJyArIGNhbXBhaWduO1xuXG4gICAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgICAgbWV0aG9kOiAnZ2V0JyxcbiAgICAgICAgdHlwZTogJ2pzb24nLFxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgY2hhbmdlQmFubmVycyhyZXN1bHQpO1xuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgcmVtb3ZlUGxhY2Vob2xkZXJCYW5uZXIoKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHdpbmRvdy5mcmVlZG9tLnJlc3RDbGllbnQucmVxdWVzdCh1cmwsIG9wdGlvbnMpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZW1vdmVQbGFjZWhvbGRlckJhbm5lcigpO1xuICAgIH1cbiAgfTtcblxuICB2YXIgcmVpbml0VmFyaWFibGVzID0gZnVuY3Rpb24gKCkge1xuICAgIFVTRVJfQ0xVU1RFUiA9IGRlY29kZVVSSUNvbXBvbmVudCh3aW5kb3cuZnJlZWRvbS5nZXRDb29raWUoJ2NsdXN0ZXJJZCcpKSB8fCB1bmRlZmluZWQ7XG4gICAgVVVJRCA9IHdpbmRvdy5mcmVlZG9tLmdldENvb2tpZSgndXVpZCcpIHx8IHVuZGVmaW5lZDtcbiAgICBBRERSRVNTX1VGID0gd2luZG93LmZyZWVkb20uZ2V0Q29va2llKCd1ZicpIHx8IG51bGw7XG4gICAgQUREUkVTU19DSVRZID0gd2luZG93LmZyZWVkb20uZ2V0Q29va2llKCdjaXR5Q29kZScpIHx8IG51bGw7XG4gICAgWklQQ09ERSA9IHdpbmRvdy5mcmVlZG9tLmdldENvb2tpZSgnemlwY29kZScpIHx8IHVuZGVmaW5lZDtcblxuICAgIGdldEJhbm5lcnMoKTtcbiAgfTtcblxuICB2YXIgc2V0Q29va2llcyA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgIHZhciBkYXRhID0gcmVzcG9uc2UgfHwge307XG4gICAgdmFyIGNsdXN0ZXJJZCA9IGRhdGEuY2x1c3RlcnMgPyBjb25jYXRDbHVzdGVyc1Byb3AoZGF0YS5jbHVzdGVycywgJ2lkJykgOiAnJztcbiAgICB2YXIgbWFpbkFkZHJlc3MgPSBnZXRNYWluQWRkcmVzcyhkYXRhLmFkZHJlc3Nlcyk7XG4gICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgIGlmIChjbHVzdGVySWQpIHtcbiAgICAgIHNldENvb2tpZSgnY2x1c3RlcklkJywgY2x1c3RlcklkLCBkYXRlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2V0Q29va2llKCdjbHVzdGVySWQnLCAnYW5vbnltb3VzJywgZGF0ZSk7XG4gICAgfVxuICAgIGlmIChtYWluQWRkcmVzcykge1xuICAgICAgaWYgKG1haW5BZGRyZXNzLnppcENvZGUpIHtcbiAgICAgICAgc2V0Q29va2llKCd6aXBjb2RlJywgbWFpbkFkZHJlc3MuemlwQ29kZSwgZGF0ZSk7XG4gICAgICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnB1YignY2hhbmdlSGVhZGVyWmlwY29kZScsIG1haW5BZGRyZXNzLnppcENvZGUpO1xuICAgICAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ2NoZWNrRnJlZVNoaXBwaW5nRWxpZ2liaWxpdHknLCBtYWluQWRkcmVzcy56aXBDb2RlKTtcbiAgICAgIH1cbiAgICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnB1YignZ2V0WmlwY29kZUZ1bGxJbmZvJywgbWFpbkFkZHJlc3MuemlwQ29kZSwgdHJ1ZSk7XG5cbiAgICB9IGVsc2Uge1xuICAgICAgcmVpbml0VmFyaWFibGVzKCk7XG4gICAgfVxuICB9O1xuXG4gIHZhciBnZXRMb2dnZWRVc2VyQW5kR2VuZXJhdGVDb29raWVzID0gZnVuY3Rpb24gKCkge1xuXG4gICAgaWYgKHNob3VsZExvYWRVc2VyKFVVSUQsIFVTRVJfQ0xVU1RFUiwgWklQQ09ERSkpIHtcbiAgICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICBtZXRob2Q6ICdnZXQnLFxuICAgICAgICB0eXBlOiAnanNvbicsXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICBzZXRDb29raWVzKHJlc3VsdCk7XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yOiBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgICBnZXRCYW5uZXJzKCk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB3aW5kb3cuZnJlZWRvbS5yZXN0Q2xpZW50LnJlcXVlc3QoJy9zb2Z0LWxvZ2luP2NsdXN0ZXI9dHJ1ZScsIG9wdGlvbnMpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoR0VUX1pJUENPREVfSU5GT19FTkFCTEVEICYmICghQUREUkVTU19VRiB8fCAhQUREUkVTU19DSVRZKSAmJiBVU0VSX0NMVVNURVIgJiYgWklQQ09ERSkge1xuICAgICAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ2dldFppcGNvZGVGdWxsSW5mbycsIFpJUENPREUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZ2V0QmFubmVycygpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICB0cnkge1xuICAgIGdldExvZ2dlZFVzZXJBbmRHZW5lcmF0ZUNvb2tpZXMoKTtcbiAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5zdWIoJ2dldFNlZ21lbnRhdGlvbkJhbm5lcnMnLCByZWluaXRWYXJpYWJsZXMpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHRyeWluZyB0byBnZXQgbG9nZ2VkIHVzZXIgaW5mbyBhbmQgZ2VuZXJhdGUgY29va2llcycsIGVycm9yKTtcbiAgfVxuXG59KCkpO1xuIl19
