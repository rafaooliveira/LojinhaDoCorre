"use strict";!function(){function e(e){return""!==e.trim()}function o(e,o){o?u(e):(S=e,n()),c()}function t(e){if(!e){var t=document.querySelector('[data-type="size"]'),r=t?"data-size-invalid":"data-voltage-invalid";return void w(document.querySelector(v).getAttribute(r))}var n=document.querySelector("[data-persona]"),u=document.querySelector("[data-builder-persona]"),a=k.getState().pdp.persona.selected;y=e,u?window.freedom.nsPubSub.pub("builder.personalization.get",o):n?window.freedom.nsPubSub.pub("personalization.get",o):a&&a.state?o(a.list,!0):o(void 0)}function r(){window.freedom.nsPubSub.pub("ColorFlavorSize.select.size",t)}function n(){if(S){var o=[];S.name&&""!==S.name&&e(S.name)&&o.push({sku:S.nameSku,value:S.name}),S.number&&""!==S.number&&o.push({sku:S.numberSku,value:S.number}),h=o}}function u(e){try{h=e}catch(o){console.error("call-to-action.buildPersonaList",o)}}function a(){try{var e=document.querySelector(v).getAttribute("data-seller");return e?+e:(e=document.querySelector("[product-data-seller]").getAttribute("product-data-seller"),e?+e:0)}catch(o){return console.error("call-to-action.getSeller",o),0}}function i(){return 0===a()?h:[]}function c(){window.WansTools&&window.WansTools&&window.WansTools.ecProduct("add");var e={items:[{sku:y,quantity:g,seller:a(),personalizations:i(),interactiveDiscount:P(y,a())}]};s(e)}function d(e,o,t){var r="";if(t){var n=new Date;n.setTime(n.getTime()+24*t*60*60*1e3),r="; expires="+n.toUTCString()}document.cookie=e+"="+(o||"")+r+"; path=/"}function l(e){if(e.data.errors&&e.data.errors.length>0){var o="data-error",t=null;e.data.errors[0].code===q&&(o="data-error-"+q),"personalization.not.allowed"===e.data.errors[0].code&&(t=window.freedom.i18n.getMessage("product_errors_cart_persona_not_allow"));var r=document.querySelectorAll(v);if(r)for(var n=r.length;n--;)w(t||r[n].getAttribute(o))}else if(window.freedom.nsPubSub.pub("quickView.hasQuickView"))window.freedom.nsPubSub.pub("quickView.close"),window.freedom.nsPubSub.pub("miniCart.fixed");else if(document.querySelector(".ab-test-minicart"))window.freedom.nsPubSub.pub("miniCart.fixed");else if(document.querySelector("body").classList.contains("test__ab-upsell")){if(null!==document.querySelector(".showcase .buy-box .buy-button-now")){var u=document.querySelector(".showcase .buy-box .buy-button-now").getAttribute("data-sku");""===u&&(u=document.querySelector('input[type="hidden"][data-product-sku]').getAttribute("data-product-sku")),d("productUpSell",u,1)}else d("productUpSell","",1);window.location.href="/upsell-cart"}else window.location.href="/cart"}function s(e){var o={buttonWithLoading:document.querySelector(v),method:"post",data:e,success:function(e){l(e)},error:function(){w(document.querySelector(v).getAttribute("data-error"))}};window.freedom.restClient.request("/cart/add",o)}function w(e){try{var o=document.querySelectorAll("#buy-error");if(o)for(var t=o.length;t--;)o[t].innerHTML=e,window.freedom.removeClass(o[t],"hidden")}catch(r){console.error("call-to-action.showBuyError",r)}}function b(e){try{if(e)r();else{var o=window.freedom.i18n.getMessage("personalization_fields_generic_error");w(o)}}catch(t){console.error("call-to-action.checkPersona",t),r()}}function f(){try{var e=document.querySelector("[data-persona]"),o=document.querySelector("[data-new-persona]"),t=document.querySelector("[data-builder-persona]");e&&o&&!t?window.freedom.nsPubSub.pub("ColorFlavorSize.handleBuyEvent.checkPersona",b):r()}catch(n){console.error("call-to-action.handleBuyEvent",n)}}function m(){window.freedom.live(".buy-button-now","click",f)}function p(e){try{var o=document.querySelector("#buy-button-wrapper.main-buy-button-now");o&&(e?window.freedom.addClass(o,"hide"):window.freedom.removeClass(o,"hide"))}catch(t){console.error("call-to-action.hideOrShowMainBuyButton",t)}}var S,y,v=".buy-button-now",h=[],g=1,q="item.stock.unavailable",k=window.freedom.NsStore,P=function(e,o){var t=window&&window.freedom&&window.freedom.nsStorage&&window.freedom.nsStorage.get?window.freedom.nsStorage.get("cp_sku")||[]:[];return o=o.toString(),!!t.find(function(t){return t.sku===e&&t.sellerId===o})};!function(){m(),window.freedom.nsPubSub.sub("callToAction.restart",m),window.freedom.nsPubSub.sub("callToAction.hide.main-button",p)}()}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl9yZWZhY3RvcmluZy9fY29tcG9uZW50cy9wcm9kdWN0L2NhbGwtdG8tYWN0aW9uL2FsbC9jYWxsLXRvLWFjdGlvbi5taW4uanMiXSwibmFtZXMiOlsiaXNOb3RXaGl0ZVNwYWNlc09ubHlPclVuZGVmaW5lZCIsInN0cmluZyIsInRyaW0iLCJwdWJTdWJQZXJzb25hR2V0SGFuZGxlciIsInBlcnNvbmFsaXphdGlvbiIsImlzTGlzdCIsImJ1aWxkUGVyc29uYUxpc3QiLCJQRVJTT05BIiwiYnVpbGRQZXJzb25hUGF5bG9hZCIsImJ1aWxkQWRkVG9DYXJ0UGF5bG9hZCIsInB1YlN1YkNvbG9yRmxhdm9yU2l6ZUhhbmRsZXIiLCJza3UiLCJoYXNTaXplIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiZXJyb3JBdHRyIiwic2hvd0J1eUVycm9yIiwiUFJPRFVDVF9CVVlfQlVUVE9OIiwiZ2V0QXR0cmlidXRlIiwiaGFzRm9ybVBlcnNvbmEiLCJoYXNCdWlsZGVyUGVyc29uYSIsInNlbGVjdGVkUGVyc29uYSIsInN0b3JlIiwiZ2V0U3RhdGUiLCJwZHAiLCJwZXJzb25hIiwic2VsZWN0ZWQiLCJTSVpFIiwid2luZG93IiwiZnJlZWRvbSIsIm5zUHViU3ViIiwicHViIiwic3RhdGUiLCJsaXN0IiwidW5kZWZpbmVkIiwiaXNTaXplVmFsaWQiLCJwZXJzb25hbGl6YXRpb25zIiwibmFtZSIsInB1c2giLCJuYW1lU2t1IiwidmFsdWUiLCJudW1iZXIiLCJudW1iZXJTa3UiLCJQRVJTT05BX1BBWUxPQUQiLCJwZXJzb25hTGlzdCIsImVycm9yIiwiY29uc29sZSIsImdldFNlbGxlciIsInNlbGxlciIsImdldFBlcnNvbmFQYXlsb2FkIiwiV2Fuc1Rvb2xzIiwiZWNQcm9kdWN0IiwicGF5bG9hZCIsIml0ZW1zIiwicXVhbnRpdHkiLCJERUZBVUxUX1FVQU5USVRZIiwiaW50ZXJhY3RpdmVEaXNjb3VudCIsImdldENoZWNrZWRTa3UiLCJhZGRUb0NhcnQiLCJzZXRDb29raWUiLCJkYXlzIiwiZXhwaXJlcyIsImRhdGUiLCJEYXRlIiwic2V0VGltZSIsImdldFRpbWUiLCJ0b1VUQ1N0cmluZyIsImNvb2tpZSIsInJlZGlyZWN0T3JTaG93QnVzaW5lc3NFcnJvciIsInJlc3VsdCIsImRhdGEiLCJlcnJvcnMiLCJsZW5ndGgiLCJidG5BdHJpYnV0ZSIsImVycm9yTWVzc2FnZSIsImNvZGUiLCJTVE9DS19FUlJPUl9DT0RFIiwiaTE4biIsImdldE1lc3NhZ2UiLCJidG5zIiwicXVlcnlTZWxlY3RvckFsbCIsImkiLCJjbGFzc0xpc3QiLCJjb250YWlucyIsInNrdVByb2R1Y3QiLCJsb2NhdGlvbiIsImhyZWYiLCJvcHRpb25zIiwiYnV0dG9uV2l0aExvYWRpbmciLCJtZXRob2QiLCJzdWNjZXNzIiwicmVzdENsaWVudCIsInJlcXVlc3QiLCJtZXNzYWdlIiwiZXJyb3JFbGVtZW50cyIsImlubmVySFRNTCIsInJlbW92ZUNsYXNzIiwiY2hlY2tQZXJzb25hIiwicGVyc29uYVN0YXR1cyIsImhhbmRsZUJ1eUV2ZW50IiwiaGFzUGVyc29uYSIsIm5ld1BlcnNvbmEiLCJzZXRMaXN0ZW5lcnMiLCJsaXZlIiwiaGlkZU9yU2hvd01haW5CdXlCdXR0b24iLCJoaWRlIiwiYnRuIiwiYWRkQ2xhc3MiLCJOc1N0b3JlIiwic2t1cyIsIm5zU3RvcmFnZSIsImdldCIsInRvU3RyaW5nIiwiZmluZCIsImUiLCJzZWxsZXJJZCIsInN1YiJdLCJtYXBwaW5ncyI6IkFBQUEsY0FDQyxXQWdDQyxRQUFTQSxHQUFnQ0MsR0FDdkMsTUFBeUIsS0FBbEJBLEVBQU9DLE9BYWhCLFFBQVNDLEdBQXdCQyxFQUFpQkMsR0FDN0NBLEVBRURDLEVBQWlCRixJQUVqQkcsRUFBVUgsRUFDVkksS0FHRkMsSUFTRixRQUFTQyxHQUE2QkMsR0FDcEMsSUFBSUEsRUFBSyxDQUNQLEdBQUlDLEdBQVVDLFNBQVNDLGNBQWMsc0JBQ2pDQyxFQUFZLEVBQVksb0JBQXNCLHNCQUVsRCxZQURBQyxHQUFhSCxTQUFTQyxj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U0MsY0FBYyxzQkFDcENNLEVBQW9CUCxTQUFTQyxjQUFjLHlCQUU1Q3NGLElBQWNDLElBQWVqRixFQUM5QlEsT0FBT0MsUUFBUUMsU0FBU0MsSUFBSSw4Q0FBK0NrRSxHQUUzRTlELElBRUYsTUFBT1UsR0FDUEMsUUFBUUQsTUFBTSxnQ0FBaUNBLElBU25ELFFBQVN5RCxLQUNQMUUsT0FBT0MsUUFBUTBFLEtBQUssa0JBQW1CLFFBQVNKLEdBT2xELFFBQVNLLEdBQXdCQyxHQUMvQixJQUNFLEdBQUlDLEdBQU03RixTQUFTQyxjQUFjLDBDQUU5QjRGLEtBQ0VELEVBQ0Q3RSxPQUFPQyxRQUFROEUsU0FBU0QsRUFBSyxRQUU3QjlFLE9BQU9DLFFBQVFtRSxZQUFZVSxFQUFLLFNBR3BDLE1BQU83RCxHQUNQQyxRQUFRRCxNQUFNLHlDQUEwQ0EsSUFwVzVELEdBR0V0QyxHQUNBb0IsRUFKRVYsRUFBcUIsa0JBQ3ZCMEIsS0FDQVksRUFBbUIsRUFHbkJxQixFQUFtQix5QkFFakJ0RCxFQUFRTSxPQUFPQyxRQUFRK0UsUUFTdkJuRCxFQUFnQixTQUFTOUMsRUFBS3FDLEdBQ2hDLEdBQUk2RCxHQUFPakYsUUFBVUEsT0FBT0MsU0FBV0QsT0FBT0MsUUFBUWlGLFdBQWFsRixPQUFPQyxRQUFRaUYsVUFBVUMsSUFBT25GLE9BQU9DLFFBQVFpRixVQUFVQyxJQUFJLGdCQUVoSSxPQURBL0QsR0FBU0EsRUFBT2dFLGFBQ1pILEVBQUtJLEtBQUssU0FBU0MsR0FBSyxNQUFPQSxHQUFFdkcsTUFBUUEsR0FBT3VHLEVBQUVDLFdBQWFuRSxNQTBWcEUsV0FDQ3NELElBRUExRSxPQUFPQyxRQUFRQyxTQUFTc0YsSUFBSSx1QkFBd0JkLEdBQ3BEMUUsT0FBT0MsUUFBUUMsU0FBU3NGLElBQUksZ0NBQWlDWiIsImZpbGUiOiJfcmVmYWN0b3JpbmcvX2NvbXBvbmVudHMvcHJvZHVjdC9jYWxsLXRvLWFjdGlvbi9hbGwvY2FsbC10by1hY3Rpb24ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuKGZ1bmN0aW9uKCkge1xuICB2YXIgUFJPRFVDVF9CVVlfQlVUVE9OID0gJy5idXktYnV0dG9uLW5vdycsXG4gICAgUEVSU09OQV9QQVlMT0FEID0gW10sXG4gICAgREVGQVVMVF9RVUFOVElUWSA9IDEsXG4gICAgUEVSU09OQSxcbiAgICBTSVpFLFxuICAgIFNUT0NLX0VSUk9SX0NPREUgPSAnaXRlbS5zdG9jay51bmF2YWlsYWJsZSc7XG5cbiAgdmFyIHN0b3JlID0gd2luZG93LmZyZWVkb20uTnNTdG9yZTtcblxuICAvKipcbiAgICogW2dldFNrdXNdXG4gICAqIGdldCBMb2NhbFN0b3JhZ2Ugc2t1c1xuICAgKiBAcGFyYW0ge1N0cmluZ30gc2t1IFtza3VdXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBzZWxsZXIgW3NrdV1cbiAgICogQHJldHVybiB7Qm9vbGVhbn0gICAgICAgIFtkZXNjcmlwdGlvbl1cbiAgICovXG4gIHZhciBnZXRDaGVja2VkU2t1ID0gZnVuY3Rpb24oc2t1LCBzZWxsZXIpIHtcbiAgICB2YXIgc2t1cyA9IHdpbmRvdyAmJiB3aW5kb3cuZnJlZWRvbSAmJiB3aW5kb3cuZnJlZWRvbS5uc1N0b3JhZ2UgJiYgd2luZG93LmZyZWVkb20ubnNTdG9yYWdlLmdldCA/ICh3aW5kb3cuZnJlZWRvbS5uc1N0b3JhZ2UuZ2V0KCdjcF9za3UnKSB8fCBbXSkgOiBbXTtcbiAgICBzZWxsZXIgPSBzZWxsZXIudG9TdHJpbmcoKTtcbiAgICBpZiAoc2t1cy5maW5kKGZ1bmN0aW9uKGUpIHsgcmV0dXJuIGUuc2t1ID09PSBza3UgJiYgZS5zZWxsZXJJZCA9PT0gc2VsbGVyOyB9KSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICAvKipcbiAgICogW2lzTm90V2hpdGVTcGFjZXNPbmx5T3JVbmRlZmluZWRdXG4gICAqIHRyaW0gcGVyc29uYSBzdHJpbmcgbmFtZVxuICAgKiBAcGFyYW0gIHtTdHJpbmd9ICBzdHJpbmcgW2Rlc2NyaXB0aW9uXVxuICAgKiBAcmV0dXJuIHtCb29sZWFufSAgICAgICAgW2Rlc2NyaXB0aW9uXVxuICAgKi9cbiAgZnVuY3Rpb24gaXNOb3RXaGl0ZVNwYWNlc09ubHlPclVuZGVmaW5lZChzdHJpbmcpIHtcbiAgICByZXR1cm4gc3RyaW5nLnRyaW0oKSAhPT0gJyc7XG4gIH1cblxuICAvKipcbiAgICogW3B1YlN1YlBlcnNvbmFHZXRIYW5kbGVyXVxuICAgKiBQZXJzb25hbGl6YXRpb24gdmFsdWVzIGNhbGxiYWNrIGhhbmRsZXJcbiAgICogU2V0cyBwZXJzb25hbGl6YXRpb24gaW4gUEVSU09OQSBnbG9iYWwgY29uc3RhbnRcbiAgICogQ2FsbCBidWlsZFBlcnNvbmFQYXlsb2FkIHRvIGNyZWF0ZSBwZXJzb25hIHNlbmQgcGF5bG9hZCB0byBhZGRUb0NhcnRcbiAgICogQ2FsbCBidWlsZEFkZFRvQ2FydFBheWxvYWQgdG8gY3JlYXRlIGFkZFRvQ2FydCBwYXlsb2FkXG4gICAqIEBwYXJhbSAge09iamVjdH0gcGVyc29uYWxpemF0aW9uIFtwZXJzb25hbGl6YXRpb24gdmFsdWVzIGZyb20gcGVyc29uYSBwdWJzdWIgY2FsbGJhY2tdXG4gICAqIEBwYXJhbSAge2Jvb2xlYW59IGlzTGlzdCBbdG8ga25vdyBpZiB0aGUgcGVyc29uYSBpcyBhbiBhcnJheSBvciBub3RdXG4gICAqIEByZXR1cm4ge31cbiAgICovXG4gIGZ1bmN0aW9uIHB1YlN1YlBlcnNvbmFHZXRIYW5kbGVyKHBlcnNvbmFsaXphdGlvbiwgaXNMaXN0KSB7XG4gICAgaWYoaXNMaXN0KSB7XG4gICAgICAvL25ldyBwZXJzb25hbGl6YXRpb24gZm9ybWF0IChhcnJheSlcbiAgICAgIGJ1aWxkUGVyc29uYUxpc3QocGVyc29uYWxpemF0aW9uKTtcbiAgICB9IGVsc2Uge1xuICAgICAgUEVSU09OQSA9IHBlcnNvbmFsaXphdGlvbjtcbiAgICAgIGJ1aWxkUGVyc29uYVBheWxvYWQoKTtcbiAgICB9XG5cbiAgICBidWlsZEFkZFRvQ2FydFBheWxvYWQoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBbcHViU3ViQ29sb3JGbGF2b3JTaXplSGFuZGxlcl1cbiAgICogMSAtIFRyaWdnZXJzIGEgcHViIHN1YiBldmVudCB0byBjb2xvciBmbGF2b3Igc2l6ZSBhbmQgdXNlcyBjYWxsYmFjayBmdW5jdGlvbiB0byBzZXQgU0laRSBhbmRcbiAgICogc2VuZCBidWlsZHBheWxvYWQgZnVuY3Rpb25cbiAgICogQHJldHVybiB7fVxuICAgKi9cbiAgZnVuY3Rpb24gcHViU3ViQ29sb3JGbGF2b3JTaXplSGFuZGxlcihza3UpIHtcbiAgICBpZighc2t1KSB7XG4gICAgICB2YXIgaGFzU2l6ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXR5cGU9XCJzaXplXCJdJyk7XG4gICAgICB2YXIgZXJyb3JBdHRyID0gKGhhc1NpemUpID8gJ2RhdGEtc2l6ZS1pbnZhbGlkJyA6ICdkYXRhLXZvbHRhZ2UtaW52YWxpZCc7XG4gICAgICBzaG93QnV5RXJyb3IoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihQUk9EVUNUX0JVWV9CVVRUT04pLmdldEF0dHJpYnV0ZShlcnJvckF0dHIpKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIGhhc0Zvcm1QZXJzb25hID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtcGVyc29uYV0nKTtcbiAgICB2YXIgaGFzQnVpbGRlclBlcnNvbmEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1idWlsZGVyLXBlcnNvbmFdJyk7XG4gICAgdmFyIHNlbGVjdGVkUGVyc29uYSA9IHN0b3JlLmdldFN0YXRlKCkucGRwLnBlcnNvbmEuc2VsZWN0ZWQ7XG5cbiAgICBTSVpFID0gc2t1O1xuICAgIC8qIHJlYWQgc2l6ZSB2YWx1ZXMgdmlhIHB1YiBzdWIgYW5kIHB1Ymxpc2ggaXQgaW50byBnbG9iYWwgdmFyaWFibGUgU0laRSAqL1xuICAgIGlmKGhhc0J1aWxkZXJQZXJzb25hKSB7IC8vaWYgYnVpbGRlciBwZXJzb25hXG4gICAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ2J1aWxkZXIucGVyc29uYWxpemF0aW9uLmdldCcsIHB1YlN1YlBlcnNvbmFHZXRIYW5kbGVyKTtcbiAgICB9IGVsc2UgaWYgKGhhc0Zvcm1QZXJzb25hKSB7IC8vaWYgZm9ybSBwZXJzb25hXG4gICAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ3BlcnNvbmFsaXphdGlvbi5nZXQnLCBwdWJTdWJQZXJzb25hR2V0SGFuZGxlcik7XG4gICAgfSBlbHNlIGlmIChzZWxlY3RlZFBlcnNvbmEgJiYgc2VsZWN0ZWRQZXJzb25hLnN0YXRlKSB7IC8vaWYgcGVyc29uYSBoYXMgYmVlbiBzYXZlZCBpbnRvIHN0b3JlXG4gICAgICBwdWJTdWJQZXJzb25hR2V0SGFuZGxlcihzZWxlY3RlZFBlcnNvbmEubGlzdCwgdHJ1ZSk7XG4gICAgfSBlbHNlIHsgLy8gaWYgdHJhZGl0aW9uYWwgcGVyc29uYVxuICAgICAgcHViU3ViUGVyc29uYUdldEhhbmRsZXIodW5kZWZpbmVkKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogW2lzU2l6ZVZhbGlkXVxuICAgKiBTdGFydHMgYSBwdWIgc3ViIGV2ZW50IGZvciBjb2xvciBmbGF2b3Igc2l6ZSB0byBnYXJhbnRlZSBzaXplIGluIGJlZm9yZSBzZW5kIGFkZFRvQ2FydFxuICAgKiBAY2FsbGJhY2sgZnVuY3Rpb24ge3B1YlN1YkNvbG9yRmxhdm9yU2l6ZUhhbmRsZXJ9XG4gICAqL1xuICBmdW5jdGlvbiBpc1NpemVWYWxpZCgpIHtcbiAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ0NvbG9yRmxhdm9yU2l6ZS5zZWxlY3Quc2l6ZScsIHB1YlN1YkNvbG9yRmxhdm9yU2l6ZUhhbmRsZXIpO1xuICB9XG5cbiAgLyoqXG4gICAqIFtidWlsZFBlcnNvbmFQYXlsb2FkXVxuICAgKiBidWlsZCBwZXJzb25hbGl6YXRpb24gcGF5bG9hZCBhbmQgc2V0cyBpdCBpbiB7UEVSU09OQV9QQVlMT0FEfVxuICAgKiBAcmV0dXJuIHt9XG4gICAqL1xuICBmdW5jdGlvbiBidWlsZFBlcnNvbmFQYXlsb2FkKCkge1xuICAgIGlmKFBFUlNPTkEpIHtcbiAgICAgIHZhciBwZXJzb25hbGl6YXRpb25zID0gW107XG4gICAgICAvKiB7T2JqZWN0fSBwZXJzb25hICovXG4gICAgICAvKiBTZXQgbmFtZSAqL1xuICAgICAgaWYgKFBFUlNPTkEubmFtZVxuICAgICAgICYmIFBFUlNPTkEubmFtZSAhPT0gJydcbiAgICAgICAmJiBpc05vdFdoaXRlU3BhY2VzT25seU9yVW5kZWZpbmVkKFBFUlNPTkEubmFtZSkpIHtcbiAgICAgICAgcGVyc29uYWxpemF0aW9ucy5wdXNoKHtcbiAgICAgICAgICBza3U6IFBFUlNPTkEubmFtZVNrdSxcbiAgICAgICAgICB2YWx1ZTogUEVSU09OQS5uYW1lXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvKiBTZXQgTnVtYmVyICovXG4gICAgICBpZiAoUEVSU09OQS5udW1iZXIgJiYgUEVSU09OQS5udW1iZXIgIT09ICcnKSB7XG4gICAgICAgIHBlcnNvbmFsaXphdGlvbnMucHVzaCh7XG4gICAgICAgICAgc2t1OiBQRVJTT05BLm51bWJlclNrdSxcbiAgICAgICAgICB2YWx1ZTogUEVSU09OQS5udW1iZXJcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIFBFUlNPTkFfUEFZTE9BRCA9IHBlcnNvbmFsaXphdGlvbnM7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gYnVpbGRQZXJzb25hTGlzdChwZXJzb25hTGlzdCkge1xuICAgIHRyeSB7XG4gICAgICBQRVJTT05BX1BBWUxPQUQgPSBwZXJzb25hTGlzdDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignY2FsbC10by1hY3Rpb24uYnVpbGRQZXJzb25hTGlzdCcsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogZnVuY3Rpb24gdG8gc2VhcmNoIGFuZCBnZXQgdGhlIHNlbGxlciBvZiBwcm9kdWN0XG4gICAqL1xuICBmdW5jdGlvbiBnZXRTZWxsZXIoKSB7XG4gICAgdHJ5IHtcbiAgICAgIC8vaGFzIHNlbGxlciBvbiB0aGUgYnV0dG9uXG4gICAgICB2YXIgc2VsbGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihQUk9EVUNUX0JVWV9CVVRUT04pLmdldEF0dHJpYnV0ZSgnZGF0YS1zZWxsZXInKTtcbiAgICAgIGlmKHNlbGxlcikgcmV0dXJuICtzZWxsZXI7XG5cbiAgICAgIC8vaWYgaGFzIG5vIHNlbGxlciBvbiB0aGUgYnV0dG9uXG4gICAgICBzZWxsZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbcHJvZHVjdC1kYXRhLXNlbGxlcl0nKS5nZXRBdHRyaWJ1dGUoJ3Byb2R1Y3QtZGF0YS1zZWxsZXInKTtcbiAgICAgIGlmKHNlbGxlcikgcmV0dXJuICtzZWxsZXI7XG5cbiAgICAgIC8vZGVmYXVsdFxuICAgICAgcmV0dXJuIDA7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ2NhbGwtdG8tYWN0aW9uLmdldFNlbGxlcicsIGVycm9yKTtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgcGVyc29uYWxpemF0aW9uIHBheWxvYWRcbiAgICogQHJldHVybiB7QXJyYXl9XG4gICAqL1xuICBmdW5jdGlvbiBnZXRQZXJzb25hUGF5bG9hZCgpIHtcbiAgICAvLyBHZXQgcGVyc29uYSBwYXlsb2FkIG9ubHkgaWYgc2VsbGVyIGlzIG5ldHNob2VzXG4gICAgaWYoZ2V0U2VsbGVyKCkgPT09IDApIHtcbiAgICAgIHJldHVybiBQRVJTT05BX1BBWUxPQUQ7XG4gICAgfVxuICAgIHJldHVybiBbXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBbYnVpbGRBZGRUb0NhcnRQYXlsb2FkXVxuICAgKiBCdWlsZCBhZGRUb0NhcnQgcGF5bG9hZCBhbmQgY2FsbHMgYWRkVG9DYXJ0IHBheWxvYWQgd2l0aCBpdGVtcyBzZXQgaW5cbiAgICogQHJldHVybiB7fVxuICAgKi9cbiAgZnVuY3Rpb24gYnVpbGRBZGRUb0NhcnRQYXlsb2FkKCkge1xuICAgIGlmICh3aW5kb3cuV2Fuc1Rvb2xzKSB7XG4gICAgICB3aW5kb3cuV2Fuc1Rvb2xzICYmIHdpbmRvdy5XYW5zVG9vbHMuZWNQcm9kdWN0KCdhZGQnKTtcbiAgICB9XG4gICAgdmFyIHBheWxvYWQgPSB7XG4gICAgICBpdGVtczogW3tcbiAgICAgICAgc2t1OiBTSVpFLFxuICAgICAgICBxdWFudGl0eTogREVGQVVMVF9RVUFOVElUWSxcbiAgICAgICAgc2VsbGVyOiBnZXRTZWxsZXIoKSxcbiAgICAgICAgcGVyc29uYWxpemF0aW9uczogZ2V0UGVyc29uYVBheWxvYWQoKSxcbiAgICAgICAgaW50ZXJhY3RpdmVEaXNjb3VudDogZ2V0Q2hlY2tlZFNrdShTSVpFLCBnZXRTZWxsZXIoKSlcbiAgICAgIH1dXG4gICAgfTtcbiAgICBhZGRUb0NhcnQocGF5bG9hZCk7XG4gIH1cblxuICBmdW5jdGlvbiBzZXRDb29raWUobmFtZSwgdmFsdWUsIGRheXMpIHtcbiAgICB2YXIgZXhwaXJlcyA9ICcnO1xuICAgIGlmIChkYXlzKSB7XG4gICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICBkYXRlLnNldFRpbWUoZGF0ZS5nZXRUaW1lKCkgKyBkYXlzICogMjQgKiA2MCAqIDYwICogMTAwMCk7XG4gICAgICBleHBpcmVzID0gXCI7IGV4cGlyZXM9XCIgKyBkYXRlLnRvVVRDU3RyaW5nKCk7XG4gICAgfVxuICAgIGRvY3VtZW50LmNvb2tpZSA9IG5hbWUgKyBcIj1cIiArICh2YWx1ZSB8fCBcIlwiKSArIGV4cGlyZXMgKyBcIjsgcGF0aD0vXCI7XG4gIH1cblxuICAvKipcbiAgICogUmVkaXJlY3QgdG8gY2FydCBhZnRlciBhZGRUb0NhcnQgc3VjY2VzcyBvciBzaG93IGJ1c2luZXNzIGVycm9yXG4gICAqXG4gICAqIEBwYXJhbSAge09iamVjdH0gcGF5bG9hZCAtIGFkZFRvQ2FydCBwYXlsb2FkIGJ1aWxkZWRcbiAgICovXG4gIGZ1bmN0aW9uIHJlZGlyZWN0T3JTaG93QnVzaW5lc3NFcnJvcihyZXN1bHQpIHtcbiAgICBpZiAocmVzdWx0LmRhdGEuZXJyb3JzICYmIHJlc3VsdC5kYXRhLmVycm9ycy5sZW5ndGggPiAwKSB7XG5cbiAgICAgIHZhciBidG5BdHJpYnV0ZSA9ICdkYXRhLWVycm9yJztcbiAgICAgIHZhciBlcnJvck1lc3NhZ2UgPSBudWxsO1xuICAgICAgLy9zaG93IHRoZSBmaXJzdCBlcnJvclxuICAgICAgaWYgKHJlc3VsdC5kYXRhLmVycm9yc1swXS5jb2RlID09PSBTVE9DS19FUlJPUl9DT0RFKSB7XG4gICAgICAgIGJ0bkF0cmlidXRlID0gJ2RhdGEtZXJyb3ItJyArIFNUT0NLX0VSUk9SX0NPREU7XG4gICAgICB9XG5cbiAgICAgIGlmKHJlc3VsdC5kYXRhLmVycm9yc1swXS5jb2RlID09PSAncGVyc29uYWxpemF0aW9uLm5vdC5hbGxvd2VkJykge1xuICAgICAgICBlcnJvck1lc3NhZ2UgPSB3aW5kb3cuZnJlZWRvbS5pMThuLmdldE1lc3NhZ2UoJ3Byb2R1Y3RfZXJyb3JzX2NhcnRfcGVyc29uYV9ub3RfYWxsb3cnKTsgLy9nZXQgbWVzc2FnZSBlcnJvclxuICAgICAgfVxuXG4gICAgICB2YXIgYnRucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoUFJPRFVDVF9CVVlfQlVUVE9OKTtcbiAgICAgIGlmKGJ0bnMpIHtcbiAgICAgICAgdmFyIGkgPSBidG5zLmxlbmd0aDtcblxuICAgICAgICB3aGlsZShpLS0pIHtcbiAgICAgICAgICBzaG93QnV5RXJyb3IoZXJyb3JNZXNzYWdlIHx8IGJ0bnNbaV0uZ2V0QXR0cmlidXRlKGJ0bkF0cmlidXRlKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8vIElmIHF1aWNrVmlldyB3aWxsIG5vdCBoYXZlIHJlZGlyZWN0IGFmdGVyIGFkZCB0byBjYXJ0XG4gICAgfSBlbHNlIGlmICh3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ3F1aWNrVmlldy5oYXNRdWlja1ZpZXcnKSkge1xuICAgICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIucHViKCdxdWlja1ZpZXcuY2xvc2UnKTtcbiAgICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnB1YignbWluaUNhcnQuZml4ZWQnKTtcbiAgICB9IGVsc2UgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hYi10ZXN0LW1pbmljYXJ0JykpIHtcbiAgICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnB1YignbWluaUNhcnQuZml4ZWQnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpLmNsYXNzTGlzdC5jb250YWlucygndGVzdF9fYWItdXBzZWxsJykpIHtcbiAgICAgICAgaWYoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNob3djYXNlIC5idXktYm94IC5idXktYnV0dG9uLW5vdycpICE9PSBudWxsKSB7XG4gICAgICAgICAgdmFyIHNrdVByb2R1Y3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2hvd2Nhc2UgLmJ1eS1ib3ggLmJ1eS1idXR0b24tbm93JykuZ2V0QXR0cmlidXRlKCdkYXRhLXNrdScpO1xuICAgICAgICAgIGlmKHNrdVByb2R1Y3QgPT09ICcnKSB7XG4gICAgICAgICAgICBza3VQcm9kdWN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbdHlwZT1cImhpZGRlblwiXVtkYXRhLXByb2R1Y3Qtc2t1XScpLmdldEF0dHJpYnV0ZSgnZGF0YS1wcm9kdWN0LXNrdScpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBzZXRDb29raWUoJ3Byb2R1Y3RVcFNlbGwnLCBza3VQcm9kdWN0LCAxKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzZXRDb29raWUoJ3Byb2R1Y3RVcFNlbGwnLCAnJywgMSk7XG4gICAgICAgIH1cblxuICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9ICcvdXBzZWxsLWNhcnQnOy8qIENoYW5nZXIgcm91dGVyIGZvciB0ZXN0IGFiICovXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9ICcvY2FydCc7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBwcm9kdWN0IHRvIGNhcnQuXG4gICAqXG4gICAqIEBwYXJhbSAge09iamVjdH0gcGF5bG9hZCAtIGFkZFRvQ2FydCBwYXlsb2FkIGJ1aWxkZWRcbiAgICogQGNhbGxiYWNrIGNhbGwgYWRkIHRvIGNhcnQgQVBJIGFuZCByZWRpcmVjdHMgdG8gY2FydCBvciBzaG93IGVycm9yXG4gICAqL1xuICBmdW5jdGlvbiBhZGRUb0NhcnQocGF5bG9hZCkge1xuICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgYnV0dG9uV2l0aExvYWRpbmc6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoUFJPRFVDVF9CVVlfQlVUVE9OKSxcbiAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgZGF0YTogcGF5bG9hZCxcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3VsdCkge1xuICAgICAgICByZWRpcmVjdE9yU2hvd0J1c2luZXNzRXJyb3IocmVzdWx0KTtcbiAgICAgIH0sXG4gICAgICBlcnJvcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHNob3dCdXlFcnJvcihkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFBST0RVQ1RfQlVZX0JVVFRPTikuZ2V0QXR0cmlidXRlKCdkYXRhLWVycm9yJykpO1xuICAgICAgfVxuICAgIH07XG4gICAgd2luZG93LmZyZWVkb20ucmVzdENsaWVudC5yZXF1ZXN0KCcvY2FydC9hZGQnLCBvcHRpb25zKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBbc2hvd0J1eUVycm9yXVxuICAgKiBzaG93IGVycm9yIG1lc3NhZ2UgaW4gY2FzZSBvZiBhZGRUb0NhcnQgZmFpbHNcbiAgICogQHBhcmFtICB7U3RyaW5nfSBtZXNzYWdlIFtlcnJvciBtZXNzYWdlXVxuICAgKiBAcmV0dXJuIHt9XG4gICAqL1xuICBmdW5jdGlvbiBzaG93QnV5RXJyb3IobWVzc2FnZSkge1xuICAgIHRyeSB7XG4gICAgICB2YXIgZXJyb3JFbGVtZW50cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJyNidXktZXJyb3InKTtcbiAgICAgIGlmKGVycm9yRWxlbWVudHMpIHtcbiAgICAgICAgdmFyIGkgPSBlcnJvckVsZW1lbnRzLmxlbmd0aDtcblxuICAgICAgICB3aGlsZShpLS0pIHtcbiAgICAgICAgICBlcnJvckVsZW1lbnRzW2ldLmlubmVySFRNTCA9IG1lc3NhZ2U7XG4gICAgICAgICAgd2luZG93LmZyZWVkb20ucmVtb3ZlQ2xhc3MoZXJyb3JFbGVtZW50c1tpXSwgJ2hpZGRlbicpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ2NhbGwtdG8tYWN0aW9uLnNob3dCdXlFcnJvcicsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogZnVuY3Rpb24gdG8gdmFsaWRhdGUgaWYgcGVyc29uYSBpcyBvcGVuIGFuZCB0aGUgZmllbGRzIGlzIHBhcnRpYWwgY29tcGxldGVcbiAgICogQHBhcmFtIHtib29sZWFufSBwZXJzb25hU3RhdHVzIHN0YXR1cyBvZiBwZXJzb25hXG4gICAqL1xuICBmdW5jdGlvbiBjaGVja1BlcnNvbmEocGVyc29uYVN0YXR1cykge1xuICAgIHRyeSB7XG4gICAgICBpZihwZXJzb25hU3RhdHVzKSB7XG4gICAgICAgIGlzU2l6ZVZhbGlkKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgZXJyb3JNZXNzYWdlID0gd2luZG93LmZyZWVkb20uaTE4bi5nZXRNZXNzYWdlKCdwZXJzb25hbGl6YXRpb25fZmllbGRzX2dlbmVyaWNfZXJyb3InKTtcbiAgICAgICAgc2hvd0J1eUVycm9yKGVycm9yTWVzc2FnZSk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ2NhbGwtdG8tYWN0aW9uLmNoZWNrUGVyc29uYScsIGVycm9yKTtcbiAgICAgIGlzU2l6ZVZhbGlkKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIGZ1bmN0aW9uIHRvIGhhbmRsZSB0aGUgYnV5IGJ1dHRvbiBldmVudCwgY2hlY2sgdGhlIHZhbGlkYXRpb25zIGV0Yy4uLlxuICAgKi9cbiAgZnVuY3Rpb24gaGFuZGxlQnV5RXZlbnQoKSB7XG4gICAgdHJ5IHtcbiAgICAgIHZhciBoYXNQZXJzb25hID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtcGVyc29uYV0nKTtcbiAgICAgIHZhciBuZXdQZXJzb25hID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtbmV3LXBlcnNvbmFdJyk7XG4gICAgICB2YXIgaGFzQnVpbGRlclBlcnNvbmEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1idWlsZGVyLXBlcnNvbmFdJyk7XG5cbiAgICAgIGlmKGhhc1BlcnNvbmEgJiYgbmV3UGVyc29uYSAmJiAhaGFzQnVpbGRlclBlcnNvbmEpIHtcbiAgICAgICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIucHViKCdDb2xvckZsYXZvclNpemUuaGFuZGxlQnV5RXZlbnQuY2hlY2tQZXJzb25hJywgY2hlY2tQZXJzb25hKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlzU2l6ZVZhbGlkKCk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ2NhbGwtdG8tYWN0aW9uLmhhbmRsZUJ1eUV2ZW50JywgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBbc2V0TGlzdGVuZXJzXVxuICAgKiBzZXQgYWxsIHB1YiBzdWIgbGlzdGVuZXJzIGZvciBwZXJzb25hbGl6YXRpb24gc2hpcnRcbiAgICogQHJldHVybiB7fVxuICAgKi9cbiAgZnVuY3Rpb24gc2V0TGlzdGVuZXJzKCkge1xuICAgIHdpbmRvdy5mcmVlZG9tLmxpdmUoJy5idXktYnV0dG9uLW5vdycsICdjbGljaycsIGhhbmRsZUJ1eUV2ZW50KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBmdW5jdGlvbiB0byBoaWRlIG9yIHNob3cgdGhlIG1haW4gYnV5IGJ1dHRvblxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IGhpZGUgLSBwYXJhbSB0byBkZWZpbmUgaWYgdGhlIGZ1bmN0aW9uIGhpZGUgb3Igc2hvd1xuICAgKi9cbiAgZnVuY3Rpb24gaGlkZU9yU2hvd01haW5CdXlCdXR0b24oaGlkZSkge1xuICAgIHRyeSB7XG4gICAgICB2YXIgYnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2J1eS1idXR0b24td3JhcHBlci5tYWluLWJ1eS1idXR0b24tbm93Jyk7XG5cbiAgICAgIGlmKGJ0bikge1xuICAgICAgICBpZihoaWRlKSB7XG4gICAgICAgICAgd2luZG93LmZyZWVkb20uYWRkQ2xhc3MoYnRuLCAnaGlkZScpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHdpbmRvdy5mcmVlZG9tLnJlbW92ZUNsYXNzKGJ0biwgJ2hpZGUnKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdjYWxsLXRvLWFjdGlvbi5oaWRlT3JTaG93TWFpbkJ1eUJ1dHRvbicsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogW3NlbGYgY29udGFpbmVkIGZ1bmN0aW9uXVxuICAgKiB0cmlnZ2VycyBhbGwgZXZlbnQgbGlzdGVybmVycyBmb3IgdGhpcyBjb21wb25lbnRcbiAgICogQHJldHVybiB7fVxuICAgKi9cbiAgKGZ1bmN0aW9uKCkge1xuICAgIHNldExpc3RlbmVycygpO1xuXG4gICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIuc3ViKCdjYWxsVG9BY3Rpb24ucmVzdGFydCcsIHNldExpc3RlbmVycyk7XG4gICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIuc3ViKCdjYWxsVG9BY3Rpb24uaGlkZS5tYWluLWJ1dHRvbicsIGhpZGVPclNob3dNYWluQnV5QnV0dG9uKTtcbiAgfSgpKTtcblxufSgpKTtcbiJdfQ==
