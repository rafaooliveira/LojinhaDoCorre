"use strict";String.prototype.includes||(String.prototype.includes=function(t,e){if(t instanceof RegExp)throw TypeError("first argument must not be a RegExp");return void 0===e&&(e=0),this.indexOf(t,e)!==-1}),function(){var t,e=function(t,e){return new Promise(function(i,s){var r={method:"get",type:"html",data:e,success:function(t){i(t)},error:function(t){console.error("wishlist error: ",t),s(!1)}};window.freedom.restClient.request(t,r)})},i=function(t,i){if(t){var s={},r="/wishlist/delete/"+i,o=t&&t.parentNode?t.parentNode:null;document.querySelector(".floating-button")?document.querySelectorAll(".wishlist").forEach(function(t){t.classList.remove("heart-active"),t.querySelector(".wishlist__heart i").classList.remove("ns-icon-wishlist-heart-active"),t.querySelector(".wishlist__heart i").classList.add("ns-icon-wishlist-heart")}):(o&&t.parentNode.classList.remove("heart-active"),t.querySelector("i").classList.remove("ns-icon-wishlist-heart-active"),t.querySelector("i").classList.add("ns-icon-wishlist-heart")),e(r,s).then()}},s=function(t,i){if(t){var s={},r="/wishlist/add/"+i,o=t&&t.parentNode?t.parentNode:null;document.querySelector(".floating-button")?document.querySelectorAll(".wishlist").forEach(function(t){t.querySelector(".wishlist__heart i").classList.remove("ns-icon-wishlist-heart"),t.querySelector(".wishlist__heart i").classList.add("ns-icon-wishlist-heart-active"),t.classList.add("heart-active")}):(o&&o.classList.add("heart-active"),t.querySelector("i").classList.remove("ns-icon-wishlist-heart"),t.querySelector("i").classList.add("ns-icon-wishlist-heart-active")),e(r,s).then();var n=window.freedom.getCookie("uuid");if(n&&n.includes("anonymous")){var c=window.location.pathname+"?"+t.getAttribute("data-href");c&&c.match(/zipCode=\d{8}/)&&(c=c.replace(/&?zipCode=\d{8}/,"")),window.location="/login?redirect="+c}}},r=function(t){var i=t.getAttribute("data-code"),s={},r="/wishlist/"+i;e(r,s).then(function(e){"false"!==e&&(t.querySelector(".wishlist__heart i").classList.remove("ns-icon-wishlist-heart"),t.querySelector(".wishlist__heart i").classList.add("ns-icon-wishlist-heart-active"))})},o=function(){var i={},s="/wishlist/all";e(s,i).then(function(e){t=JSON.parse(e)})},n=function(e){var i=e.getAttribute("data-code"),s=t.map(function(t){return t.code}).indexOf(i);s!==-1&&(e.querySelector(".wishlist__heart i").classList.remove("ns-icon-wishlist-heart"),e.querySelector(".wishlist__heart i").classList.add("ns-icon-wishlist-heart-active"))},c=function(e){var i=e?e.querySelector(".wishlist__heart"):document.querySelectorAll(".wishlist__heart");if(e)var s=setInterval(function(){t&&(clearInterval(s),n(i))},1e3);else i.forEach(function(t){r(t)})};window.freedom.nsPubSub.sub("wishlist.checkFavoriteProducts",c);var a=function(){var t=this.getAttribute("data-code");this.querySelector("i").classList.contains("ns-icon-wishlist-heart-active")?i(this,t):s(this,t)},l=function(t){var e=document.querySelectorAll(".wishlist__heart");e.length>1?e.forEach(function(e){t&&e.removeEventListener("click",a),e.addEventListener("click",a)}):window.freedom.live(".wishlist__heart","click",function(){var t=this.getAttribute("data-code");this.querySelector("i").classList.contains("ns-icon-wishlist-heart-active")?i(this,t):s(this,t)})};window.freedom.nsPubSub.sub("wishlist.clickListener",l),function(){try{var t=document.querySelector(".wishlist .wishlist__heart");if(t&&"pdp"===t.getAttribute("data-template"))"mobile"===t.getAttribute("data-device")&&window.freedom.nsPubSub.pub("wishlist.checkFavoriteProducts");else{var e=window.freedom.getCookie("uuid");e&&!e.includes("anonymous")&&o()}window.freedom.nsPubSub.pub("wishlist.clickListener")}catch(i){console.error(i)}}()}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl9yZWZhY3RvcmluZy9fY29tcG9uZW50cy9fYmVoYXZpb3Ivd2lzaGxpc3QvYWxsL3dpc2hsaXN0Lm1pbi5qcyJdLCJuYW1lcyI6WyJTdHJpbmciLCJwcm90b3R5cGUiLCJpbmNsdWRlcyIsInNlYXJjaCIsInN0YXJ0IiwiUmVnRXhwIiwiVHlwZUVycm9yIiwidW5kZWZpbmVkIiwidGhpcyIsImluZGV4T2YiLCJJVEVNU19JTl9XSVNITElTVCIsImdldFJlc3VsdEFwaSIsInVybCIsImRhdGEiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsIm9wdGlvbnMiLCJtZXRob2QiLCJ0eXBlIiwic3VjY2VzcyIsInJlc3BvbnNlIiwiZXJyb3IiLCJjb25zb2xlIiwid2luZG93IiwiZnJlZWRvbSIsInJlc3RDbGllbnQiLCJyZXF1ZXN0IiwicmVtb3ZlV2lzaGxpc3RJdGVtIiwiZWxlbWVudCIsImNvZGUiLCJwYXJlbnQiLCJwYXJlbnROb2RlIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwicXVlcnlTZWxlY3RvckFsbCIsImZvckVhY2giLCJpdGVtIiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwiYWRkIiwidGhlbiIsImFkZFdpc2hsaXN0SXRlbSIsInV1aWQiLCJnZXRDb29raWUiLCJjdXJyZW50VXJsIiwibG9jYXRpb24iLCJwYXRobmFtZSIsImdldEF0dHJpYnV0ZSIsIm1hdGNoIiwicmVwbGFjZSIsImdldFdpc2hMaXN0SXRlbUJ5Q29kZSIsInJlc3VsdCIsImdldEFsbEl0ZW1zT25XaXNobGlzdCIsIkpTT04iLCJwYXJzZSIsImNoZWNrSXRlbXNJbkFycmF5IiwiaGVhcnQiLCJjb2RlSW5MaXN0IiwibWFwIiwiY2hlY2tGYXZvcml0ZVByb2R1Y3RzIiwiaGVhcnRzIiwiYWxsSXRlbXMiLCJzZXRJbnRlcnZhbCIsImNsZWFySW50ZXJ2YWwiLCJuc1B1YlN1YiIsInN1YiIsImNsaWNrRXZlbnQiLCJjb250YWlucyIsImNsaWNrTGlzdGVuZXIiLCJjb21wb25lbnRSZWluaXQiLCJIRUFSVCIsImxlbmd0aCIsIml0ZW1zIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImFkZEV2ZW50TGlzdGVuZXIiLCJsaXZlIiwid2lzaGxpc3RIZWFydCIsInB1YiJdLCJtYXBwaW5ncyI6IkFBQUEsWUFHS0EsUUFBT0MsVUFBVUMsV0FDcEJGLE9BQU9DLFVBQVVDLFNBQVcsU0FBU0MsRUFBUUMsR0FHM0MsR0FBSUQsWUFBa0JFLFFBQ3BCLEtBQU1DLFdBQVUsc0NBR2xCLE9BRGNDLFVBQVZILElBQXVCQSxFQUFRLEdBQzVCSSxLQUFLQyxRQUFRTixFQUFRQyxVQUsvQixXQUVDLEdBQUlNLEdBUUFDLEVBQWUsU0FBVUMsRUFBS0MsR0FDaEMsTUFBTyxJQUFJQyxTQUFRLFNBQVNDLEVBQVNDLEdBQ25DLEdBQUlDLElBQ0ZDLE9BQVEsTUFDUkMsS0FBTSxPQUNOTixLQUFNQSxFQUNOTyxRQUFTLFNBQVVDLEdBQ2pCTixFQUFRTSxJQUVWQyxNQUFPLFNBQVVBLEdBQ2ZDLFFBQVFELE1BQU0sbUJBQW9CQSxHQUNsQ04sR0FBTyxJQUdYUSxRQUFPQyxRQUFRQyxXQUFXQyxRQUFRZixFQUFLSyxNQVV2Q1csRUFBcUIsU0FBVUMsRUFBU0MsR0FDMUMsR0FBSUQsRUFBUyxDQUNYLEdBQUloQixNQUNBRCxFQUFNLG9CQUFzQmtCLEVBQzVCQyxFQUFTRixHQUFXQSxFQUFRRyxXQUFhSCxFQUFRRyxXQUFhLElBRTlEQyxVQUFTQyxjQUFjLG9CQUN6QkQsU0FBU0UsaUJBQWlCLGFBQWFDLFFBQVMsU0FBU0MsR0FDdkRBLEVBQUtDLFVBQVVDLE9BQU8sZ0JBQ3RCRixFQUFLSCxjQUFjLHNCQUFzQkksVUFBVUMsT0FBTyxpQ0FDMURGLEVBQUtILGNBQWMsc0JBQXNCSSxVQUFVRSxJQUFJLDZCQUdyRFQsR0FDRkYsRUFBUUcsV0FBV00sVUFBVUMsT0FBTyxnQkFFdENWLEVBQVFLLGNBQWMsS0FBS0ksVUFBVUMsT0FBTyxpQ0FDNUNWLEVBQVFLLGNBQWMsS0FBS0ksVUFBVUUsSUFBSSwyQkFFM0M3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WSxFQUFnQmxDLEtBQU1zQixLQUs5Qk4sUUFBT0MsUUFBUXdDLFNBQVNDLElBQUkseUJBQTBCRyxHQUVyRCxXQUNDLElBQ0UsR0FBSVEsR0FBZ0I1QyxTQUFTQyxjQUFjLDZCQUUzQyxJQUFJMkMsR0FBaUUsUUFBaERBLEVBQWM3QixhQUFhLGlCQUNHLFdBQTlDNkIsRUFBYzdCLGFBQWEsZ0JBQzVCeEIsT0FBT0MsUUFBUXdDLFNBQVNhLElBQUksc0NBRXpCLENBQ0wsR0FBSW5DLEdBQU9uQixPQUFPQyxRQUFRbUIsVUFBVSxPQUNqQ0QsS0FBU0EsRUFBS3pDLFNBQVMsY0FDeEJtRCxJQUdKN0IsT0FBT0MsUUFBUXdDLFNBQVNhLElBQUksMEJBQzVCLE1BQU94RCxHQUNQQyxRQUFRRCxNQUFNQSIsImZpbGUiOiJfcmVmYWN0b3JpbmcvX2NvbXBvbmVudHMvX2JlaGF2aW9yL3dpc2hsaXN0L2FsbC93aXNobGlzdC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbi8qIGVzbGludC1kaXNhYmxlICovXG5pZiAoIVN0cmluZy5wcm90b3R5cGUuaW5jbHVkZXMpIHtcbiAgU3RyaW5nLnByb3RvdHlwZS5pbmNsdWRlcyA9IGZ1bmN0aW9uKHNlYXJjaCwgc3RhcnQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBpZiAoc2VhcmNoIGluc3RhbmNlb2YgUmVnRXhwKSB7XG4gICAgICB0aHJvdyBUeXBlRXJyb3IoJ2ZpcnN0IGFyZ3VtZW50IG11c3Qgbm90IGJlIGEgUmVnRXhwJyk7XG4gICAgfVxuICAgIGlmIChzdGFydCA9PT0gdW5kZWZpbmVkKSB7IHN0YXJ0ID0gMDsgfVxuICAgIHJldHVybiB0aGlzLmluZGV4T2Yoc2VhcmNoLCBzdGFydCkgIT09IC0xO1xuICB9O1xufVxuLyogZXNsaW50LWVuYWJsZSAqL1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gIHZhciBJVEVNU19JTl9XSVNITElTVDtcblxuICAvKipcbiAgICogQG1ldGhvZCBnZXRSZXN1bHRBcGlcbiAgICogQHBhcmFtIHtzdHJpbmd9IHVybFxuICAgKiBAcGFyYW0ge29iamVjdH0gZGF0YVxuICAgKiBHZXQgcmVzdWx0cyBmcm9tIGFwaVxuICAgKi9cbiAgdmFyIGdldFJlc3VsdEFwaSA9IGZ1bmN0aW9uICh1cmwsIGRhdGEpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgICAgbWV0aG9kOiAnZ2V0JyxcbiAgICAgICAgdHlwZTogJ2h0bWwnLFxuICAgICAgICBkYXRhOiBkYXRhLFxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlKTtcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ3dpc2hsaXN0IGVycm9yOiAnLCBlcnJvcik7XG4gICAgICAgICAgcmVqZWN0KGZhbHNlKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHdpbmRvdy5mcmVlZG9tLnJlc3RDbGllbnQucmVxdWVzdCh1cmwsIG9wdGlvbnMpO1xuICAgIH0pO1xuICB9O1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIHJlbW92ZVdpc2hsaXN0SXRlbVxuICAgKiBAcGFyYW0ge0hUTUxEb2N1bWVudH0gZWxlbWVudFxuICAgKiBAcGFyYW0ge3N0cmluZ30gY29kZVxuICAgKiBSZW1vdmUgaXRlbSBvbiB3aXNoIGxpc3RcbiAgICovXG4gIHZhciByZW1vdmVXaXNobGlzdEl0ZW0gPSBmdW5jdGlvbiAoZWxlbWVudCwgY29kZSkge1xuICAgIGlmIChlbGVtZW50KSB7XG4gICAgICB2YXIgZGF0YSA9IHt9O1xuICAgICAgdmFyIHVybCA9ICcvd2lzaGxpc3QvZGVsZXRlLycgKyBjb2RlO1xuICAgICAgdmFyIHBhcmVudCA9IGVsZW1lbnQgJiYgZWxlbWVudC5wYXJlbnROb2RlID8gZWxlbWVudC5wYXJlbnROb2RlIDogbnVsbDtcblxuICAgICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mbG9hdGluZy1idXR0b24nKSkge1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcud2lzaGxpc3QnKS5mb3JFYWNoKCBmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgaXRlbS5jbGFzc0xpc3QucmVtb3ZlKCdoZWFydC1hY3RpdmUnKTtcbiAgICAgICAgICBpdGVtLnF1ZXJ5U2VsZWN0b3IoJy53aXNobGlzdF9faGVhcnQgaScpLmNsYXNzTGlzdC5yZW1vdmUoJ25zLWljb24td2lzaGxpc3QtaGVhcnQtYWN0aXZlJyk7XG4gICAgICAgICAgaXRlbS5xdWVyeVNlbGVjdG9yKCcud2lzaGxpc3RfX2hlYXJ0IGknKS5jbGFzc0xpc3QuYWRkKCducy1pY29uLXdpc2hsaXN0LWhlYXJ0Jyk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKHBhcmVudCkge1xuICAgICAgICAgIGVsZW1lbnQucGFyZW50Tm9kZS5jbGFzc0xpc3QucmVtb3ZlKCdoZWFydC1hY3RpdmUnKTtcbiAgICAgICAgfVxuICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2knKS5jbGFzc0xpc3QucmVtb3ZlKCducy1pY29uLXdpc2hsaXN0LWhlYXJ0LWFjdGl2ZScpO1xuICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2knKS5jbGFzc0xpc3QuYWRkKCducy1pY29uLXdpc2hsaXN0LWhlYXJ0Jyk7XG4gICAgICB9XG4gICAgICBnZXRSZXN1bHRBcGkodXJsLCBkYXRhKS50aGVuKCk7XG4gICAgfVxuICB9O1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIGFkZFdpc2hsaXN0SXRlbVxuICAgKiBAcGFyYW0ge0hUTUxEb2N1bWVudH0gZWxlbWVudFxuICAgKiBAcGFyYW0ge3N0cmluZ30gY29kZVxuICAgKiBBZGQgaXRlbSB0byB3aXNobGlzdFxuICAgKi9cbiAgdmFyIGFkZFdpc2hsaXN0SXRlbSA9IGZ1bmN0aW9uIChlbGVtZW50LCBjb2RlKSB7XG4gICAgaWYgKGVsZW1lbnQpIHtcbiAgICAgIHZhciBkYXRhID0ge307XG4gICAgICB2YXIgdXJsID0gJy93aXNobGlzdC9hZGQvJyArIGNvZGU7XG4gICAgICB2YXIgcGFyZW50ID0gZWxlbWVudCAmJiBlbGVtZW50LnBhcmVudE5vZGUgPyBlbGVtZW50LnBhcmVudE5vZGUgOiBudWxsO1xuXG4gICAgICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZsb2F0aW5nLWJ1dHRvbicpKSB7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy53aXNobGlzdCcpLmZvckVhY2goIGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICBpdGVtLnF1ZXJ5U2VsZWN0b3IoJy53aXNobGlzdF9faGVhcnQgaScpLmNsYXNzTGlzdC5yZW1vdmUoJ25zLWljb24td2lzaGxpc3QtaGVhcnQnKTtcbiAgICAgICAgICBpdGVtLnF1ZXJ5U2VsZWN0b3IoJy53aXNobGlzdF9faGVhcnQgaScpLmNsYXNzTGlzdC5hZGQoJ25zLWljb24td2lzaGxpc3QtaGVhcnQtYWN0aXZlJyk7XG4gICAgICAgICAgaXRlbS5jbGFzc0xpc3QuYWRkKCdoZWFydC1hY3RpdmUnKTtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAocGFyZW50KSB7XG4gICAgICAgICAgcGFyZW50LmNsYXNzTGlzdC5hZGQoJ2hlYXJ0LWFjdGl2ZScpO1xuICAgICAgICB9XG4gICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignaScpLmNsYXNzTGlzdC5yZW1vdmUoJ25zLWljb24td2lzaGxpc3QtaGVhcnQnKTtcbiAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCdpJykuY2xhc3NMaXN0LmFkZCgnbnMtaWNvbi13aXNobGlzdC1oZWFydC1hY3RpdmUnKTtcbiAgICAgIH1cbiAgICAgIGdldFJlc3VsdEFwaSh1cmwsIGRhdGEpLnRoZW4oKTtcblxuICAgICAgdmFyIHV1aWQgPSB3aW5kb3cuZnJlZWRvbS5nZXRDb29raWUoJ3V1aWQnKTtcbiAgICAgIGlmKHV1aWQgJiYgdXVpZC5pbmNsdWRlcygnYW5vbnltb3VzJykpIHtcbiAgICAgICAgdmFyIGN1cnJlbnRVcmwgPSB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgKyAnPycgKyBlbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1ocmVmJyk7XG4gICAgICAgIGlmIChjdXJyZW50VXJsICYmIGN1cnJlbnRVcmwubWF0Y2goL3ppcENvZGU9XFxkezh9LykpIHtcbiAgICAgICAgICBjdXJyZW50VXJsID0gY3VycmVudFVybC5yZXBsYWNlKC8mP3ppcENvZGU9XFxkezh9LywgJycpO1xuICAgICAgICB9XG4gICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9ICcvbG9naW4/cmVkaXJlY3Q9JyArIGN1cnJlbnRVcmw7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIGdldFdpc2hMaXN0SXRlbUJ5Q29kZVxuICAgKiBAcGFyYW0ge0hUTUxEb2N1bWVudH0gZWxlbWVudFxuICAgKiBHZXQgd2lzaGxpc3QgaXRlbSBieSBjb2RlXG4gICAqL1xuICB2YXIgZ2V0V2lzaExpc3RJdGVtQnlDb2RlID0gZnVuY3Rpb24oZWxlbWVudCkge1xuICAgIHZhciBjb2RlID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEtY29kZScpO1xuICAgIHZhciBkYXRhID0ge307XG4gICAgdmFyIHVybCA9ICcvd2lzaGxpc3QvJyArIGNvZGU7XG4gICAgZ2V0UmVzdWx0QXBpKHVybCwgZGF0YSkudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcbiAgICAgIGlmKHJlc3VsdCAhPT0gJ2ZhbHNlJykge1xuICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy53aXNobGlzdF9faGVhcnQgaScpLmNsYXNzTGlzdC5yZW1vdmUoJ25zLWljb24td2lzaGxpc3QtaGVhcnQnKTtcbiAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcud2lzaGxpc3RfX2hlYXJ0IGknKS5jbGFzc0xpc3QuYWRkKCducy1pY29uLXdpc2hsaXN0LWhlYXJ0LWFjdGl2ZScpO1xuICAgICAgfVxuICAgIH0pO1xuICB9O1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIGdldEFsbEl0ZW1zT25XaXNobGlzdFxuICAgKiBHZXQgYWxsIGl0ZW1zIGluIHRoZSB3aXNoIGxpc3QgYW5kIGFkZCBpbiBhIHZhcmlhYmxlXG4gICAqL1xuICB2YXIgZ2V0QWxsSXRlbXNPbldpc2hsaXN0ID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGRhdGEgPSB7fTtcbiAgICB2YXIgdXJsID0gJy93aXNobGlzdC9hbGwnO1xuICAgIGdldFJlc3VsdEFwaSh1cmwsIGRhdGEpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XG4gICAgICBJVEVNU19JTl9XSVNITElTVCA9IEpTT04ucGFyc2UocmVzdWx0KTtcbiAgICB9KTtcbiAgfTtcblxuICAvKipcbiAgICogQG1ldGhvZCBjaGVja0l0ZW1zSW5BcnJheVxuICAgKiBAcGFyYW0ge0hUTUxEb2N1bWVudH0gaGVhcnRcbiAgICogQ2hlY2sgaWYgeW91IGhhdmUgdGhlIGNvZGUgaW4gdGhlIGFycmF5XG4gICAqL1xuICB2YXIgY2hlY2tJdGVtc0luQXJyYXkgPSBmdW5jdGlvbihoZWFydCkge1xuICAgIHZhciBjb2RlID0gaGVhcnQuZ2V0QXR0cmlidXRlKCdkYXRhLWNvZGUnKTtcbiAgICB2YXIgY29kZUluTGlzdCA9IElURU1TX0lOX1dJU0hMSVNULm1hcChmdW5jdGlvbihpdGVtKSB7XG4gICAgICByZXR1cm4gaXRlbS5jb2RlO1xuICAgIH0pLmluZGV4T2YoY29kZSk7XG4gICAgaWYoY29kZUluTGlzdCAhPT0gLTEpIHtcbiAgICAgIGhlYXJ0LnF1ZXJ5U2VsZWN0b3IoJy53aXNobGlzdF9faGVhcnQgaScpLmNsYXNzTGlzdC5yZW1vdmUoJ25zLWljb24td2lzaGxpc3QtaGVhcnQnKTtcbiAgICAgIGhlYXJ0LnF1ZXJ5U2VsZWN0b3IoJy53aXNobGlzdF9faGVhcnQgaScpLmNsYXNzTGlzdC5hZGQoJ25zLWljb24td2lzaGxpc3QtaGVhcnQtYWN0aXZlJyk7XG4gICAgfVxuICB9O1xuXG4gIC8vRXZlbnRzXG4gIC8qKlxuICAgKiBAbWV0aG9kICBjaGVja0Zhdm9yaXRlUHJvZHVjdHNcbiAgICogQ2hlY2tzIGlmIHRoZSBwcm9kdWN0cyBpcyBzZWxlY3RlZCBpbiB0aGUgd2lzaGxpc3RcbiAgICovXG4gIHZhciBjaGVja0Zhdm9yaXRlUHJvZHVjdHMgPSBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgdmFyIGhlYXJ0cyA9IGVsZW1lbnQgPyBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy53aXNobGlzdF9faGVhcnQnKSA6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy53aXNobGlzdF9faGVhcnQnKTtcbiAgICBpZihlbGVtZW50KSB7XG4gICAgICB2YXIgYWxsSXRlbXMgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHtcbiAgICAgICAgaWYoSVRFTVNfSU5fV0lTSExJU1QpIHtcbiAgICAgICAgICBjbGVhckludGVydmFsKGFsbEl0ZW1zKTtcbiAgICAgICAgICBjaGVja0l0ZW1zSW5BcnJheShoZWFydHMpO1xuICAgICAgICB9XG4gICAgICB9LCAxMDAwKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaGVhcnRzLmZvckVhY2goZnVuY3Rpb24oaGVhcnQpIHtcbiAgICAgICAgZ2V0V2lzaExpc3RJdGVtQnlDb2RlKGhlYXJ0KTtcbiAgICAgIH0pO1xuICAgIH1cblxuICB9O1xuICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5zdWIoJ3dpc2hsaXN0LmNoZWNrRmF2b3JpdGVQcm9kdWN0cycsIGNoZWNrRmF2b3JpdGVQcm9kdWN0cyk7XG5cbiAgdmFyIGNsaWNrRXZlbnQgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgY29kZSA9IHRoaXMuZ2V0QXR0cmlidXRlKCdkYXRhLWNvZGUnKTtcbiAgICBpZiAodGhpcy5xdWVyeVNlbGVjdG9yKCdpJykuY2xhc3NMaXN0LmNvbnRhaW5zKCducy1pY29uLXdpc2hsaXN0LWhlYXJ0LWFjdGl2ZScpKSB7XG4gICAgICAvL1JlbW92ZSBmcm9tIHdpc2ggbGlzdFxuICAgICAgcmVtb3ZlV2lzaGxpc3RJdGVtKHRoaXMsIGNvZGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvL0FkZCB0byB3aXNoIGxpc3RcbiAgICAgIGFkZFdpc2hsaXN0SXRlbSh0aGlzLCBjb2RlKTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgY2xpY2tMaXN0ZW5lclxuICAgKiBAcGFyYW0ge0RPTWVsZW1lbnR9IEhFQVJUXG4gICAqIExpc3RlbiB0byBjbGljayBldmVudHMgaW4gdGhlIGhlYXJ0XG4gICAqL1xuICB2YXIgY2xpY2tMaXN0ZW5lciA9IGZ1bmN0aW9uIChjb21wb25lbnRSZWluaXQpIHtcblxuICAgIHZhciBIRUFSVCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy53aXNobGlzdF9faGVhcnQnKTtcbiAgICBpZihIRUFSVC5sZW5ndGggPiAxKSB7XG4gICAgICBIRUFSVC5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtcykge1xuICAgICAgICBpZihjb21wb25lbnRSZWluaXQpIHtcbiAgICAgICAgICBpdGVtcy5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGNsaWNrRXZlbnQpO1xuICAgICAgICB9XG4gICAgICAgIGl0ZW1zLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY2xpY2tFdmVudCk7XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgd2luZG93LmZyZWVkb20ubGl2ZSgnLndpc2hsaXN0X19oZWFydCcsICdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgY29kZSA9IHRoaXMuZ2V0QXR0cmlidXRlKCdkYXRhLWNvZGUnKTtcbiAgICAgICAgaWYgKHRoaXMucXVlcnlTZWxlY3RvcignaScpLmNsYXNzTGlzdC5jb250YWlucygnbnMtaWNvbi13aXNobGlzdC1oZWFydC1hY3RpdmUnKSkge1xuICAgICAgICAgIC8vUmVtb3ZlIGZyb20gd2lzaCBsaXN0XG4gICAgICAgICAgcmVtb3ZlV2lzaGxpc3RJdGVtKHRoaXMsIGNvZGUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vQWRkIHRvIHdpc2ggbGlzdFxuICAgICAgICAgIGFkZFdpc2hsaXN0SXRlbSh0aGlzLCBjb2RlKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9O1xuICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5zdWIoJ3dpc2hsaXN0LmNsaWNrTGlzdGVuZXInLCBjbGlja0xpc3RlbmVyKTtcblxuICAoZnVuY3Rpb24gKCkge1xuICAgIHRyeSB7XG4gICAgICB2YXIgd2lzaGxpc3RIZWFydCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy53aXNobGlzdCAud2lzaGxpc3RfX2hlYXJ0Jyk7XG5cbiAgICAgIGlmKCh3aXNobGlzdEhlYXJ0ICYmIHdpc2hsaXN0SGVhcnQuZ2V0QXR0cmlidXRlKCdkYXRhLXRlbXBsYXRlJykgPT09ICdwZHAnKSkge1xuICAgICAgICBpZih3aXNobGlzdEhlYXJ0LmdldEF0dHJpYnV0ZSgnZGF0YS1kZXZpY2UnKSA9PT0gJ21vYmlsZScpIHtcbiAgICAgICAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ3dpc2hsaXN0LmNoZWNrRmF2b3JpdGVQcm9kdWN0cycpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgdXVpZCA9IHdpbmRvdy5mcmVlZG9tLmdldENvb2tpZSgndXVpZCcpO1xuICAgICAgICBpZih1dWlkICYmICF1dWlkLmluY2x1ZGVzKCdhbm9ueW1vdXMnKSkge1xuICAgICAgICAgIGdldEFsbEl0ZW1zT25XaXNobGlzdCgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ3dpc2hsaXN0LmNsaWNrTGlzdGVuZXInKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgfVxuICB9KCkpO1xufSgpKTtcbiJdfQ==
