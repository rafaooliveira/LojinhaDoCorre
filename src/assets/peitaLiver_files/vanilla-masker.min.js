!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t():e.VMasker=t()}(this,function(){var e="9",t="A",n="S",i=[9,16,17,18,36,37,38,39,40,91,92,93],r=function(e){for(var t=0,n=i.length;t<n;t++)if(e==i[t])return!1;return!0},o=function(e){return e=e||{},e={precision:e.hasOwnProperty("precision")?e.precision:2,separator:e.separator||",",delimiter:e.delimiter||".",unit:e.unit&&e.unit.replace(/[\s]/g,"")+" "||"",suffixUnit:e.suffixUnit&&" "+e.suffixUnit.replace(/[\s]/g,"")||"",zeroCents:e.zeroCents,lastOutput:e.lastOutput},e.moneyPrecision=e.zeroCents?0:e.precision,e},s=function(i,r,o){for(;r<i.length;r++)i[r]!==e&&i[r]!==t&&i[r]!==n||(i[r]=o);return i},l=function(e){this.elements=e};l.prototype.unbindElementToMask=function(){for(var e=0,t=this.elements.length;e<t;e++)this.elements[e].lastOutput="",this.elements[e].onkeyup=!1,this.elements[e].onkeydown=!1,this.elements[e].value.length&&(this.elements[e].value=this.elements[e].value.replace(/\D/g,""))},l.prototype.bindElementToMask=function(e){for(var t=this,n=function(n){n=n||window.event;var i=n.target||n.srcElement;r(n.keyCode)&&setTimeout(function(){t.opts.lastOutput=i.lastOutput,i.value=a[e](i.value,t.opts),i.lastOutput=i.value,i.setSelectionRange&&t.opts.suffixUnit&&i.setSelectionRange(i.value.length,i.value.length-t.opts.suffixUnit.length)},0)},i=0,o=this.elements.length;i<o;i++)this.elements[i].lastOutput="",this.elements[i].onkeyup=n,this.elements[i].value.length&&(this.elements[i].value=a[e](this.elements[i].value,this.opts))},l.prototype.maskMoney=function(e){this.opts=o(e),this.bindElementToMask("toMoney")},l.prototype.maskNumber=function(){this.opts={},this.bindElementToMask("toNumber")},l.prototype.maskAlphaNum=function(){this.opts={},this.bindElementToMask("toAlphaNumeric")},l.prototype.maskPattern=function(e){this.opts={pattern:e},this.bindElementToMask("toPattern")},l.prototype.unMask=function(){this.unbindElementToMask()};var a=function(e){if(!e)throw new Error("VanillaMasker: There is no element to bind.");var t="length"in e?e.length?e:[]:[e];return new l(t)};return a.toMoney=function(e,t){if(t=o(t),t.zeroCents){t.lastOutput=t.lastOutput||"";var n="("+t.separator+"[0]{0,"+t.precision+"})",i=new RegExp(n,"g"),r=e.toString().replace(/[\D]/g,"").length||0,s=t.lastOutput.toString().replace(/[\D]/g,"").length||0;e=e.toString().replace(i,""),r<s&&(e=e.slice(0,e.length-1))}var l=e.toString().replace(/[\D]/g,""),a=new RegExp("^(0|\\"+t.delimiter+")"),u=new RegExp("(\\"+t.separator+")$"),p=l.substr(0,l.length-t.moneyPrecision),h=p.substr(0,p.length%3),c=new Array(t.precision+1).join("0");p=p.substr(p.length%3,p.length);for(var f=0,g=p.length;f<g;f++)f%3===0&&(h+=t.delimiter),h+=p[f];if(h=h.replace(a,""),h=h.length?h:"0",!t.zeroCents){var m=l.length-t.precision,v=l.substr(m,t.precision),d=v.length,y=t.precision>d?t.precision:d;c=(c+v).slice(-y)}var b=t.unit+h+t.separator+c+t.suffixUnit;return b.replace(u,"")},a.toPattern=function(i,r){var o,l="object"==typeof r?r.pattern:r,a=l.replace(/\W/g,""),u=l.split(""),p=i.toString().replace(/\W/g,""),h=p.replace(/\W/g,""),c=0,f=u.length,g="object"==typeof r?r.placeholder:void 0;for(o=0;o<f;o++){if(c>=p.length){if(a.length==h.length)return u.join("");if(void 0!==g&&a.length>h.length)return s(u,o,g).join("");break}if(u[o]===e&&p[c].match(/[0-9]/)||u[o]===t&&p[c].match(/[a-zA-Z]/)||u[o]===n&&p[c].match(/[0-9a-zA-Z]/))u[o]=p[c++];else if(u[o]===e||u[o]===t||u[o]===n)return void 0!==g?s(u,o,g).join(""):u.slice(0,o).join("")}return u.join("").substr(0,o)},a.toNumber=function(e){return e.toString().replace(/(?!^-)[^0-9]/g,"")},a.toAlphaNumeric=function(e){return e.toString().replace(/[^a-z0-9 ]+/i,"")},a});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl9yZWZhY3RvcmluZy9fbGliL3ZlbmRvci92YW5pbGxhLW1hc2tlci5taW4uanMiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJkZWZpbmUiLCJhbWQiLCJleHBvcnRzIiwibW9kdWxlIiwiVk1hc2tlciIsInRoaXMiLCJESUdJVCIsIkFMUEhBIiwiQUxQSEFOVU0iLCJCWV9QQVNTX0tFWVMiLCJpc0FsbG93ZWRLZXlDb2RlIiwia2V5Q29kZSIsImkiLCJsZW4iLCJsZW5ndGgiLCJtZXJnZU1vbmV5T3B0aW9ucyIsIm9wdHMiLCJwcmVjaXNpb24iLCJoYXNPd25Qcm9wZXJ0eSIsInNlcGFyYXRvciIsImRlbGltaXRlciIsInVuaXQiLCJyZXBsYWNlIiwic3VmZml4VW5pdCIsInplcm9DZW50cyIsImxhc3RPdXRwdXQiLCJtb25leVByZWNpc2lvbiIsImFkZFBsYWNlaG9sZGVyc1RvT3V0cHV0Iiwib3V0cHV0IiwiaW5kZXgiLCJwbGFjZWhvbGRlciIsIlZhbmlsbGFNYXNrZXIiLCJlbGVtZW50cyIsInByb3RvdHlwZSIsInVuYmluZEVsZW1lbnRUb01hc2siLCJvbmtleXVwIiwib25rZXlkb3duIiwidmFsdWUiLCJiaW5kRWxlbWVudFRvTWFzayIsIm1hc2tGdW5jdGlvbiIsInRoYXQiLCJvblR5cGUiLCJlIiwid2luZG93IiwiZXZlbnQiLCJzb3VyY2UiLCJ0YXJnZXQiLCJzcmNFbGVtZW50Iiwic2V0VGltZW91dCIsInNldFNlbGVjdGlvblJhbmdlIiwibWFza01vbmV5IiwibWFza051bWJlciIsIm1hc2tBbHBoYU51bSIsIm1hc2tQYXR0ZXJuIiwicGF0dGVybiIsInVuTWFzayIsImVsIiwiRXJyb3IiLCJ0b01vbmV5IiwiemVyb01hdGNoZXIiLCJ6ZXJvUmVnRXhwIiwiUmVnRXhwIiwiZGlnaXRzTGVuZ3RoIiwidG9TdHJpbmciLCJsYXN0RGlnaXRMZW5ndGgiLCJzbGljZSIsIm51bWJlciIsImNsZWFyRGVsaW1pdGVyIiwiY2xlYXJTZXBhcmF0b3IiLCJtb25leSIsInN1YnN0ciIsIm1hc2tlZCIsImNlbnRzIiwiQXJyYXkiLCJqb2luIiwiYmVnaW5DZW50cyIsImNlbnRzVmFsdWUiLCJjZW50c0xlbmd0aCIsImNlbnRzU2xpY2VkIiwidG9QYXR0ZXJuIiwicGF0dGVybkNoYXJzIiwic3BsaXQiLCJ2YWx1ZXMiLCJjaGFyc1ZhbHVlcyIsIm91dHB1dExlbmd0aCIsInVuZGVmaW5lZCIsIm1hdGNoIiwidG9OdW1iZXIiLCJ0b0FscGhhTnVtZXJpYyJdLCJtYXBwaW5ncyI6IkNBQUMsU0FBU0EsRUFBTUMsR0FDUSxrQkFBWEMsU0FBeUJBLE9BQU9DLElBQ3pDRCxPQUFPRCxHQUNxQixnQkFBWkcsU0FDaEJDLE9BQU9ELFFBQVVILElBRWpCRCxFQUFLTSxRQUFVTCxLQUVqQk0sS0FBTSxXQUNOLEdBQUlDLEdBQVEsSUFDUkMsRUFBUSxJQUNSQyxFQUFXLElBQ1hDLEdBQWdCLEVBQUcsR0FBSSxHQUFJLEdBQUksR0FBSSxHQUFJLEdBQUksR0FBSSxHQUFJLEdBQUksR0FBSSxJQUMzREMsRUFBbUIsU0FBU0MsR0FDMUIsSUFBSyxHQUFJQyxHQUFJLEVBQUdDLEVBQU1KLEVBQWFLLE9BQVFGLEVBQUlDLEVBQUtELElBQ2xELEdBQUlELEdBQVdGLEVBQWFHLEdBQzFCLE9BQU8sQ0FHWCxRQUFPLEdBRVRHLEVBQW9CLFNBQVNDLEdBWTNCLE1BWEFBLEdBQU9BLE1BQ1BBLEdBQ0VDLFVBQVdELEVBQUtFLGVBQWUsYUFBZUYsRUFBS0MsVUFBWSxFQUMvREUsVUFBV0gsRUFBS0csV0FBYSxJQUM3QkMsVUFBV0osRUFBS0ksV0FBYSxJQUM3QkMsS0FBTUwsRUFBS0ssTUFBU0wsRUFBS0ssS0FBS0MsUUFBUSxRQUFRLElBQU0sS0FBUSxHQUM1REMsV0FBWVAsRUFBS08sWUFBZSxJQUFNUCxFQUFLTyxXQUFXRCxRQUFRLFFBQVEsS0FBUSxHQUM5RUUsVUFBV1IsRUFBS1EsVUFDaEJDLFdBQVlULEVBQUtTLFlBRW5CVCxFQUFLVSxlQUFpQlYsRUFBS1EsVUFBWSxF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QUNNSCxFQUF3QkMsRUFBUWhCLEVBQUdrQixHQUFhNEMsS0FBSyxJQUdyRDlDLEVBQU9xQyxNQUFNLEVBQUdyRCxHQUFHOEQsS0FBSyxJQUt2QyxNQUFPOUMsR0FBTzhDLEtBQUssSUFBSUosT0FBTyxFQUFHMUQsSUFHbkNSLEVBQVFtRixTQUFXLFNBQVNsRCxHQUMxQixNQUFPQSxHQUFNMEIsV0FBV3pDLFFBQVEsZ0JBQWlCLEtBR25EbEIsRUFBUW9GLGVBQWlCLFNBQVNuRCxHQUNoQyxNQUFPQSxHQUFNMEIsV0FBV3pDLFFBQVEsZUFBZ0IsS0FHM0NsQiIsImZpbGUiOiJfcmVmYWN0b3JpbmcvX2xpYi92ZW5kb3IvdmFuaWxsYS1tYXNrZXIubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKHJvb3QsIGZhY3RvcnkpIHtcbiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xuICAgIGRlZmluZShmYWN0b3J5KTtcbiAgfSBlbHNlIGlmICh0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTtcbiAgfSBlbHNlIHtcbiAgICByb290LlZNYXNrZXIgPSBmYWN0b3J5KCk7XG4gIH1cbn0odGhpcywgZnVuY3Rpb24oKSB7XG4gIHZhciBESUdJVCA9IFwiOVwiLFxuICAgICAgQUxQSEEgPSBcIkFcIixcbiAgICAgIEFMUEhBTlVNID0gXCJTXCIsXG4gICAgICBCWV9QQVNTX0tFWVMgPSBbOSwgMTYsIDE3LCAxOCwgMzYsIDM3LCAzOCwgMzksIDQwLCA5MSwgOTIsIDkzXSxcbiAgICAgIGlzQWxsb3dlZEtleUNvZGUgPSBmdW5jdGlvbihrZXlDb2RlKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBCWV9QQVNTX0tFWVMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICBpZiAoa2V5Q29kZSA9PSBCWV9QQVNTX0tFWVNbaV0pIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9LFxuICAgICAgbWVyZ2VNb25leU9wdGlvbnMgPSBmdW5jdGlvbihvcHRzKSB7XG4gICAgICAgIG9wdHMgPSBvcHRzIHx8IHt9O1xuICAgICAgICBvcHRzID0ge1xuICAgICAgICAgIHByZWNpc2lvbjogb3B0cy5oYXNPd25Qcm9wZXJ0eShcInByZWNpc2lvblwiKSA/IG9wdHMucHJlY2lzaW9uIDogMixcbiAgICAgICAgICBzZXBhcmF0b3I6IG9wdHMuc2VwYXJhdG9yIHx8IFwiLFwiLFxuICAgICAgICAgIGRlbGltaXRlcjogb3B0cy5kZWxpbWl0ZXIgfHwgXCIuXCIsXG4gICAgICAgICAgdW5pdDogb3B0cy51bml0ICYmIChvcHRzLnVuaXQucmVwbGFjZSgvW1xcc10vZywnJykgKyBcIiBcIikgfHwgXCJcIixcbiAgICAgICAgICBzdWZmaXhVbml0OiBvcHRzLnN1ZmZpeFVuaXQgJiYgKFwiIFwiICsgb3B0cy5zdWZmaXhVbml0LnJlcGxhY2UoL1tcXHNdL2csJycpKSB8fCBcIlwiLFxuICAgICAgICAgIHplcm9DZW50czogb3B0cy56ZXJvQ2VudHMsXG4gICAgICAgICAgbGFzdE91dHB1dDogb3B0cy5sYXN0T3V0cHV0XG4gICAgICAgIH07XG4gICAgICAgIG9wdHMubW9uZXlQcmVjaXNpb24gPSBvcHRzLnplcm9DZW50cyA/IDAgOiBvcHRzLnByZWNpc2lvbjtcbiAgICAgICAgcmV0dXJuIG9wdHM7XG4gICAgICB9LFxuICAgICAgLy8gRmlsbCB3aWxkY2FyZHMgcGFzdCBpbmRleCBpbiBvdXRwdXQgd2l0aCBwbGFjZWhvbGRlclxuICAgICAgYWRkUGxhY2Vob2xkZXJzVG9PdXRwdXQgPSBmdW5jdGlvbihvdXRwdXQsIGluZGV4LCBwbGFjZWhvbGRlcikge1xuICAgICAgICBmb3IgKDsgaW5kZXggPCBvdXRwdXQubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgICAgaWYob3V0cHV0W2luZGV4XSA9PT0gRElHSVQgfHwgb3V0cHV0W2luZGV4XSA9PT0gQUxQSEEgfHwgb3V0cHV0W2luZGV4XSA9PT0gQUxQSEFOVU0pIHtcbiAgICAgICAgICAgIG91dHB1dFtpbmRleF0gPSBwbGFjZWhvbGRlcjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG91dHB1dDtcbiAgICAgIH1cbiAgO1xuXG4gIHZhciBWYW5pbGxhTWFza2VyID0gZnVuY3Rpb24oZWxlbWVudHMpIHtcbiAgICB0aGlzLmVsZW1lbnRzID0gZWxlbWVudHM7XG4gIH07XG5cbiAgVmFuaWxsYU1hc2tlci5wcm90b3R5cGUudW5iaW5kRWxlbWVudFRvTWFzayA9IGZ1bmN0aW9uKCkge1xuICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICB0aGlzLmVsZW1lbnRzW2ldLmxhc3RPdXRwdXQgPSBcIlwiO1xuICAgICAgdGhpcy5lbGVtZW50c1tpXS5vbmtleXVwID0gZmFsc2U7XG4gICAgICB0aGlzLmVsZW1lbnRzW2ldLm9ua2V5ZG93biA9IGZhbHNlO1xuXG4gICAgICBpZiAodGhpcy5lbGVtZW50c1tpXS52YWx1ZS5sZW5ndGgpIHtcbiAgICAgICAgdGhpcy5lbGVtZW50c1tpXS52YWx1ZSA9IHRoaXMuZWxlbWVudHNbaV0udmFsdWUucmVwbGFjZSgvXFxEL2csICcnKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgVmFuaWxsYU1hc2tlci5wcm90b3R5cGUuYmluZEVsZW1lbnRUb01hc2sgPSBmdW5jdGlvbihtYXNrRnVuY3Rpb24pIHtcbiAgICB2YXIgdGhhdCA9IHRoaXMsXG4gICAgICAgIG9uVHlwZSA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICBlID0gZSB8fCB3aW5kb3cuZXZlbnQ7XG4gICAgICAgICAgdmFyIHNvdXJjZSA9IGUudGFyZ2V0IHx8IGUuc3JjRWxlbWVudDtcblxuICAgICAgICAgIGlmIChpc0FsbG93ZWRLZXlDb2RlKGUua2V5Q29kZSkpIHtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIHRoYXQub3B0cy5sYXN0T3V0cHV0ID0gc291cmNlLmxhc3RPdXRwdXQ7XG4gICAgICAgICAgICAgIHNvdXJjZS52YWx1ZSA9IFZNYXNrZXJbbWFza0Z1bmN0aW9uXShzb3VyY2UudmFsdWUsIHRoYXQub3B0cyk7XG4gICAgICAgICAgICAgIHNvdXJjZS5sYXN0T3V0cHV0ID0gc291cmNlLnZhbHVlO1xuICAgICAgICAgICAgICBpZiAoc291cmNlLnNldFNlbGVjdGlvblJhbmdlICYmIHRoYXQub3B0cy5zdWZmaXhVbml0KSB7XG4gICAgICAgICAgICAgICAgc291cmNlLnNldFNlbGVjdGlvblJhbmdlKHNvdXJjZS52YWx1ZS5sZW5ndGgsIChzb3VyY2UudmFsdWUubGVuZ3RoIC0gdGhhdC5vcHRzLnN1ZmZpeFVuaXQubGVuZ3RoKSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIDApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIDtcbiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gdGhpcy5lbGVtZW50cy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgdGhpcy5lbGVtZW50c1tpXS5sYXN0T3V0cHV0ID0gXCJcIjtcbiAgICAgIHRoaXMuZWxlbWVudHNbaV0ub25rZXl1cCA9IG9uVHlwZTtcbiAgICAgIGlmICh0aGlzLmVsZW1lbnRzW2ldLnZhbHVlLmxlbmd0aCkge1xuICAgICAgICB0aGlzLmVsZW1lbnRzW2ldLnZhbHVlID0gVk1hc2tlclttYXNrRnVuY3Rpb25dKHRoaXMuZWxlbWVudHNbaV0udmFsdWUsIHRoaXMub3B0cyk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIFZhbmlsbGFNYXNrZXIucHJvdG90eXBlLm1hc2tNb25leSA9IGZ1bmN0aW9uKG9wdHMpIHtcbiAgICB0aGlzLm9wdHMgPSBtZXJnZU1vbmV5T3B0aW9ucyhvcHRzKTtcbiAgICB0aGlzLmJpbmRFbGVtZW50VG9NYXNrKFwidG9Nb25leVwiKTtcbiAgfTtcblxuICBWYW5pbGxhTWFza2VyLnByb3RvdHlwZS5tYXNrTnVtYmVyID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5vcHRzID0ge307XG4gICAgdGhpcy5iaW5kRWxlbWVudFRvTWFzayhcInRvTnVtYmVyXCIpO1xuICB9O1xuICBcbiAgVmFuaWxsYU1hc2tlci5wcm90b3R5cGUubWFza0FscGhhTnVtID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5vcHRzID0ge307XG4gICAgdGhpcy5iaW5kRWxlbWVudFRvTWFzayhcInRvQWxwaGFOdW1lcmljXCIpO1xuICB9O1xuXG4gIFZhbmlsbGFNYXNrZXIucHJvdG90eXBlLm1hc2tQYXR0ZXJuID0gZnVuY3Rpb24ocGF0dGVybikge1xuICAgIHRoaXMub3B0cyA9IHtwYXR0ZXJuOiBwYXR0ZXJufTtcbiAgICB0aGlzLmJpbmRFbGVtZW50VG9NYXNrKFwidG9QYXR0ZXJuXCIpO1xuICB9O1xuXG4gIFZhbmlsbGFNYXNrZXIucHJvdG90eXBlLnVuTWFzayA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMudW5iaW5kRWxlbWVudFRvTWFzaygpO1xuICB9O1xuXG4gIHZhciBWTWFza2VyID0gZnVuY3Rpb24oZWwpIHtcbiAgICBpZiAoIWVsKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJWYW5pbGxhTWFza2VyOiBUaGVyZSBpcyBubyBlbGVtZW50IHRvIGJpbmQuXCIpO1xuICAgIH1cbiAgICB2YXIgZWxlbWVudHMgPSAoXCJsZW5ndGhcIiBpbiBlbCkgPyAoZWwubGVuZ3RoID8gZWwgOiBbXSkgOiBbZWxdO1xuICAgIHJldHVybiBuZXcgVmFuaWxsYU1hc2tlcihlbGVtZW50cyk7XG4gIH07XG5cbiAgVk1hc2tlci50b01vbmV5ID0gZnVuY3Rpb24odmFsdWUsIG9wdHMpIHtcbiAgICBvcHRzID0gbWVyZ2VNb25leU9wdGlvbnMob3B0cyk7XG4gICAgaWYgKG9wdHMuemVyb0NlbnRzKSB7XG4gICAgICBvcHRzLmxhc3RPdXRwdXQgPSBvcHRzLmxhc3RPdXRwdXQgfHwgXCJcIjtcbiAgICAgIHZhciB6ZXJvTWF0Y2hlciA9IChcIihcIisgb3B0cy5zZXBhcmF0b3IgK1wiWzBdezAsXCIrIG9wdHMucHJlY2lzaW9uICtcIn0pXCIpLFxuICAgICAgICAgIHplcm9SZWdFeHAgPSBuZXcgUmVnRXhwKHplcm9NYXRjaGVyLCBcImdcIiksXG4gICAgICAgICAgZGlnaXRzTGVuZ3RoID0gdmFsdWUudG9TdHJpbmcoKS5yZXBsYWNlKC9bXFxEXS9nLCBcIlwiKS5sZW5ndGggfHwgMCxcbiAgICAgICAgICBsYXN0RGlnaXRMZW5ndGggPSBvcHRzLmxhc3RPdXRwdXQudG9TdHJpbmcoKS5yZXBsYWNlKC9bXFxEXS9nLCBcIlwiKS5sZW5ndGggfHwgMFxuICAgICAgO1xuICAgICAgdmFsdWUgPSB2YWx1ZS50b1N0cmluZygpLnJlcGxhY2UoemVyb1JlZ0V4cCwgXCJcIik7XG4gICAgICBpZiAoZGlnaXRzTGVuZ3RoIDwgbGFzdERpZ2l0TGVuZ3RoKSB7XG4gICAgICAgIHZhbHVlID0gdmFsdWUuc2xpY2UoMCwgdmFsdWUubGVuZ3RoIC0gMSk7XG4gICAgICB9XG4gICAgfVxuICAgIHZhciBudW1iZXIgPSB2YWx1ZS50b1N0cmluZygpLnJlcGxhY2UoL1tcXERdL2csIFwiXCIpLFxuICAgICAgICBjbGVhckRlbGltaXRlciA9IG5ldyBSZWdFeHAoXCJeKDB8XFxcXFwiKyBvcHRzLmRlbGltaXRlciArXCIpXCIpLFxuICAgICAgICBjbGVhclNlcGFyYXRvciA9IG5ldyBSZWdFeHAoXCIoXFxcXFwiKyBvcHRzLnNlcGFyYXRvciArXCIpJFwiKSxcbiAgICAgICAgbW9uZXkgPSBudW1iZXIuc3Vic3RyKDAsIG51bWJlci5sZW5ndGggLSBvcHRzLm1vbmV5UHJlY2lzaW9uKSxcbiAgICAgICAgbWFza2VkID0gbW9uZXkuc3Vic3RyKDAsIG1vbmV5Lmxlbmd0aCAlIDMpLFxuICAgICAgICBjZW50cyA9IG5ldyBBcnJheShvcHRzLnByZWNpc2lvbiArIDEpLmpvaW4oXCIwXCIpXG4gICAgO1xuICAgIG1vbmV5ID0gbW9uZXkuc3Vic3RyKG1vbmV5Lmxlbmd0aCAlIDMsIG1vbmV5Lmxlbmd0aCk7XG4gICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IG1vbmV5Lmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICBpZiAoaSAlIDMgPT09IDApIHtcbiAgICAgICAgbWFza2VkICs9IG9wdHMuZGVsaW1pdGVyO1xuICAgICAgfVxuICAgICAgbWFza2VkICs9IG1vbmV5W2ldO1xuICAgIH1cbiAgICBtYXNrZWQgPSBtYXNrZWQucmVwbGFjZShjbGVhckRlbGltaXRlciwgXCJcIik7XG4gICAgbWFza2VkID0gbWFza2VkLmxlbmd0aCA/IG1hc2tlZCA6IFwiMFwiO1xuICAgIGlmICghb3B0cy56ZXJvQ2VudHMpIHtcbiAgICAgIHZhciBiZWdpbkNlbnRzID0gbnVtYmVyLmxlbmd0aCAtIG9wdHMucHJlY2lzaW9uLFxuICAgICAgICAgIGNlbnRzVmFsdWUgPSBudW1iZXIuc3Vic3RyKGJlZ2luQ2VudHMsIG9wdHMucHJlY2lzaW9uKSxcbiAgICAgICAgICBjZW50c0xlbmd0aCA9IGNlbnRzVmFsdWUubGVuZ3RoLFxuICAgICAgICAgIGNlbnRzU2xpY2VkID0gKG9wdHMucHJlY2lzaW9uID4gY2VudHNMZW5ndGgpID8gb3B0cy5wcmVjaXNpb24gOiBjZW50c0xlbmd0aFxuICAgICAgO1xuICAgICAgY2VudHMgPSAoY2VudHMgKyBjZW50c1ZhbHVlKS5zbGljZSgtY2VudHNTbGljZWQpO1xuICAgIH1cbiAgICB2YXIgb3V0cHV0ID0gb3B0cy51bml0ICsgbWFza2VkICsgb3B0cy5zZXBhcmF0b3IgKyBjZW50cyArIG9wdHMuc3VmZml4VW5pdDtcbiAgICByZXR1cm4gb3V0cHV0LnJlcGxhY2UoY2xlYXJTZXBhcmF0b3IsIFwiXCIpO1xuICB9O1xuXG4gIFZNYXNrZXIudG9QYXR0ZXJuID0gZnVuY3Rpb24odmFsdWUsIG9wdHMpIHtcbiAgICB2YXIgcGF0dGVybiA9ICh0eXBlb2Ygb3B0cyA9PT0gJ29iamVjdCcgPyBvcHRzLnBhdHRlcm4gOiBvcHRzKSxcbiAgICAgICAgcGF0dGVybkNoYXJzID0gcGF0dGVybi5yZXBsYWNlKC9cXFcvZywgJycpLFxuICAgICAgICBvdXRwdXQgPSBwYXR0ZXJuLnNwbGl0KFwiXCIpLFxuICAgICAgICB2YWx1ZXMgPSB2YWx1ZS50b1N0cmluZygpLnJlcGxhY2UoL1xcVy9nLCBcIlwiKSxcbiAgICAgICAgY2hhcnNWYWx1ZXMgPSB2YWx1ZXMucmVwbGFjZSgvXFxXL2csICcnKSxcbiAgICAgICAgaW5kZXggPSAwLFxuICAgICAgICBpLFxuICAgICAgICBvdXRwdXRMZW5ndGggPSBvdXRwdXQubGVuZ3RoLFxuICAgICAgICBwbGFjZWhvbGRlciA9ICh0eXBlb2Ygb3B0cyA9PT0gJ29iamVjdCcgPyBvcHRzLnBsYWNlaG9sZGVyIDogdW5kZWZpbmVkKVxuICAgIDtcbiAgICBcbiAgICBmb3IgKGkgPSAwOyBpIDwgb3V0cHV0TGVuZ3RoOyBpKyspIHtcbiAgICAgIC8vIFJlYWNoZWQgdGhlIGVuZCBvZiBpbnB1dFxuICAgICAgaWYgKGluZGV4ID49IHZhbHVlcy5sZW5ndGgpIHtcbiAgICAgICAgaWYgKHBhdHRlcm5DaGFycy5sZW5ndGggPT0gY2hhcnNWYWx1ZXMubGVuZ3RoKSB7XG4gICAgICAgICAgcmV0dXJuIG91dHB1dC5qb2luKFwiXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKChwbGFjZWhvbGRlciAhPT0gdW5kZWZpbmVkKSAmJiAocGF0dGVybkNoYXJzLmxlbmd0aCA+IGNoYXJzVmFsdWVzLmxlbmd0aCkpIHtcbiAgICAgICAgICByZXR1cm4gYWRkUGxhY2Vob2xkZXJzVG9PdXRwdXQob3V0cHV0LCBpLCBwbGFjZWhvbGRlcikuam9pbihcIlwiKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgLy8gUmVtYWluaW5nIGNoYXJzIGluIGlucHV0XG4gICAgICBlbHNle1xuICAgICAgICBpZiAoKG91dHB1dFtpXSA9PT0gRElHSVQgJiYgdmFsdWVzW2luZGV4XS5tYXRjaCgvWzAtOV0vKSkgfHxcbiAgICAgICAgICAgIChvdXRwdXRbaV0gPT09IEFMUEhBICYmIHZhbHVlc1tpbmRleF0ubWF0Y2goL1thLXpBLVpdLykpIHx8XG4gICAgICAgICAgICAob3V0cHV0W2ldID09PSBBTFBIQU5VTSAmJiB2YWx1ZXNbaW5kZXhdLm1hdGNoKC9bMC05YS16QS1aXS8pKSkge1xuICAgICAgICAgIG91dHB1dFtpXSA9IHZhbHVlc1tpbmRleCsrXTtcbiAgICAgICAgfSBlbHNlIGlmIChvdXRwdXRbaV0gPT09IERJR0lUIHx8IG91dHB1dFtpXSA9PT0gQUxQSEEgfHwgb3V0cHV0W2ldID09PSBBTFBIQU5VTSkge1xuICAgICAgICAgIGlmKHBsYWNlaG9sZGVyICE9PSB1bmRlZmluZWQpe1xuICAgICAgICAgICAgcmV0dXJuIGFkZFBsYWNlaG9sZGVyc1RvT3V0cHV0KG91dHB1dCwgaSwgcGxhY2Vob2xkZXIpLmpvaW4oXCJcIik7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2V7XG4gICAgICAgICAgICByZXR1cm4gb3V0cHV0LnNsaWNlKDAsIGkpLmpvaW4oXCJcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBvdXRwdXQuam9pbihcIlwiKS5zdWJzdHIoMCwgaSk7XG4gIH07XG5cbiAgVk1hc2tlci50b051bWJlciA9IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgcmV0dXJuIHZhbHVlLnRvU3RyaW5nKCkucmVwbGFjZSgvKD8hXi0pW14wLTldL2csIFwiXCIpO1xuICB9O1xuICBcbiAgVk1hc2tlci50b0FscGhhTnVtZXJpYyA9IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgcmV0dXJuIHZhbHVlLnRvU3RyaW5nKCkucmVwbGFjZSgvW15hLXowLTkgXSsvaSwgXCJcIik7XG4gIH07XG5cbiAgcmV0dXJuIFZNYXNrZXI7XG59KSk7XG4iXX0=
