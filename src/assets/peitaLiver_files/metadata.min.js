"use strict";window.freedom.metadata=function(e,t){function a(e,t,a,r){m.page=e,m.key=t,m.src=a,m.meta=r,window.freedom.nsRequire.load("chaordic")}function r(e,t){l.push({key:e,src:t})}function o(e,t){t&&e&&t.length>1&&t[1].hasOwnProperty("items")&&(e.cart.items=t[1].items)}function n(e,t,a){if(e&&e.chaordic){if(e.chaordic.page){var r=document.querySelector("section.search-result");if(r){var o=window.freedom.getDataAttribute(r,"search-id");e.chaordic.page.info||(e.chaordic.page.info={}),e.chaordic.page.info.searchId=o}}e.chaordic.search&&e.chaordic.search.items&&0===e.chaordic.search.items.length&&(delete e.chaordic.search.items,e.chaordic.page&&e.chaordic.page.name&&(e.chaordic.page.name="emptySearch"))}window.chaordic_meta=e.chaordic;var n=document.querySelectorAll("head script"),i=n?n[0]:null,d=document.createElement("script");d.async=!0,d.defer=!0,e.chaordic&&e.chaordic.dataGroup&&d.setAttribute("data-group",e.chaordic.dataGroup),d.setAttribute("data-apikey",t),d.src=a,i&&i.parentNode&&i.parentNode.insertBefore(d,i)}function i(e,t,a){if(window.dataLayer){var r=document.querySelector("body");if(r){var o=document.createElement("script");o.async=!0,o.defer=!0,o.src=a+"/gtm.js?l=dataLayer&id="+t,r&&r.parentNode&&r.parentNode.insertBefore(o,r),window.dataLayer.push({"gtm.start":(new Date).getTime(),event:"gtm.js"}),window.dataLayer.push(e.gtm),window.dataLayer.push({event:"AjaxDL"})}else setTimeout(function(){i(e,t,a)},10)}}function d(){return window.freedom.nsRequire.use("chaordic",function(){var e=y();e?q(e):window.freedom.restClient.request("/metadata",{method:"post",data:{page:m.page,pageData:m.meta},success:q})}),this}function c(){var e=document.getElementById("chaordic-update");if(e){var t=document.createElement("script");t.innerHTML=e.innerHTML;var a=document.getElementsByTagName("script")[0];a.insertBefore(t,a.firstChild),window.chaordicUpdate&&window.chaordic&&window.chaordic.push(window.chaordicUpdate)}}function s(){var e=document.getElementById("gtm-update");if(e){var t=document.createElement("script");t.innerHTML=e.innerHTML;var a=document.getElementsByTagName("script")[0];a.insertBefore(t,a.firstChild),window.gtmUpdate&&window.dataLayer&&(window.dataLayer.push(window.gtmUpdate),window.dataLayer.push({event:"AjaxDL"}))}}function g(e){for(var t=0;t<e.length;t++){var a=e[t].mapping;if(window.innerWidth>=a[0][0]&&window.innerHeight>=a[0][1])return e[t]}return 0}function u(){for(var e=[],t=0;t<window.gptadslots.length;t++){var a=window.gptadslots[t],r=g(a.config);a.size!==r&&(a.size=r,e.push(a.slot))}e.length&&window.googletag.pubads().refresh(e)}function w(e,t){var a=document.createElement("script");a.async=!1,a.type="text/javascript";var r="https:"===document.location.protocol;a.src=(r?"https:":"http:")+"//www.googletagservices.com/tag/js/gpt.js";var o=document.getElementsByTagName("script")[0];o&&o.parentNode&&o.parentNode.insertBefore(a,o),window.googletag.cmd.push(function(){var a=window.freedom.hasClass(document.querySelector("html"),"desktop")?"desktop":"mobile";for(var r in e)if("carrousel"===r)w(e[r][a],"carrousel-");else{var o=e[r];t=t||"",window.gptadslots[t+r]={size:0,config:o};var n=window.googletag.defineSlot(o.slotId,[o.size],r);if(o.mapping){var i=o.mapping||[],d=window.googletag.sizeMapping();for(var c in i){var s=i[c];d.addSize(s[0],s[1])}n.defineSizeMapping(d.build());var g=o.targetings||{};for(var p in g)n.setTargeting(p,o.targetings[p]);window.gptadslots[t+r].slot=n.addService(window.googletag.pubads())}}window.freedom.addEvent("resize",window,u),window.googletag.pubads().enableSingleRequest(),window.googletag.pubads().enableAsyncRendering(),window.googletag.pubads().collapseEmptyDivs(!0),window.googletag.enableServices(),window.freedom.nsRequire.load("dfp-banner")})}window.googletag={cmd:[]},window.gptadslots={};var p,m={},l=[],h="ERROR: "+new Date,f=function(t){var a=e.cookie.match("(^|;) ?"+t+"=([^;]*)(;|$)");return a?a[2]:null},v=function(){var e,t,a="metadata_"+p+"_"+m.page,r=dataLayer[0];if("product"===m.page){try{e=JSON.parse(m.meta)}catch(o){e={product:{id:h}}}a="metadata_"+p+"_"+m.page+"_"+e.product.id}else if("search"===m.page){try{e=JSON.parse(m.meta)}catch(o){e={search:{query:h}}}t=e&&e.search&&e.search.query?e.search.query:r.friendly||r.query||h,a="metadata_"+p+"_"+m.page+"_"+t.replace(/ /g,"_")}return a},y=function(){return t&&t.getAll?t.getAll(v()):null},b=function(e){t&&t.set&&t.set(v(),e,10)},q=function(e){try{b(e)}catch(t){}n(e,m.key,m.src),window.freedom.nsRequire.use("gtm",function(){for(var t=0;t<l.length;t++)i(e,l[t].key,l[t].src)})};return p=f("uuid"),{fetchUser:d,chaordic:a,gtm:r,chaordicPush:c,updateCartMetaChaordic:o,gtmPush:s,dfp:w}}(window.document,window.freedom.nsStorage).fetchUser(),window.freedom.nsRequire.load("metadata");
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl9yZWZhY3RvcmluZy9fbGliL25zL21ldGFkYXRhLm1pbi5qcyJdLCJuYW1lcyI6WyJ3aW5kb3ciLCJmcmVlZG9tIiwibWV0YWRhdGEiLCJkb2MiLCJuc1N0b3JhZ2UiLCJjaGFvcmRpYyIsInBhZ2UiLCJrZXkiLCJzcmMiLCJtZXRhIiwiY2hhb3JkaWNEYXRhIiwibnNSZXF1aXJlIiwibG9hZCIsImd0bSIsImd0bURhdGEiLCJwdXNoIiwidXBkYXRlQ2FydE1ldGFDaGFvcmRpYyIsIm1ldGFDaGFvcmRpYyIsIm5ld0NhcnQiLCJsZW5ndGgiLCJoYXNPd25Qcm9wZXJ0eSIsImNhcnQiLCJpdGVtcyIsInByb2Nlc3NDaGFvcmRpYyIsInJlc3VsdCIsInNlYXJjaEVsZW1lbnQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJzZWFyY2hJZCIsImdldERhdGFBdHRyaWJ1dGUiLCJpbmZvIiwic2VhcmNoIiwibmFtZSIsImNoYW9yZGljX21ldGEiLCJzY3JpcHRzIiwicXVlcnlTZWxlY3RvckFsbCIsInRhcmdldCIsImxvYWRlciIsImNyZWF0ZUVsZW1lbnQiLCJhc3luYyIsImRlZmVyIiwiZGF0YUdyb3VwIiwic2V0QXR0cmlidXRlIiwicGFyZW50Tm9kZSIsImluc2VydEJlZm9yZSIsInByb2Nlc3NHdG0iLCJkYXRhTGF5ZXIiLCJndG0uc3RhcnQiLCJEYXRlIiwiZ2V0VGltZSIsImV2ZW50Iiwic2V0VGltZW91dCIsImZldGNoVXNlciIsInVzZSIsImNhY2hlZCIsImdldFN0b3JhZ2UiLCJmZXRjaFVzZXJDYWxsYmFjayIsInJlc3RDbGllbnQiLCJyZXF1ZXN0IiwibWV0aG9kIiwiZGF0YSIsInBhZ2VEYXRhIiwic3VjY2VzcyIsInRoaXMiLCJjaGFvcmRpY1B1c2giLCJlbGVtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJzY3JpcHQiLCJpbm5lckhUTUwiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsImZpcnN0Q2hpbGQiLCJjaGFvcmRpY1VwZGF0ZSIsImd0bVB1c2giLCJndG1VcGRhdGUiLCJnZXRCZXN0U2l6ZSIsImJhbm5lciIsImlkeCIsInNpemUiLCJtYXBwaW5nIiwiaW5uZXJXaWR0aCIsImlubmVySGVpZ2h0Iiwic2hvd0Jlc3RTaXplIiwicmVzaXplIiwiYmFubmVySWQiLCJncHRhZHNsb3RzIiwibmV3SWR4U2l6ZSIsImNvbmZpZyIsInNsb3QiLCJnb29nbGV0YWciLCJwdWJhZHMiLCJyZWZyZXNoIiwiZGZwIiwiYmFubmVycyIsImNhcnJvdXNlbCIsImdhZHMiLCJ0eXBlIiwidXNlU1NMIiwibG9jYXRpb24iLCJwcm90b2NvbCIsIm5vZGUiLCJjbWQiLCJsYW5nIiwiaGFzQ2xhc3MiLCJkZWZpbmVTbG90Iiwic2xvdElkIiwibWFwcyIsInNpemVNYXBwaW5nIiwiYWRkU2l6ZSIsImRlZmluZVNpemVNYXBwaW5nIiwiYnVpbGQiLCJ0YXJnZXRpbmdzIiwidGFyZ2V0aW5nIiwic2V0VGFyZ2V0aW5nIiwiYWRkU2VydmljZSIsImFkZEV2ZW50IiwiZW5hYmxlU2luZ2xlUmVxdWVzdCIsImVuYWJsZUFzeW5jUmVuZGVyaW5nIiwiY29sbGFwc2VFbXB0eURpdnMiLCJlbmFibGVTZXJ2aWNlcyIsInV1aWQiLCJFUlJPUl9USU1FU1RBTVAiLCJnZXRDb29raWUiLCJ2IiwiY29va2llIiwibWF0Y2giLCJnZXRMb2NhbFN0b3JhZ2VLZXkiLCJwYXJzZWQiLCJxdWVyeSIsImRhdGFMYXllclBhZ2UiLCJKU09OIiwicGFyc2UiLCJlcnJvciIsInByb2R1Y3QiLCJpZCIsImZyaWVuZGx5IiwicmVwbGFjZSIsImdldEFsbCIsInNldFN0b3JhZ2UiLCJzZXQiLCJlIiwiaSJdLCJtYXBwaW5ncyI6IkFBQUEsWUFDQUEsUUFBT0MsUUFBUUMsU0FBWSxTQUFTQyxFQUFLQyxHQTJEdkMsUUFBU0MsR0FBU0MsRUFBTUMsRUFBS0MsRUFBS0MsR0FDaENDLEVBQWFKLEtBQU9BLEVBQ3BCSSxFQUFhSCxJQUFNQSxFQUNuQkcsRUFBYUYsSUFBTUEsRUFDbkJFLEVBQWFELEtB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T0FBU3BJLEVBQVVvSSxPQUFPWCxLQUF3QixNQUc5RVksRUFBYSxTQUFVakgsR0FDckJwQixHQUFhQSxFQUFVc0ksS0FDekJ0SSxFQUFVc0ksSUFBSWIsSUFBc0JyRyxFQUFRLEtBK0Y1Q2dDLEVBQW9CLFNBQVNoQyxHQUUvQixJQUNFaUgsRUFBV2pILEdBQ1gsTUFBTW1ILElBRVJwSCxFQUFnQkMsRUFBUWQsRUFBYUgsSUFBS0csRUFBYUYsS0FDdkRSLE9BQU9DLFFBQVFVLFVBQVUwQyxJQUFJLE1BQU8sV0FDbEMsSUFBSyxHQUFJdUYsR0FBSSxFQUFHQSxFQUFJOUgsRUFBUUssT0FBUXlILElBQ2xDL0YsRUFBV3JCLEVBQVFWLEVBQVE4SCxHQUFHckksSUFBS08sRUFBUThILEdBQUdwSSxPQTRJcEQsT0FGQStHLEdBQU9FLEVBQVUsU0FHZnJFLFVBQWFBLEVBQ2IvQyxTQUFZQSxFQUNaUSxJQUFPQSxFQUNQbUQsYUFBZ0JBLEVBQ2hCaEQsdUJBQTBCQSxFQUMxQndELFFBQVdBLEVBQ1htQixJQUFPQSxJQUdUM0YsT0FBTzBCLFNBQVUxQixPQUFPQyxRQUFRRyxXQUFZZ0QsWUFDOUNwRCxPQUFPQyxRQUFRVSxVQUFVQyxLQUFLIiwiZmlsZSI6Il9yZWZhY3RvcmluZy9fbGliL25zL21ldGFkYXRhLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbndpbmRvdy5mcmVlZG9tLm1ldGFkYXRhID0gKGZ1bmN0aW9uKGRvYywgbnNTdG9yYWdlKSB7XG5cbiAgd2luZG93Lmdvb2dsZXRhZyA9IHsgY21kOiBbXSB9O1xuICB3aW5kb3cuZ3B0YWRzbG90cyA9IHt9O1xuXG4gIHZhciBjaGFvcmRpY0RhdGEgPSB7fTtcbiAgdmFyIGd0bURhdGEgPSBbXTtcbiAgdmFyIHV1aWQ7XG4gIHZhciBFUlJPUl9USU1FU1RBTVAgPSAnRVJST1I6ICcgKyBuZXcgRGF0ZSgpO1xuXG4gIHZhciBnZXRDb29raWUgPSBmdW5jdGlvbihuYW1lKSB7XG4gICAgdmFyIHYgPSBkb2MuY29va2llLm1hdGNoKCcoXnw7KSA/JyArIG5hbWUgKyAnPShbXjtdKikoO3wkKScpO1xuICAgIHJldHVybiB2ID8gdlsyXSA6IG51bGw7XG4gIH07XG5cbiAgdmFyIGdldExvY2FsU3RvcmFnZUtleSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBrZXkgPSAnbWV0YWRhdGFfJyArIHV1aWQgKyAnXycgKyBjaGFvcmRpY0RhdGEucGFnZSwgZGF0YUxheWVyUGFnZSA9IGRhdGFMYXllclswXSwgcGFyc2VkLCBxdWVyeTtcbiAgICBpZiAoY2hhb3JkaWNEYXRhLnBhZ2UgPT09ICdwcm9kdWN0Jykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgcGFyc2VkID0gSlNPTi5wYXJzZShjaGFvcmRpY0RhdGEubWV0YSk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBwYXJzZWQgPSB7XG4gICAgICAgICAgcHJvZHVjdDoge1xuICAgICAgICAgICAgaWQ6IEVSUk9SX1RJTUVTVEFNUFxuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIGtleSA9ICdtZXRhZGF0YV8nICsgdXVpZCArICdfJyArIGNoYW9yZGljRGF0YS5wYWdlICsgJ18nICsgcGFyc2VkLnByb2R1Y3QuaWQ7XG4gICAgfSBlbHNlIGlmIChjaGFvcmRpY0RhdGEucGFnZSA9PT0gJ3NlYXJjaCcpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHBhcnNlZCA9IEpTT04ucGFyc2UoY2hhb3JkaWNEYXRhLm1ldGEpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcGFyc2VkID0ge1xuICAgICAgICAgIHNlYXJjaDoge1xuICAgICAgICAgICAgcXVlcnk6IEVSUk9SX1RJTUVTVEFNUFxuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIGlmIChwYXJzZWQgJiYgcGFyc2VkLnNlYXJjaCAmJiBwYXJzZWQuc2VhcmNoLnF1ZXJ5KSB7XG4gICAgICAgIHF1ZXJ5ID0gcGFyc2VkLnNlYXJjaC5xdWVyeTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHF1ZXJ5ID0gZGF0YUxheWVyUGFnZS5mcmllbmRseSB8fCBkYXRhTGF5ZXJQYWdlLnF1ZXJ5IHx8IEVSUk9SX1RJTUVTVEFNUDtcbiAgICAgIH1cbiAgICAgIGtleSA9ICdtZXRhZGF0YV8nICsgdXVpZCArICdfJyArIGNoYW9yZGljRGF0YS5wYWdlICsgJ18nICsgIHF1ZXJ5LnJlcGxhY2UoLyAvZywgJ18nKTtcbiAgICB9XG5cbiAgICByZXR1cm4ga2V5O1xuICB9O1xuXG4gIHZhciBnZXRTdG9yYWdlID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5zU3RvcmFnZSAmJiBuc1N0b3JhZ2UuZ2V0QWxsID8gbnNTdG9yYWdlLmdldEFsbChnZXRMb2NhbFN0b3JhZ2VLZXkoKSkgOiBudWxsO1xuICB9O1xuXG4gIHZhciBzZXRTdG9yYWdlID0gZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgIGlmIChuc1N0b3JhZ2UgJiYgbnNTdG9yYWdlLnNldCkge1xuICAgICAgbnNTdG9yYWdlLnNldChnZXRMb2NhbFN0b3JhZ2VLZXkoKSwgcmVzdWx0LCAxMCk7XG4gICAgfVxuICB9O1xuXG4gIGZ1bmN0aW9uIGNoYW9yZGljKHBhZ2UsIGtleSwgc3JjLCBtZXRhKSB7XG4gICAgY2hhb3JkaWNEYXRhLnBhZ2UgPSBwYWdlO1xuICAgIGNoYW9yZGljRGF0YS5rZXkgPSBrZXk7XG4gICAgY2hhb3JkaWNEYXRhLnNyYyA9IHNyYztcbiAgICBjaGFvcmRpY0RhdGEubWV0YSA9IG1ldGE7XG4gICAgd2luZG93LmZyZWVkb20ubnNSZXF1aXJlLmxvYWQoJ2NoYW9yZGljJyk7XG4gIH1cblxuICBmdW5jdGlvbiBndG0oa2V5LCBzcmMpIHtcbiAgICBndG1EYXRhLnB1c2goeyBrZXk6IGtleSwgc3JjOiBzcmMgfSk7XG4gIH1cblxuICBmdW5jdGlvbiB1cGRhdGVDYXJ0TWV0YUNoYW9yZGljKG1ldGFDaGFvcmRpYywgbmV3Q2FydCkge1xuICAgIGlmKCFuZXdDYXJ0IHx8ICFtZXRhQ2hhb3JkaWMpIHJldHVybjtcbiAgICBpZihuZXdDYXJ0Lmxlbmd0aCA+IDEgJiYgbmV3Q2FydFsxXS5oYXNPd25Qcm9wZXJ0eSgnaXRlbXMnKSkge1xuICAgICAgbWV0YUNoYW9yZGljLmNhcnQuaXRlbXMgPSBuZXdDYXJ0WzFdLml0ZW1zO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHByb2Nlc3NDaGFvcmRpYyhyZXN1bHQsIGtleSwgc3JjKSB7XG5cbiAgICBpZihyZXN1bHQgJiYgcmVzdWx0LmNoYW9yZGljKSB7XG4gICAgICBpZihyZXN1bHQuY2hhb3JkaWMucGFnZSkge1xuICAgICAgICB2YXIgc2VhcmNoRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3NlY3Rpb24uc2VhcmNoLXJlc3VsdCcpO1xuICAgICAgICBpZihzZWFyY2hFbGVtZW50KSB7XG4gICAgICAgICAgdmFyIHNlYXJjaElkID0gd2luZG93LmZyZWVkb20uZ2V0RGF0YUF0dHJpYnV0ZShzZWFyY2hFbGVtZW50LCAnc2VhcmNoLWlkJyk7XG4gICAgICAgICAgaWYoIXJlc3VsdC5jaGFvcmRpYy5wYWdlLmluZm8pIHtcbiAgICAgICAgICAgIHJlc3VsdC5jaGFvcmRpYy5wYWdlLmluZm8gPSB7fTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmVzdWx0LmNoYW9yZGljLnBhZ2UuaW5mby5zZWFyY2hJZCA9IHNlYXJjaElkO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZihyZXN1bHQuY2hhb3JkaWMuc2VhcmNoICYmIHJlc3VsdC5jaGFvcmRpYy5zZWFyY2guaXRlbXNcbiAgICAgICAgJiYgcmVzdWx0LmNoYW9yZGljLnNlYXJjaC5pdGVtcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgZGVsZXRlIHJlc3VsdC5jaGFvcmRpYy5zZWFyY2guaXRlbXM7XG4gICAgICAgIGlmKHJlc3VsdC5jaGFvcmRpYy5wYWdlICYmIHJlc3VsdC5jaGFvcmRpYy5wYWdlLm5hbWUpIHtcbiAgICAgICAgICByZXN1bHQuY2hhb3JkaWMucGFnZS5uYW1lID0gJ2VtcHR5U2VhcmNoJztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHdpbmRvdy5jaGFvcmRpY19tZXRhID0gcmVzdWx0LmNoYW9yZGljO1xuICAgIHZhciBzY3JpcHRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnaGVhZCBzY3JpcHQnKTtcbiAgICB2YXIgdGFyZ2V0ID0gc2NyaXB0cyA/IHNjcmlwdHNbMF0gOiBudWxsO1xuXG4gICAgdmFyIGxvYWRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xuICAgIGxvYWRlci5hc3luYyA9IHRydWU7XG4gICAgbG9hZGVyLmRlZmVyID0gdHJ1ZTtcblxuICAgIGlmIChyZXN1bHQuY2hhb3JkaWMgJiYgcmVzdWx0LmNoYW9yZGljLmRhdGFHcm91cCkge1xuICAgICAgbG9hZGVyLnNldEF0dHJpYnV0ZSgnZGF0YS1ncm91cCcsIHJlc3VsdC5jaGFvcmRpYy5kYXRhR3JvdXApO1xuICAgIH1cblxuICAgIGxvYWRlci5zZXRBdHRyaWJ1dGUoJ2RhdGEtYXBpa2V5Jywga2V5KTtcbiAgICBsb2FkZXIuc3JjID0gc3JjO1xuXG4gICAgaWYgKHRhcmdldCAmJiB0YXJnZXQucGFyZW50Tm9kZSkge1xuICAgICAgdGFyZ2V0LnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGxvYWRlciwgdGFyZ2V0KTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBwcm9jZXNzR3RtKHJlc3VsdCwga2V5LCBzcmMpIHtcbiAgICBpZiAod2luZG93LmRhdGFMYXllcikge1xuICAgICAgdmFyIHRhcmdldCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKTtcblxuICAgICAgaWYgKCF0YXJnZXQpIHtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICBwcm9jZXNzR3RtKHJlc3VsdCwga2V5LCBzcmMpO1xuICAgICAgICB9LCAxMCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgbG9hZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7XG5cbiAgICAgICAgbG9hZGVyLmFzeW5jID0gdHJ1ZTtcbiAgICAgICAgbG9hZGVyLmRlZmVyID0gdHJ1ZTtcbiAgICAgICAgbG9hZGVyLnNyYyA9IHNyYyArICcvZ3RtLmpzP2w9ZGF0YUxheWVyJmlkPScgKyBrZXk7XG5cbiAgICAgICAgaWYgKHRhcmdldCAmJiB0YXJnZXQucGFyZW50Tm9kZSkge1xuICAgICAgICAgIHRhcmdldC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShsb2FkZXIsIHRhcmdldCk7XG4gICAgICAgIH1cblxuICAgICAgICB3aW5kb3cuZGF0YUxheWVyLnB1c2goe1xuICAgICAgICAgICdndG0uc3RhcnQnOiBuZXcgRGF0ZSgpLmdldFRpbWUoKSxcbiAgICAgICAgICBldmVudDogJ2d0bS5qcydcbiAgICAgICAgfSk7XG4gICAgICAgIHdpbmRvdy5kYXRhTGF5ZXIucHVzaChyZXN1bHRbJ2d0bSddKTtcbiAgICAgICAgd2luZG93LmRhdGFMYXllci5wdXNoKHsgJ2V2ZW50JzogJ0FqYXhETCcgfSk7XG4gICAgICAgIC8vIHdpbmRvdy5fZ2EoJ3NlbmQnLCAnZXZlbnQnLCAnQWpheERMJywgJ0FqYXhETCcsICdBamF4REwnLCAwLCB7ICdub25JbnRlcmFjdGlvbic6IDEgfSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgdmFyIGZldGNoVXNlckNhbGxiYWNrID0gZnVuY3Rpb24ocmVzdWx0KSB7XG4gICAgLyogZXNsaW50IG5vLWVtcHR5OiBbXCJlcnJvclwiLCB7IFwiYWxsb3dFbXB0eUNhdGNoXCI6IHRydWUgfV0gKi9cbiAgICB0cnkge1xuICAgICAgc2V0U3RvcmFnZShyZXN1bHQpO1xuICAgIH0gY2F0Y2goZSkge31cblxuICAgIHByb2Nlc3NDaGFvcmRpYyhyZXN1bHQsIGNoYW9yZGljRGF0YS5rZXksIGNoYW9yZGljRGF0YS5zcmMpO1xuICAgIHdpbmRvdy5mcmVlZG9tLm5zUmVxdWlyZS51c2UoJ2d0bScsIGZ1bmN0aW9uKCkge1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBndG1EYXRhLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHByb2Nlc3NHdG0ocmVzdWx0LCBndG1EYXRhW2ldLmtleSwgZ3RtRGF0YVtpXS5zcmMpO1xuICAgICAgICAvL1RPRE8gQUREIEZJRUxEICd1VXNlclR5cGUnOiAnbmV3JyA/Pz8/Pz9cbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcblxuICBmdW5jdGlvbiBmZXRjaFVzZXIoKSB7XG4gICAgd2luZG93LmZyZWVkb20ubnNSZXF1aXJlLnVzZSgnY2hhb3JkaWMnLCBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBjYWNoZWQgPSBnZXRTdG9yYWdlKCk7XG4gICAgICBpZiAoY2FjaGVkKSB7XG4gICAgICAgIGZldGNoVXNlckNhbGxiYWNrKGNhY2hlZCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB3aW5kb3cuZnJlZWRvbS5yZXN0Q2xpZW50LnJlcXVlc3QoJy9tZXRhZGF0YScsIHtcbiAgICAgICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgICAgICBkYXRhOiB7IHBhZ2U6IGNoYW9yZGljRGF0YS5wYWdlLCBwYWdlRGF0YTogY2hhb3JkaWNEYXRhLm1ldGEgfSxcbiAgICAgICAgICBzdWNjZXNzOiBmZXRjaFVzZXJDYWxsYmFja1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGZ1bmN0aW9uIGNoYW9yZGljUHVzaCgpIHtcbiAgICB2YXIgZWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGFvcmRpYy11cGRhdGUnKTtcblxuICAgIGlmICghIWVsZW1lbnQpIHtcbiAgICAgIHZhciBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcbiAgICAgIHNjcmlwdC5pbm5lckhUTUwgPSBlbGVtZW50LmlubmVySFRNTDtcblxuICAgICAgdmFyIHNjcmlwdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0JylbMF07XG4gICAgICBzY3JpcHRzLmluc2VydEJlZm9yZShzY3JpcHQsIHNjcmlwdHMuZmlyc3RDaGlsZCk7XG5cbiAgICAgIGlmICh3aW5kb3cuY2hhb3JkaWNVcGRhdGUgJiYgd2luZG93LmNoYW9yZGljKSB7XG4gICAgICAgIHdpbmRvdy5jaGFvcmRpYy5wdXNoKHdpbmRvdy5jaGFvcmRpY1VwZGF0ZSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gZ3RtUHVzaCgpIHtcbiAgICB2YXIgZWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdndG0tdXBkYXRlJyk7XG4gICAgaWYgKGVsZW1lbnQpIHtcbiAgICAgIHZhciBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcbiAgICAgIHNjcmlwdC5pbm5lckhUTUwgPSBlbGVtZW50LmlubmVySFRNTDtcblxuICAgICAgdmFyIHNjcmlwdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0JylbMF07XG4gICAgICBzY3JpcHRzLmluc2VydEJlZm9yZShzY3JpcHQsIHNjcmlwdHMuZmlyc3RDaGlsZCk7XG5cbiAgICAgIGlmICh3aW5kb3cuZ3RtVXBkYXRlICYmIHdpbmRvdy5kYXRhTGF5ZXIpIHtcbiAgICAgICAgd2luZG93LmRhdGFMYXllci5wdXNoKHdpbmRvdy5ndG1VcGRhdGUpO1xuICAgICAgICB3aW5kb3cuZGF0YUxheWVyLnB1c2goeyAnZXZlbnQnOiAnQWpheERMJyB9KTtcbiAgICAgICAgLy8gd2luZG93Ll9nYSgnc2VuZCcsICdldmVudCcsICdBamF4REwnLCAnQWpheERMJywgJ0FqYXhETCcsIDAsIHsgJ25vbkludGVyYWN0aW9uJzogMSB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBnZXRCZXN0U2l6ZShiYW5uZXIpIHtcbiAgICBmb3IgKHZhciBpZHggPSAwOyBpZHggPCBiYW5uZXIubGVuZ3RoOyBpZHgrKykgeyAvL2ZvciAodmFyIGlkeCBpbiBiYW5uZXIubWFwcGluZykge1xuICAgICAgdmFyIHNpemUgPSBiYW5uZXJbaWR4XS5tYXBwaW5nO1xuICAgICAgaWYgKHdpbmRvdy5pbm5lcldpZHRoID49IHNpemVbMF1bMF0gJiYgd2luZG93LmlubmVySGVpZ2h0ID49IHNpemVbMF1bMV0pIHtcbiAgICAgICAgcmV0dXJuIGJhbm5lcltpZHhdO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gMDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNob3dCZXN0U2l6ZSgpIHtcbiAgICB2YXIgcmVzaXplID0gW107XG5cbiAgICBmb3IgKHZhciBiYW5uZXJJZCA9IDA7IGJhbm5lcklkIDwgd2luZG93LmdwdGFkc2xvdHMubGVuZ3RoOyBiYW5uZXJJZCsrKSB7IC8vZm9yICh2YXIgYmFubmVySWQgaW4gd2luZG93LmdwdGFkc2xvdHMpIHtcbiAgICAgIHZhciBiYW5uZXIgPSB3aW5kb3cuZ3B0YWRzbG90c1tiYW5uZXJJZF07XG4gICAgICB2YXIgbmV3SWR4U2l6ZSA9IGdldEJlc3RTaXplKGJhbm5lci5jb25maWcpO1xuICAgICAgaWYgKGJhbm5lci5zaXplICE9PSBuZXdJZHhTaXplKSB7XG4gICAgICAgIGJhbm5lci5zaXplID0gbmV3SWR4U2l6ZTtcbiAgICAgICAgcmVzaXplLnB1c2goYmFubmVyLnNsb3QpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChyZXNpemUubGVuZ3RoKSB7XG4gICAgICB3aW5kb3cuZ29vZ2xldGFnLnB1YmFkcygpLnJlZnJlc2gocmVzaXplKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBkZnAoYmFubmVycywgY2Fycm91c2VsKSB7XG4gICAgdmFyIGdhZHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcbiAgICBnYWRzLmFzeW5jID0gZmFsc2U7XG4gICAgZ2Fkcy50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7XG4gICAgdmFyIHVzZVNTTCA9IGRvY3VtZW50LmxvY2F0aW9uLnByb3RvY29sID09PSAnaHR0cHM6JztcbiAgICBnYWRzLnNyYyA9ICh1c2VTU0wgPyAnaHR0cHM6JyA6ICdodHRwOicpICsgJy8vd3d3Lmdvb2dsZXRhZ3NlcnZpY2VzLmNvbS90YWcvanMvZ3B0LmpzJztcbiAgICB2YXIgbm9kZSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzY3JpcHQnKVswXTtcblxuICAgIGlmIChub2RlICYmIG5vZGUucGFyZW50Tm9kZSkge1xuICAgICAgbm9kZS5wYXJlbnROb2RlLmluc2VydEJlZm9yZShnYWRzLCBub2RlKTtcbiAgICB9XG5cbiAgICB3aW5kb3cuZ29vZ2xldGFnLmNtZC5wdXNoKGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGxhbmcgPSB3aW5kb3cuZnJlZWRvbS5oYXNDbGFzcyhkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdodG1sJyksICdkZXNrdG9wJylcbiAgICAgICAgPyAnZGVza3RvcCcgOiAnbW9iaWxlJztcbiAgICAgIGZvciAodmFyIGJhbm5lcklkIGluIGJhbm5lcnMpIHtcbiAgICAgICAgaWYoYmFubmVySWQgPT09ICdjYXJyb3VzZWwnKSB7XG4gICAgICAgICAgZGZwKGJhbm5lcnNbYmFubmVySWRdW2xhbmddLCAnY2Fycm91c2VsLScpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhciBiYW5uZXIgPSBiYW5uZXJzW2Jhbm5lcklkXTtcbiAgICAgICAgICBjYXJyb3VzZWwgPSBjYXJyb3VzZWwgfHwgJyc7XG4gICAgICAgICAgd2luZG93LmdwdGFkc2xvdHNbY2Fycm91c2VsICsgYmFubmVySWRdID0geyBzaXplOiAwLCBjb25maWc6IGJhbm5lciB9O1xuXG4gICAgICAgICAgdmFyIHNsb3QgPSB3aW5kb3cuZ29vZ2xldGFnXG4gICAgICAgICAgICAuZGVmaW5lU2xvdChiYW5uZXIuc2xvdElkLCBbYmFubmVyLnNpemVdLCBiYW5uZXJJZCk7XG5cbiAgICAgICAgICAvLyBtYXBwaW5nIHNpemVzXG4gICAgICAgICAgaWYgKGJhbm5lci5tYXBwaW5nKSB7XG4gICAgICAgICAgICB2YXIgbWFwcyA9IGJhbm5lci5tYXBwaW5nIHx8IFtdO1xuICAgICAgICAgICAgdmFyIG1hcHBpbmcgPSB3aW5kb3cuZ29vZ2xldGFnLnNpemVNYXBwaW5nKCk7XG4gICAgICAgICAgICBmb3IgKHZhciBpZHggaW4gbWFwcykge1xuICAgICAgICAgICAgICB2YXIgc2l6ZSA9IG1hcHNbaWR4XTtcbiAgICAgICAgICAgICAgbWFwcGluZy5hZGRTaXplKHNpemVbMF0sIHNpemVbMV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2xvdC5kZWZpbmVTaXplTWFwcGluZyhtYXBwaW5nLmJ1aWxkKCkpO1xuXG4gICAgICAgICAgICAvLyBzZXQgdGFyZ2V0aW5nc1xuICAgICAgICAgICAgdmFyIHRhcmdldGluZ3MgPSBiYW5uZXIudGFyZ2V0aW5ncyB8fCB7fTtcbiAgICAgICAgICAgIGZvciAodmFyIHRhcmdldGluZyBpbiB0YXJnZXRpbmdzKSB7XG4gICAgICAgICAgICAgIHNsb3Quc2V0VGFyZ2V0aW5nKHRhcmdldGluZywgYmFubmVyLnRhcmdldGluZ3NbdGFyZ2V0aW5nXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB3aW5kb3cuZ3B0YWRzbG90c1tjYXJyb3VzZWwgKyBiYW5uZXJJZF0uc2xvdCA9IHNsb3QuYWRkU2VydmljZSh3aW5kb3cuZ29vZ2xldGFnLnB1YmFkcygpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHdpbmRvdy5mcmVlZG9tLmFkZEV2ZW50KCdyZXNpemUnLCB3aW5kb3csIHNob3dCZXN0U2l6ZSk7XG5cbiAgICAgIHdpbmRvdy5nb29nbGV0YWcucHViYWRzKCkuZW5hYmxlU2luZ2xlUmVxdWVzdCgpO1xuICAgICAgd2luZG93Lmdvb2dsZXRhZy5wdWJhZHMoKS5lbmFibGVBc3luY1JlbmRlcmluZygpO1xuICAgICAgd2luZG93Lmdvb2dsZXRhZy5wdWJhZHMoKS5jb2xsYXBzZUVtcHR5RGl2cyh0cnVlKTtcbiAgICAgIHdpbmRvdy5nb29nbGV0YWcuZW5hYmxlU2VydmljZXMoKTtcblxuICAgICAgd2luZG93LmZyZWVkb20ubnNSZXF1aXJlLmxvYWQoJ2RmcC1iYW5uZXInKTtcbiAgICB9KTtcbiAgfVxuXG4gIHV1aWQgPSBnZXRDb29raWUoJ3V1aWQnKTtcblxuICByZXR1cm4ge1xuICAgICdmZXRjaFVzZXInOiBmZXRjaFVzZXIsXG4gICAgJ2NoYW9yZGljJzogY2hhb3JkaWMsXG4gICAgJ2d0bSc6IGd0bSxcbiAgICAnY2hhb3JkaWNQdXNoJzogY2hhb3JkaWNQdXNoLFxuICAgICd1cGRhdGVDYXJ0TWV0YUNoYW9yZGljJzogdXBkYXRlQ2FydE1ldGFDaGFvcmRpYyxcbiAgICAnZ3RtUHVzaCc6IGd0bVB1c2gsXG4gICAgJ2RmcCc6IGRmcFxuICB9O1xuXG59KHdpbmRvdy5kb2N1bWVudCwgd2luZG93LmZyZWVkb20ubnNTdG9yYWdlKSkuZmV0Y2hVc2VyKCk7XG53aW5kb3cuZnJlZWRvbS5uc1JlcXVpcmUubG9hZCgnbWV0YWRhdGEnKTtcbiJdfQ==
