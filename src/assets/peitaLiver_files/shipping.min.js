"use strict";var appShiping=function(){var e,t=document.querySelector("[data-shipping-date]"),i=document.querySelector("section[data-free-shipping-by-zipcode]"),n=document.querySelector("section[data-get-zipcode-info]"),o=!1,r=function(e){var t=document.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)");return t?t[2]:null},a=function(){return document.querySelector("html").getAttribute("lang")},d=function(e){e?(document.querySelector(".ajax-loading-out").classList.remove("hide"),document.querySelector("[data-shipping-form]").classList.add("opacity")):(document.querySelector(".ajax-loading-out").classList.add("hide"),document.querySelector("[data-shipping-form]").classList.remove("opacity"))},s=function(e){var t=e.split(""),i=t.map(function(e,t){return 5===t?"-"+e:e});return i=i.join(""),i?i:null},u=function(e){var t=e.split("-"),i=[];t.forEach(function(e){var t=e.replace(/^0+(?!\.|$)/,"");i.push(t)}),i=i.join("/");var n=new Date(i),o={month:"long",day:"numeric"},r=a(),d=n.toLocaleDateString(r,o);return d?d:null},c=function(){var e=document.querySelector("[data-shipping-form]");window.freedom.nsPubSub.pub("fieldMask.load",e)},l=function(e,i){null!==r("zipcode")&&i?(document.querySelector("[data-shipping-button-consult]").classList.add(e),t.classList.add("available"),t.classList.remove(e),document.querySelector("[data-shipping-dates-table]").classList.remove(e)):document.querySelector("[data-shipping-button-consult]").classList.remove(e)},p=function(){document.querySelector("[data-shipping-container-input]").classList.add("hide"),t.classList.add("hide"),window.freedom.nsPubSub.pub("overlay.display","hide"),document.querySelector(".shipping__input-fail-err").classList.remove("hide"),document.querySelector("[data-shipping-button-consult]").classList.remove("hide"),d(!1)},m=function(e,t){if(""!==e){var i=e.replace(/\D/g,""),n=/^[0-9]{8}$/;return"es-AR"===t?n=/^[0-9]{4}$/:"es-MX"===t&&(n=/^[0-9]{5}$/),n.test(i)}return!1},h=function(){""!==document.querySelector("[data-shipping-input]").value?document.querySelector("[data-shipping-button-consult] label").classList.remove("hide"):document.querySelector("[data-shipping-button-consult] label").classList.add("hide")},g=function(e){if(document.querySelectorAll(".box-best-seller > .seller-modal-tingle [data-seller-id]").length>0){var t=document.querySelectorAll(".box-best-seller > .seller-modal-tingle [data-seller-id]");t.forEach(function(t){t.classList.add("hide");var i=t.getAttribute("data-seller-id");if(e[i]){var n=e[i][0].deliveryDate,o=u(n);document.querySelectorAll('.box-best-seller [data-seller-id="'+i+'"] .date').forEach(function(e){e&&(e.innerText=o,e.parentElement.classList.remove("hide"))})}})}},y=function(e,t,i,n){var o=e[0],r=o.minDeliveryDate,a=o.type,d=u(r);"SUPER_EXPRESS"===a?r===i?document.querySelector(".best-shipping-message").innerHTML="<b>Receba hoje</b> ao finalizar o pedido até às 12h com a opção de entrega Super Expressa para o CEP "+t+".":r===n?document.querySelector(".best-shipping-message").innerHTML="<b>Receba amanhã</b> ao escolher a opção de entrega Super Expressa para o CEP "+t+".":document.querySelector(".best-shipping-message").innerHTML="<b>Receba dia "+d+"</b> ao escolher a opção de entrega Super Expressa para o CEP "+t+".":"EXPRESS"===a?document.querySelector(".best-shipping-message").innerHTML="<b>Receba a partir do dia "+d+"</b> ao escolher a opção de entrega Expressa para o CEP "+t+".":"NORMAL"===a&&(document.querySelector(".best-shipping-message").innerHTML="<b>Receba a partir do dia "+d+"</b> ao escolher a opção de entrega Normal para o CEP "+t+".")},b=function(){var e=document.querySelector(".no-delivery-option .zipcode");e.innerHTML=r("zipcode"),t.classList.add("unavailable"),t.classList.remove("hide"),document.querySelector("[data-shipping-button-consult]").classList.add("hide")},S=function(e,n){if(null!==r("zipcode")&&null!==e){var o=Object.getOwnPropertyNames(e).length>0;if(o){g(e);var a=document.querySelector(".shipping__table");a.querySelector("tbody").innerHTML="",document.querySelector(".shipping__delivery-magalu")&&(document.querySelector(".shipping__delivery-magalu").classList.add("hide"),document.querySelector(".shipping__delivery-magalu span").innerHTML="");var d=document.querySelector(".shipping__input").getAttribute("data-sellerid"),c=e[d],m=new Date,h=m.toLocaleDateString("pt-BR").match(/(^\d{2})\/(\d{2})\/(\d{4})/);h=h.reduceRight(function(e,t,i){return i?1===i?e+t:e+t+"-":e},""),m.setDate(m.getDate()+1);var S=m.toLocaleDateString("pt-BR").match(/(^\d{2})\/(\d{2})\/(\d{4})/);S=S.reduceRight(function(e,t,i){return i?1===i?e+t:e+t+"-":e},""),c.forEach(function(e,t){var i=e.minDeliveryDate,n="",o=a.rows.length,r=a.insertRow(o),d=r.insertCell(0),s=r.insertCell(1),c=e.type,l="",p="";window.freedom.i18n.deliveryMsg[c]&&window.freedom.i18n.deliveryMsg[c].type&&window.freedom.i18n.deliveryMsg[c].text&&("SUPER_EXPRESS"===c?i===h?(l=window.freedom.i18n.deliveryMsg.SUPER_EXPRESS.type,p="Receba hoje"):i===S?(l=window.freedom.i18n.deliveryMsg.SUPER_EXPRESS.type,p="Receba amanhã"):(l=window.freedom.i18n.deliveryMsg.SUPER_EXPRESS.type,p="Receba dia ",n=u(i)):(l=window.freedom.i18n.deliveryMsg[c].type,p=window.freedom.i18n.deliveryMsg[c].text,n=u(i))),d.innerHTML=l,s.innerHTML=p+" "+n,"COLLECT_MAGALU"===c&&(document.querySelector(".shipping__delivery-magalu")?(document.querySelector(".shipping__delivery-magalu").classList.remove("hide"),document.querySelector(".shipping__delivery-magalu span").innerHTML=p+" "+n):a.deleteRow(t))});var f=r("zipcode"),v=s(f);document.querySelector(".shipping__zipcode-current").innerHTML=v,y(c,v,h,S),l("hide",!0)}else 0===Object.getOwnPropertyNames(e).length?"PDP_MANUAL"===n?b():(i||(document.cookie="zipcode="),t.classList.add("hide"),document.querySelector(".shipping__button--consult").classList.remove("hide")):(i||(document.cookie="zipcode="),p())}else i||(document.cookie="zipcode="),p(),console.error("ERROR | Shipping")},f=function(){var e=[];return document.querySelectorAll(".box-best-seller > .seller-modal-tingle [data-seller-id]").length>0?(document.querySelectorAll(".box-best-seller > .seller-modal-tingle [data-seller-id]").forEach(function(t){var i=t.getAttribute("data-seller-id");e.push(i)}),e=e.toString()):e=document.querySelector(".shipping__input[data-sellerid]").getAttribute("data-sellerid"),e},v=function(i,n){var r="PDP_AUTO"===i?"PDP_AUTO":"PDP_MANUAL",a=document.querySelector("[data-shipping-input]"),s=f();t=document.querySelector("[data-shipping-date]");var u=n,c=a.getAttribute("data-sku"),l=a.getAttribute("data-height"),m=a.getAttribute("data-weight"),h=a.getAttribute("data-depth"),g=a.getAttribute("data-width"),y=a.getAttribute("data-preSale")||!1,b=a.getAttribute("data-canbetransportedbyair")||!1;window.freedom.restClient.request("/refactoring/shipping",{displayLoading:!1,method:"get",data:{zipCode:u,sellerId:s,sku:c,height:l,weight:m,depth:h,width:g,preSale:y,canbetransportedbyair:b,hasPersona:o,additionalDeliveryDays:e,headerType:r},success:function(e){u&&"PDP_MANUAL"===r&&(window.freedom.nsPubSub.pub("checkFreeShippingEligibility",u,"PDP_ZIPCODE-FORM"),window.freedom.nsPubSub.pub("getZipcodeFullInfo",u),window.zipcodeAPIsAjax=!1,window.freedom.nsPubSub.pub("changeHeaderZipcode",u),window.freedom.nsPubSub.pub("zipcodeCookie.reinit")),204===e.status?p():S(e,r)},error:p,complete:function(){d(!1)}})},w=function(e){null!==r("zipcode")&&""!==r("zipcode")?(e&&d(!0),v("PDP_AUTO",r("zipcode")),document.querySelector("[data-shipping-input]").value=r("zipcode")):document.querySelector(".shipping__button--consult").classList.contains("hide")&&document.querySelector(".shipping__button--consult").classList.remove("hide")},L=function(t){o=t,e=t?document.querySelector("[data-shipping-input]").getAttribute("data-adddeliverydays"):0,w("show")},q=function(e){if(e)d(!1),""!==document.querySelector(".shipping__input-box>input[type=tel]").value?(document.querySelector("[data-shipping-container-input]").classList.add("hide"),window.freedom.nsPubSub.pub("overlay.display","hide"),document.querySelector(".shipping__input-err").classList.remove("hide"),document.querySelector(".shipping__input-empty").classList.add("hide"),document.querySelector(".shipping__input-fail-err").classList.add("hide")):(document.querySelector("[data-shipping-container-input]").classList.add("hide"),window.freedom.nsPubSub.pub("overlay.display","hide"),document.querySelector(".shipping__input-err").classList.add("hide"),document.querySelector(".shipping__input-empty").classList.remove("hide"),document.querySelector(".shipping__input-fail-err").classList.add("hide"));else{document.querySelector(".shipping__input-err").classList.add("hide"),document.querySelector(".shipping__input-empty").classList.add("hide"),document.querySelector(".shipping__input-fail-err").classList.add("hide"),i||n?window.freedom.nsPubSub.pub("nsLoading.show",document.body):d(!0);var t=document.querySelector("[data-shipping-input]").value.replace(/\D/g,"")||r("zipcode");v(null,t)}},_=!0,P=function(){_&&(_=!1,window.freedom.live("[data-shipping-input]","input",function(){h()}),window.freedom.live("[data-shipping-input]","blur",function(){h()}))},E=function(){window.freedom.live("[data-shipping-button-consult] button","click",function(e){e.preventDefault(),c()}),window.freedom.live("[data-shipping-button-change]","click",function(){c(),document.querySelector("[data-shipping-button-consult]").classList.remove("hide"),t.classList.add("hide"),t.classList.remove("unavailable"),t.classList.remove("available")}),window.freedom.live("[internal-data-shipping-button-change]","click",function(){document.querySelector("[data-shipping-container-input]").classList.add("hide"),window.freedom.nsPubSub.pub("overlay.display","hide"),document.querySelector("[data-shipping-button-consult]").classList.remove("hide"),t.classList.add("hide"),t.classList.remove("unavailable"),t.classList.remove("available"),c(),document.querySelector("[data-shipping-input]").focus()}),window.freedom.live("[data-shipping-close], #overlay","click",function(){window.freedom.nsPubSub.pub("overlay.display","hide"),document.querySelector("[data-shipping-container-input]").classList.add("hide")}),window.freedom.live("[data-shipping-button-submit]","click",function(e){e.preventDefault();var t=document.querySelector("[data-shipping-input]").value,i=a();q(!m(t,i))}),document.querySelector("[data-shipping-button-open-form]")&&window.freedom.live("[data-shipping-button-open-form]","click",function(e){e.preventDefault(),window.freedom.nsPubSub.pub("overlay.display","show"),document.querySelector("[data-shipping-container-input]").classList.remove("hide")}),window.freedom.live("[data-shipping-input]","click",function(){document.querySelector(".shipping__input-err").classList.add("hide"),document.querySelector(".shipping__input-empty").classList.add("hide"),document.querySelector(".shipping__input-fail-err").classList.add("hide"),P()})};try{E(),c(),window.freedom.nsPubSub.sub("Shipping.restart",w),window.freedom.nsPubSub.sub("update.hasPersona.state",L)}catch(R){console.error("ERROR | Shipping "+R)}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl9yZWZhY3RvcmluZy9fY29tcG9uZW50cy9wcm9kdWN0L3NoaXBwaW5nL2Rlc2t0b3Avc2hpcHBpbmcubWluLmpzIl0sIm5hbWVzIjpbImFwcFNoaXBpbmciLCJhZGRpdGlvbmFsRGVsaXZlcnlEYXlzIiwiQkxPQ0tfU0hJUFBJTkdfREFURSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsIkZSRUVTSElQUElOR19FTkFCTEVEIiwiR0VUX1pJUENPREVfSU5GT19FTkFCTEVEIiwiaGFzUGVyc29uYSIsImdldENvb2tpZSIsImNrbmFtZSIsInppcGNvZGUiLCJjb29raWUiLCJtYXRjaCIsImdldENvdW50cnkiLCJnZXRBdHRyaWJ1dGUiLCJhamF4TG9hZGluZyIsInNob3ciLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJhZGQiLCJmb3JtYXRaaXBjb2RlIiwieiIsInNwbGl0IiwiZm9ybWF0dGVkWmlwY29kZSIsIm1hcCIsImVsZW0iLCJpbmRleCIsImpvaW4iLCJmb3JtYXREYXRlIiwiZGF0ZSIsImQiLCJudW1lcmljRGF0ZSIsImZvckVhY2giLCJpIiwiaXRlbSIsInJlcGxhY2UiLCJwdXNoIiwic3RyaW5nRGF0ZSIsIkRhdGUiLCJvcHRpb25zIiwibW9udGgiLCJkYXkiLCJjb3VudHJ5IiwibmV3RGF0ZSIsInRvTG9jYWxlRGF0ZVN0cmluZyIsImFwcGx5SW5wdXRNYWtzIiwiZm9ybSIsIndpbmRvdyIsImZyZWVkb20iLCJuc1B1YlN1YiIsInB1YiIsImhpZGVPclNob3dFbGVtcyIsImNsYXNzTmFtZSIsIm1vZGFsIiwic2hpcHBpbmdFcnJvciIsInZhbGlkYXRlWmlwY29kZSIsImMiLCJyZWdleCIsInRlc3QiLCJoaWRlT3JTaG93TGFiZWwiLCJ2YWx1ZSIsImFwcGVuZGVaaXBjb2RlQmVzdFNlbGxlcnMiLCJkYXRhIiwicXVlcnlTZWxlY3RvckFsbCIsImxlbmd0aCIsIiRhbGxTZWxsZXJzIiwiJGVsIiwic2VsbGVySWQiLCJkZWxpdmVyeURhdGUiLCJkYXRlRm9ybWF0dGVkIiwiJHRoaXMiLCJpbm5lclRleHQiLCJwYXJlbnRFbGVtZW50IiwiY2hlY2tCZXN0VGltZUluRGF5cyIsInJlcyIsImN1cnJlbnRGb3JtYXR0ZWRaaXBjb2RlIiwidG9kYXkiLCJ0b21vcnJvdyIsImZhc3Rlc3REZWxpdmVyeSIsImZhc3Rlc3REZWxpdmVyeURhdGUiLCJtaW5EZWxpdmVyeURhdGUiLCJmYXN0ZXN0RGVsaXZlcnlUeXBlIiwidHlwZSIsImZvcm1hdGVkRGF0ZSIsImlubmVySFRNTCIsImRlbGl2ZXJ5VW5hdmFpbGFibGUiLCJ6aXBjb2RlVGFnIiwiYXBwZW5kZXJzIiwicmVxVHlwZSIsInNoaXBwaW5nTm90RW1wdHkiLCJPYmplY3QiLCJnZXRPd25Qcm9wZXJ0eU5hbWVzIiwidGFibGUiLCJzZWxsZXJJZEN1cnJlbnQiLCJhcnJEZWxpdmVyeURhdGUiLCJjdXJyZW50RGF0ZSIsInJlZHVjZVJpZ2h0IiwiYWNjIiwiZWwiLCJzZXREYXRlIiwiZ2V0RGF0ZSIsInRvbW9ycm93RGF0ZSIsImtleSIsInJvd0NvdW50Iiwicm93cyIsInJvdyIsImluc2VydFJvdyIsImNvbDEiLCJpbnNlcnRDZWxsIiwiY29sMiIsImRlbGl2ZXJ5VHlwZSIsInRleHRUeXBlIiwidGV4dCIsImkxOG4iLCJkZWxpdmVyeU1zZyIsImRlbGV0ZVJvdyIsImN1cnJlbnRaaXBjb2RlIiwiY29uc29sZSIsImVycm9yIiwiZ2V0U2VsbGVyc0lkcyIsImFycnNlbGxlcklkIiwic2VsbGVyIiwidG9TdHJpbmciLCJzdWJtaXRTaGlwcGluZ1JlcXVlc3QiLCJoZWFkZXJUeXBlIiwiemlwQ29kZSIsInNrdSIsImhlaWdodCIsIndlaWdodCIsImRlcHRoIiwid2lkdGgiLCJwcmVTYWxlIiwiY2FuYmV0cmFuc3BvcnRlZGJ5YWlyIiwicmVzdENsaWVudCIsInJlcXVlc3QiLCJkaXNwbGF5TG9hZGluZyIsIm1ldGhvZCIsInN1Y2Nlc3MiLCJ6aXBjb2RlQVBJc0FqYXgiLCJzdGF0dXMiLCJjb21wbGV0ZSIsInZhbGlkYXRlQ29va2llIiwiY29udGFpbnMiLCJ1cGRhdGVIYXNQZXJzb25hU3RhdGUiLCJzdGF0ZSIsInZhbGlkYXRpb25DYWxsYmFjayIsImJvZHkiLCJuZXdaaXBjb2RlIiwiYXV4U2V0Rm9jdXMiLCJvbmZvY3VzIiwibGl2ZSIsInNldExpc3RlbmVycyIsImUiLCJwcmV2ZW50RGVmYXVsdCIsImZvY3VzIiwic3ViIiwiZXJyIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUVBLElBQUlBLFlBQWMsV0FFaEIsR0FJRUMsR0FKRUMsRUFBc0JDLFNBQVNDLGNBQWMsd0JBQy9DQyxFQUF1QkYsU0FBU0MsY0FBYywwQ0FDOUNFLEVBQTJCSCxTQUFTQyxjQUFjLGtDQUNsREcsR0FBYSxFQVFYQyxFQUFZLFNBQVVDLEdBQ3hCLEdBQUlDLEdBQVVQLFNBQVNRLE9BQU9DLE1BQU0sVUFBWUgsRUFBUyxnQkFDekQsT0FBT0MsR0FBVUEsRUFBUSxHQUFLLE1BUTVCRyxFQUFhLFdBQ2YsTUFBT1YsVUFBU0MsY0FBYyxRQUFRVSxhQUFhLFNBUWpEQyxFQUFjLFNBQVVDLEdBQ3RCQSxHQUNGYixTQUFTQyxjQUFjLHFCQUFxQmEsVUFBVUMsT0FBTyxRQUM3RGYsU0FBU0MsY0FBYyx3QkFBd0JhLFVBQVVFLElBQUksYUFFN0RoQixTQUFTQyxjQUFjLHFCQUFxQmEsVUFBVUUsSUFBSSxRQUMxRGhCLFNBQVNDLGNBQWMsd0JBQXdCYSxVQUFVQyxPQUFPLGFBVWhFRSxFQUFnQixTQUFVQyxHQUM1QixHQUFJWCxHQUFVVyxFQUFFQyxNQUFNLElBRWxCQyxFQUFtQmIsRUFBUWMsSUFBSSxTQUFVQyxFQUFNQyxHQUNqRCxNQUFjLEtBQVZBLEVBQ0ssSUFBTUQsRUFFTkEsR0FLWCxPQUZBRixHQUFtQkEsRUFBaUJJLEtBQUssSUFFaENKLEVBQW1CQSxFQUFtQixNQVM3Q0ssRUFBYSxTQUFVQyxHQUN6QixHQUFJQyxHQUFJRCxFQUFLUCxNQUFNLEtBQ2ZTLElBR0pELEdBQUVFLFFBQVEsU0FBVUMsR0FDbEIsR0FBSUMsR0FBT0QsRUFBRUUsUUFBUSxjQUFlLEdBQ3BDSixHQUFZSyxLQUFLRixLQUVuQkgsRUFBY0EsRUFBWUosS0FBSyxJQUcvQixJQUFJVSxHQUFhLEdBQUlDLE1BQUtQLEdBQ3RCUSxHQUFZQyxNQUFPLE9BQVFDLElBQUssV0FHaENDLEVBQVU3QixJQUdWOEIsRUFBVU4sRUFBV08sbUJBQW1CRixFQUFTSCxFQUVyRCxPQUFTSSxHQUFVQSxFQUFVLE1BUTNCRSxFQUFpQixXQUNuQixHQUFJQyxHQUFPM0MsU0FBU0MsY0FBYyx1QkFDbEMyQyxRQUFPQyxRQUFRQyxTQUFTQyxJQUFJLGlCQUFrQkosSUFVNUNLLEVBQWtCLFNBQVVDLEVBQVdDLEdBQ1osT0FBekI3QyxFQUFVLFlBQXVCNkMsR0FDbkNsRCxTQUFTQyxjQUFjLGtDQUFrQ2EsVUFBVUUsSUFBSWlDLEdBQ3ZFbEQsRUFBb0JlLFVBQVVFLElBQUksYUFDbENqQixFQUFvQmUsVUFBVUMsT0FBT2tDLEdBQ3JDakQsU0FBU0MsY0FBYywrQkFBK0JhLFVBQVVDLE9BQU9rQyxJQUV2RWpELFNBQVNDLGNBQWMsa0NBQWtDYSxVQUFVQyxPQUFPa0MsSUFTMUVFLEVBQWdCLFdBQ2xCbkQsU0FBU0MsY0FBYyxtQ0FBbUNhLFVBQVVFLElBQUksUUFDeEVqQixFQUFvQmUsVUFBVUUsSUFBSSxRQUNsQzRCLE9BQU9DLFFBQVFDLFNBQVNDLElBQUksa0JBQW1CLFFBQy9DL0MsU0FBU0MsY0FBYyw2QkFBNkJhLFVBQVVDLE9BQU8sUUFDckVmLFNBQVNDLGNBQWMsa0NBQWtDYSxVQUFVQyxPQUFPLFFBQzFFSCxHQUFZLElBVVZ3QyxFQUFrQixTQUFVbEMsRUFBR21DLEdBQ2pDLEdBQVUsS0FBTm5DLEVBQVUsQ0FFWixHQUFJWCxHQUFVVyxFQUFFYyxRQUFRLE1BQU8sSUFHM0JzQixFQUFRLFlBV1osT0FSVSxVQUFORCxFQUNGQyxFQUFRLGFBR08sVUFBTkQsSUFDVEMsRUFBUSxjQUdIQSxFQUFNQyxLQUFLaEQsR0FHbEIsT0FBTyxHQVVQaUQsRUFBa0IsV0FDMEMsS0FBMUR4RCxTQUFTQyxjQUFjLHlCQUF5QndELE1BQ2xEekQsU0FBU0MsY0FBYyx3Q0FBd0NhLFVBQVVDLE9BQU8sUUFFaEZmLFNBQVNDLGNBQWMsd0NBQXdDYSxVQUFVRSxJQUFJLFNBUzdFMEMsRUFBNEIsU0FBVUMsR0FDeEMsR0FBSTNELFNBQVM0RCxpQkFBaUIsNERBQTREQyxPQUFTLEVBQUcsQ0FDcEcsR0FBSUMsR0FBYzlELFNBQVM0RCxpQkFBaUIsMkRBRTVDRSxHQUFZakMsUUFBUSxTQUFVa0MsR0FFNUJBLEVBQUlqRCxVQUFVRSxJQUFJLE9BRWxCLElBQUlnRCxHQUFXRCxFQUFJcEQsYUFBYSxpQkFDaEMsSUFBSWdELEVBQUtLLEdBQVcsQ0FHbEIsR0FBSXRDLEdBQU9pQyxFQUFLSyxHQUFVLEdBQUdDLGFBQ3pCQyxFQUFnQnpDLEVBQVdDLEVBRS9CMUIsVUFBUzRELGlCQUFpQixxQ0FBdUNJLEVBQVcsWUFBWW5DLFFBQVEsU0FBVXNDLEdBQ3BHQSxJQUNGQSxFQUFNQyxVQUFZRixFQUNsQkMsRUFBTUUsY0FBY3ZELFVBQVVDLE9BQU8sZ0JBYTdDdUQsRUFBc0IsU0FBVUMsRUFBS0MsRUFBeUJDLEVBQU9DLEdBQ3ZFLEdBQUlDLEdBQWtCSixFQUFJLEdBQ3RCSyxFQUFzQkQsRUFBZ0JFLGdCQUN0Q0MsRUFBc0JILEVBQWdCSSxLQUV0Q0MsRUFBZXZELEVBQVdtRCxFQUdGLG1CQUF4QkUsRUFDRUYsSUFBd0JILEVBQzFCekUsU0FBU0MsY0FBYywwQkFBMEJnRixVQUFZLHdHQUMzRFQsRUFBMEIsSUFDbkJJLElBQXdCRixFQUNqQzFFLFNBQVNDLGNBQWMsMEJBQTBCZ0YsVUFBWSxpRkFDM0RULEVBQTBCLElBRTVCeEUsU0FBU0MsY0FBYywwQkFBMEJnRixVQUFZLGlCQUFtQkQsRUFBZSxpRUFDN0ZSLEVBQTBCLElBRUcsWUFBeEJNLEVBQ1Q5RSxTQUFTQyxjQUFjLDBCQUEwQmdGLFVBQVksNkJBQStCRCxFQUFlLDJEQUN6R1IsRUFBMEIsSUFDSyxXQUF4Qk0sSUFDVDlFLFNBQVNDLGNBQWMsMEJBQTBCZ0YsVUFBWSw2QkFBK0JELEVBQWUseURBQ3pHUixFQUEwQixNQVM1QlUsRUFBc0IsV0FDeEIsR0FBSUMsR0FBYW5GLFNBQVNDLGNBQWMsK0JBQ3hDa0YsR0FBV0YsVUFBWTVFLEVBQVUsV0FDakNOLEVBQW9CZSxVQUFVRSxJQUFJLGVBQ2xDakIsRUFBb0JlLFVBQVVDLE9BQU8sUUFDckNmLFNBQVNDLGNBQWMsa0NBQWtDYSxVQUFVRSxJQUFJLFNBUXJFb0UsRUFBWSxTQUFVYixFQUFLYyxHQUM3QixHQUE2QixPQUF6QmhGLEVBQVUsWUFBK0IsT0FBUmtFLEVBQWMsQ0FFakQsR0FBSWUsR0FBbUJDLE9BQU9DLG9CQUFvQmpCLEdBQUtWLE9BQVMsQ0FFaEUsSUFBSXlCLEVBQWtCLENBRXBCNUIsRUFBMEJhLEVBRzFCLElBQUlrQixHQUFRekYsU0FBU0MsY0FBYyxtQkFDbkN3RixHQUFNeEYsY0FBYyxTQUFTZ0YsVUFBWSxHQUd0Q2pGLFNBQVNDLGNBQWMsZ0NBQ3hCRCxTQUFTQyxjQUFjLDhCQUE4QmEsVUFBVUUsSUFBSSxRQUNuRWhCLFNBQVNDLGNBQWMsbUNBQW1DZ0YsVUFBWSxHQUd4RSxJQUFJUyxHQUFrQjFGLFNBQVNDLGNBQWMsb0JBQW9CVSxhQUFhLGlCQUMxRWdGLEVBQWtCcEIsRUFBSW1CLEdBRXRCaEUsRUFBTyxHQUFJUyxNQUNYeUQsRUFBY2xFLEVBQUtlLG1CQUFtQixTQUFTaEMsTUFBTSw2QkFDekRtRixHQUFjQSxFQUFZQyxZQUFZLFNBQVVDLEVBQUtDLEVBQUl4RSxHQUN2RCxNQUFLQSxHQUNTLElBQVZBLEVBQW9CdUUsRUFBTUMsRUFDdkJELEVBQU1DLEVBQUssSUFGQ0QsR0FHbEIsSUFFSHBFLEVBQUtzRSxRQUFRdEUsRUFBS3VFLFVBQVksRUFDOUIsSUFBSUMsR0FBZXhFLEVBQUtlLG1CQUFtQixTQUFTaEMsTUFBTSw2QkFDMUR5RixHQUFlQSxFQUFhTCxZQUFZLFNBQVVDLEVBQUtDLEVBQUl4RSxHQUN6RCxNQUFLQSxHQUNTLElBQVZBLEVBQW9CdUUsRUFBTUMsRUFDdkJELEVBQU1DLEVBQUssSUFGQ0QsR0FHbEIsSUFFSEgsRUFBZ0I5RCxRQUFRLFNBQVVFLEVBQU1vRSxHQUV0QyxHQUFJbEMsR0FBZWxDLEVBQUs4QyxnQkFFcEJYLEVBQWdCLEdBR2hCa0MsRUFBV1gsRUFBTVksS0FBS3hDLE9BQ3RCeUMsRUFBTWIsRUFBTWMsVUFBVUgsR0FDdEJJLEVBQU9GLEVBQUlHLFdBQVcsR0FDdEJDLEVBQU9KLEVBQUlHLFdBQVcsR0FDdEJFLEVBQWU1RSxFQUFLZ0QsS0FDcEI2QixFQUFXLEdBQ1hDLEVBQU8sRUFFUGpFLFFBQU9DLFFBQVFpRSxLQUFLQyxZQUFZSixJQUNsQy9ELE9BQU9DLFFBQVFpRSxLQUFLQyxZQUFZSixHQUFjNUIsTUFDOUNuQyxPQUFPQyxRQUFRaUUsS0FBS0MsWUFBWUosR0FBY0UsT0FFekIsa0JBQWpCRixFQUNFMUMsSUFBaUIyQixHQUNuQmdCLEVBQVdoRSxPQUFPQyxRQUFRaUUsS0FBS0MsWUFBMkIsY0FBRWhDLEtBQzVEOEIsRUFBTyxlQUNFNUMsSUFBaUJpQyxHQUMxQlUsRUFBV2hFLE9BQU9DLFFBQVFpRSxLQUFLQyxZQUEyQixjQUFFaEMsS0FDNUQ4QixFQUFPLGtCQUVQRCxFQUFXaEUsT0FBT0MsUUFBUWlFLEtBQUtDLFlBQTJCLGNBQUVoQyxLQUM1RDhCLEVBQU8sY0FDUDNDLEVBQWdCekMsRUFBV3dDLEtBRzdCMkMsRUFBV2hFLE9BQU9DLFFBQVFpRSxLQUFLQyxZQUFZSixHQUFjNUIsS0FDekQ4QixFQUFPakUsT0FBT0MsUUFBUWlFLEtBQUtDLFlBQVlKLEdBQWNFLEtBQ3JEM0MsRUFBZ0J6QyxFQUFXd0MsS0FJL0J1QyxFQUFLdkIsVUFBWTJCLEVBQ2pCRixFQUFLekIsVUFBWTRCLEVBQU8sSUFBTTNDLEVBRVYsbUJBQWpCeUMsSUFDRTNHLFNBQVNDLGNBQWMsK0JBQ3hCRCxTQUFTQyxjQUFjLDhCQUE4QmEsVUFBVUMsT0FBTyxRQUN0RWYsU0FBU0MsY0FBYyxtQ0FBbUNnRixVQUFZNEIsRUFBTyxJQUFNM0MsR0FFbkZ1QixFQUFNdUIsVUFBVWIsS0FNdEIsSUFBSWMsR0FBaUI1RyxFQUFVLFdBQzNCbUUsRUFBMEJ2RCxFQUFjZ0csRUFDNUNqSCxVQUFTQyxjQUFjLDhCQUE4QmdGLFVBQVlULEVBRWpFRixFQUFvQnFCLEVBQWlCbkIsRUFBeUJvQixFQUFhTSxHQUMzRWxELEVBQWdCLFFBQVEsT0FDNEIsS0FBM0N1QyxPQUFPQyxvQkFBb0JqQixHQUFLVixPQUN6QixlQUFad0IsRUFDRkgsS0FFS2hGLElBQXNCRixTQUFTUSxPQUFTLFlBQzdDVCxFQUFvQmUsVUFBVUUsSUFBSSxRQUNsQ2hCLFNBQVNDLGNBQWMsOEJBQThCYSxVQUFVQyxPQUFPLFVBR25FYixJQUFzQkYsU0FBU1EsT0FBUyxZQUM3QzJDLFNBR0dqRCxLQUFzQkYsU0FBU1EsT0FBUyxZQUM3QzJDLElBQ0ErRCxRQUFRQyxNQUFNLHFCQVNkQyxFQUFnQixXQUNsQixHQUFJQyxLQVdKLE9BVklySCxVQUFTNEQsaUJBQWlCLDREQUE0REMsT0FBUyxHQUNqRzdELFNBQVM0RCxpQkFBaUIsNERBQTREL0IsUUFBUSxTQUFVRSxHQUN0RyxHQUFJdUYsR0FBU3ZGLEVBQUtwQixhQUFhLGlCQUMvQjBHLEdBQVlwRixLQUFLcUYsS0FFbkJELEVBQWNBLEVBQVlFLFlBRTFCRixFQUFjckgsU0FBU0MsY0FBYyxtQ0FBbUNVLGFBQWEsaUJBR2hGMEcsR0FRTEcsRUFBd0IsU0FBVXpDLEVBQU14RSxHQUMxQyxHQUFJa0gsR0FBc0IsYUFBVDFDLEVBQXNCLFdBQWEsYUFDaERoQixFQUFNL0QsU0FBU0MsY0FBYyx5QkFDN0IrRCxFQUFXb0QsR0FDZnJILEdBQXNCQyxTQUFTQyxjQUFjLHVCQUU3QyxJQUFJeUgsR0FBVW5ILEVBQ1pvSCxFQUFNNUQsRUFBSXBELGFBQWEsWUFDdkJpSCxFQUFTN0QsRUFBSXBELGFBQWEsZUFDMUJrSCxFQUFTOUQsRUFBSXBELGFBQWEsZUFDMUJtSCxFQUFRL0QsRUFBSXBELGFBQWEsY0FDekJvSCxFQUFRaEUsRUFBSXBELGFBQWEsY0FDekJxSCxFQUFVakUsRUFBSXBELGFBQWEsa0JBQW1CLEVBQzlDc0gsRUFBd0JsRSxFQUFJcEQsYUFBYSxnQ0FBaUMsQ0FFNUVpQyxRQUFPQyxRQUFRcUYsV0FBV0MsUUFBUSx5QkFDaENDLGdCQUFnQixFQUNoQkMsT0FBUSxNQUNSMUUsTUFDRStELFFBQVNBLEVBQ1QxRCxTQUFVQSxFQUNWMkQsSUFBS0EsRUFDTEMsT0FBUUEsRUFDUkMsT0FBUUEsRUFDUkMsTUFBT0EsRUFDUEMsTUFBT0EsRUFDUEMsUUFBU0EsRUFDVEMsc0JBQXVCQSxFQUN2QjdILFdBQVlBLEVBQ1pOLHVCQUF3QkEsRUFDeEIySCxXQUFZQSxHQUVkYSxRQUFTLFNBQVUvRCxHQUNibUQsR0FBMEIsZUFBZkQsSUFDYjdFLE9BQU9DLFFBQVFDLFNBQVNDLElBQUksK0JBQWdDMkUsRUFBUyxvQkFDckU5RSxPQUFPQyxRQUFRQyxTQUFTQyxJQUFJLHFCQUFzQjJFLEdBQ2xEOUUsT0FBTzJGLGlCQUFrQixFQUN6QjNGLE9BQU9DLFFBQVFDLFNBQVNDLElBQUksc0JBQXVCMkUsR0FDbkQ5RSxPQUFPQyxRQUFRQyxTQUFTQyxJQUFJLHlCQUVYLE1BQWZ3QixFQUFJaUUsT0FDTnJGLElBRUFpQyxFQUFVYixFQUFLa0QsSUFHbkJOLE1BQU9oRSxFQUNQc0YsU0FBVSxXQUNSN0gsR0FBWSxPQVdkOEgsRUFBaUIsU0FBVTdILEdBQ0EsT0FBekJSLEVBQVUsWUFBZ0QsS0FBekJBLEVBQVUsWUFDekNRLEdBQU1ELEdBQVksR0FDdEI0RyxFQUFzQixXQUFZbkgsRUFBVSxZQUM1Q0wsU0FBU0MsY0FBYyx5QkFBeUJ3RCxNQUFRcEQsRUFBVSxZQUU5REwsU0FBU0MsY0FBYyw4QkFBOEJhLFVBQVU2SCxTQUFTLFNBQzFFM0ksU0FBU0MsY0FBYyw4QkFBOEJhLFVBQVVDLE9BQU8sU0FVeEU2SCxFQUF3QixTQUFVQyxHQUNwQ3pJLEVBQWF5SSxFQUVYL0ksRUFERStJLEVBQ3VCN0ksU0FBU0MsY0FBYyx5QkFBeUJVLGFBQWEsd0JBRTdELEVBRTNCK0gsRUFBZSxTQVNiSSxFQUFxQixTQUFVM0IsR0FDakMsR0FBSUEsRUFDRnZHLEdBQVksR0FDaUUsS0FBekVaLFNBQVNDLGNBQWMsd0NBQXdDd0QsT0FDakV6RCxTQUFTQyxjQUFjLG1DQUFtQ2EsVUFBVUUsSUFBSSxRQUN4RTRCLE9BQU9DLFFBQVFDLFNBQVNDLElBQUksa0JBQW1CLFFBQy9DL0MsU0FBU0MsY0FBYyx3QkFBd0JhLFVBQVVDLE9BQU8sUUFDaEVmLFNBQVNDLGNBQWMsMEJBQTBCYSxVQUFVRSxJQUFJLFFBQy9EaEIsU0FBU0MsY0FBYyw2QkFBNkJhLFVBQVVFLElBQUksVUFFbEVoQixTQUFTQyxjQUFjLG1DQUFtQ2EsVUFBVUUsSUFBSSxRQUN4RTRCLE9BQU9DLFFBQVFDLFNBQVNDLElBQUksa0JBQW1CLFFBQy9DL0MsU0FBU0MsY0FBYyx3QkFBd0JhLFVBQVVFLElBQUksUUFDN0RoQixTQUFTQyxjQUFjLDBCQUEwQmEsVUFBVUMsT0FBTyxRQUNsRWYsU0FBU0MsY0FBYyw2QkFBNkJhLFVBQVVFLElBQUksYUFFL0QsQ0FDTGhCLFNBQVNDLGNBQWMsd0JBQXdCYSxVQUFVRSxJQUFJLFFBQzdEaEIsU0FBU0MsY0FBYywwQkFBMEJhLFVBQVVFLElBQUksUUFDL0RoQixTQUFTQyxjQUFjLDZCQUE2QmEsVUFBVUUsSUFBSSxRQUU5RGQsR0FBd0JDLEVBQzFCeUMsT0FBT0MsUUFBUUMsU0FBU0MsSUFBSSxpQkFBa0IvQyxTQUFTK0ksTUFFdkRuSSxHQUFZLEVBR2QsSUFBSW9JLEdBQWFoSixTQUFTQyxjQUFjLHlCQUF5QndELE1BQU16QixRQUFRLE1BQU8sS0FBTzNCLEVBQVUsVUFDdkdtSCxHQUFzQixLQUFNd0IsS0FVNUJDLEdBQWMsRUFDZEMsRUFBVSxXQUNSRCxJQUNGQSxHQUFjLEVBRWRyRyxPQUFPQyxRQUFRc0csS0FBSyx3QkFBeUIsUUFBUyxXQUNwRDNGLE1BRUZaLE9BQU9DLFFBQVFzRyxLQUFLLHdCQUF5QixPQUFRLFdBQ25EM0YsUUFVRjRGLEVBQWUsV0FFakJ4RyxPQUFPQyxRQUFRc0csS0FBSyx3Q0FBeUMsUUFBUyxTQUFVRSxHQUM5RUEsRUFBRUMsaUJBQ0Y1RyxNQUlGRSxPQUFPQyxRQUFRc0csS0FBSyxnQ0FBaUMsUUFBUyxXQUM1RHpHLElBQ0ExQyxTQUFTQyxjQUFjLGtDQUFrQ2EsVUFBVUMsT0FBTyxRQUMxRWhCLEVBQW9CZSxVQUFVRSxJQUFJLFFBQ2xDakIsRUFBb0JlLFVBQVVDLE9BQU8sZUFDckNoQixFQUFvQmUsVUFBVUMsT0FBTyxlQUl2QzZCLE9BQU9DLFFBQVFzRyxLQUFLLHlDQUEwQyxRQUFTLFdBQ3JFbkosU0FBU0MsY0FBYyxtQ0FBbUNhLFVBQVVFLElBQUksUUFDeEU0QixPQUFPQyxRQUFRQyxTQUFTQyxJQUFJLGtCQUFtQixRQUMvQy9DLFNBQVNDLGNBQWMsa0NBQWtDYSxVQUFVQyxPQUFPLFFBQzFFaEIsRUFBb0JlLFVBQVVFLElBQUksUUFDbENqQixFQUFvQmUsVUFBVUMsT0FBTyxlQUNyQ2hCLEVBQW9CZSxVQUFVQyxPQUFPLGFBRXJDMkIsSUFDQTFDLFNBQVNDLGNBQWMseUJBQXlCc0osVUFJbEQzRyxPQUFPQyxRQUFRc0csS0FBSyxrQ0FBbUMsUUFBUyxXQUM5RHZHLE9BQU9DLFFBQVFDLFNBQVNDLElBQUksa0JBQW1CLFFBQy9DL0MsU0FBU0MsY0FBYyxtQ0FBbUNhLFVBQVVFLElBQUksVUFJMUU0QixPQUFPQyxRQUFRc0csS0FBSyxnQ0FBaUMsUUFBUyxTQUFVRSxHQUN0RUEsRUFBRUMsZ0JBQ0YsSUFBSS9JLEdBQVVQLFNBQVNDLGNBQWMseUJBQXlCd0QsTUFDMURsQixFQUFVN0IsR0FFc0JvSSxJQUFwQzFGLEVBQWdCN0MsRUFBU2dDLE1BSXZCdkMsU0FBU0MsY0FBYyxxQ0FDekIyQyxPQUFPQyxRQUFRc0csS0FBSyxtQ0FBb0MsUUFBUyxTQUFVRSxHQUN6RUEsRUFBRUMsaUJBQ0YxRyxPQUFPQyxRQUFRQyxTQUFTQyxJQUFJLGtCQUFtQixRQUMvQy9DLFNBQVNDLGNBQWMsbUNBQW1DYSxVQUFVQyxPQUFPLFVBSy9FNkIsT0FBT0MsUUFBUXNHLEtBQUssd0JBQXlCLFFBQVMsV0FDcERuSixTQUFTQyxjQUFjLHdCQUF3QmEsVUFBVUUsSUFBSSxRQUM3RGhCLFNBQVNDLGNBQWMsMEJBQTBCYSxVQUFVRSxJQUFJLFFBQy9EaEIsU0FBU0MsY0FBYyw2QkFBNkJhLFVBQVVFLElBQUksUUFDbEVrSSxNQUtKLEtBQ0VFLElBQ0ExRyxJQUNBRSxPQUFPQyxRQUFRQyxTQUFTMEcsSUFBSSxtQkFBb0JkLEdBQ2hEOUYsT0FBT0MsUUFBUUMsU0FBUzBHLElBQUksMEJBQTJCWixHQUV2RCxNQUFPYSxHQUNQdkMsUUFBUUMsTUFBTSxvQkFBc0JzQyIsImZpbGUiOiJfcmVmYWN0b3JpbmcvX2NvbXBvbmVudHMvcHJvZHVjdC9zaGlwcGluZy9kZXNrdG9wL3NoaXBwaW5nLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxudmFyIGFwcFNoaXBpbmcgPSAoZnVuY3Rpb24gKCkge1xuXG4gIHZhciBCTE9DS19TSElQUElOR19EQVRFID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtc2hpcHBpbmctZGF0ZV0nKSxcbiAgICBGUkVFU0hJUFBJTkdfRU5BQkxFRCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3NlY3Rpb25bZGF0YS1mcmVlLXNoaXBwaW5nLWJ5LXppcGNvZGVdJyksXG4gICAgR0VUX1pJUENPREVfSU5GT19FTkFCTEVEID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcignc2VjdGlvbltkYXRhLWdldC16aXBjb2RlLWluZm9dJyksXG4gICAgaGFzUGVyc29uYSA9IGZhbHNlLFxuICAgIGFkZGl0aW9uYWxEZWxpdmVyeURheXM7XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgZ2V0Q29va2llXG4gICAqIEdldCBjb29raWUgYnkgbmFtZVxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IFt6aXBjb2RlXVxuICAgKi9cbiAgdmFyIGdldENvb2tpZSA9IGZ1bmN0aW9uIChja25hbWUpIHtcbiAgICB2YXIgemlwY29kZSA9IGRvY3VtZW50LmNvb2tpZS5tYXRjaCgnKF58OykgPycgKyBja25hbWUgKyAnPShbXjtdKikoO3wkKScpO1xuICAgIHJldHVybiB6aXBjb2RlID8gemlwY29kZVsyXSA6IG51bGw7XG4gIH07XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgZ2V0Q291bnRyeVxuICAgKiBHZXQgY291bnRyeVxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IFtjb3VudHJ5XVxuICAgKi9cbiAgdmFyIGdldENvdW50cnkgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2h0bWwnKS5nZXRBdHRyaWJ1dGUoJ2xhbmcnKTtcbiAgfTtcblxuICAvKipcbiAgICogQG1ldGhvZCBhamF4TG9hZGluZ1xuICAgKiBBdXggZm9yIGhpZGUvc2hvdyBsb2FkaW5nIGdpZlxuICAgKiBAcmV0dXJuIHt9XG4gICAqL1xuICB2YXIgYWpheExvYWRpbmcgPSBmdW5jdGlvbiAoc2hvdykge1xuICAgIGlmIChzaG93KSB7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYWpheC1sb2FkaW5nLW91dCcpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGUnKTtcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXNoaXBwaW5nLWZvcm1dJykuY2xhc3NMaXN0LmFkZCgnb3BhY2l0eScpO1xuICAgIH0gZWxzZSB7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYWpheC1sb2FkaW5nLW91dCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXNoaXBwaW5nLWZvcm1dJykuY2xhc3NMaXN0LnJlbW92ZSgnb3BhY2l0eScpO1xuICAgIH1cbiAgfTtcblxuICAvKipcbiAgICogQG1ldGhvZCBmb3JtYXRaaXBjb2RlXG4gICAqIEZvcm1hdCB6aXBjb2RlIHdpdGggXCItXCIgbGlrZSB0aGlzIDAwMDAwLTAwMFxuICAgKiBAcGFyYW0gIHtzdHJpbmd9IHogW3VzZXIncyB6aXBjb2RlXVxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IFtmb3JtYXR0ZWQgemlwY29kZV1cbiAgICovXG4gIHZhciBmb3JtYXRaaXBjb2RlID0gZnVuY3Rpb24gKHopIHtcbiAgICB2YXIgemlwY29kZSA9IHouc3BsaXQoJycpO1xuXG4gICAgdmFyIGZvcm1hdHRlZFppcGNvZGUgPSB6aXBjb2RlLm1hcChmdW5jdGlvbiAoZWxlbSwgaW5kZXgpIHtcbiAgICAgIGlmIChpbmRleCA9PT0gNSkge1xuICAgICAgICByZXR1cm4gJy0nICsgZWxlbTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBlbGVtO1xuICAgICAgfVxuICAgIH0pO1xuICAgIGZvcm1hdHRlZFppcGNvZGUgPSBmb3JtYXR0ZWRaaXBjb2RlLmpvaW4oJycpO1xuXG4gICAgcmV0dXJuICEhZm9ybWF0dGVkWmlwY29kZSA/IGZvcm1hdHRlZFppcGNvZGUgOiBudWxsO1xuICB9O1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIGZvcm1hdERhdGVcbiAgICogRm9ybWF0IGRhdGUgYW5kIHJldHVybiBhdCBmb3JtYXQgdGV4dFxuICAgKiBAcGFyYW0gIHtkYXRlfSBkYXRlIFtkZWxpdmVyeSBkYXRlXVxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IFt0ZXh0IGRlbGl2ZXJ5IGRhdGVdXG4gICAqL1xuICB2YXIgZm9ybWF0RGF0ZSA9IGZ1bmN0aW9uIChkYXRlKSB7XG4gICAgdmFyIGQgPSBkYXRlLnNwbGl0KCctJyk7XG4gICAgdmFyIG51bWVyaWNEYXRlID0gW107XG5cbiAgICAvLyByZW1vdmUgbGVmdCB6ZXJvXG4gICAgZC5mb3JFYWNoKGZ1bmN0aW9uIChpKSB7XG4gICAgICB2YXIgaXRlbSA9IGkucmVwbGFjZSgvXjArKD8hXFwufCQpLywgJycpO1xuICAgICAgbnVtZXJpY0RhdGUucHVzaChpdGVtKTtcbiAgICB9KTtcbiAgICBudW1lcmljRGF0ZSA9IG51bWVyaWNEYXRlLmpvaW4oJy8nKTtcblxuICAgIC8vIHRyYW5zZm9ybSBudW1lcmljIGRhdGUgaW4gc3RyaW5nXG4gICAgdmFyIHN0cmluZ0RhdGUgPSBuZXcgRGF0ZShudW1lcmljRGF0ZSk7XG4gICAgdmFyIG9wdGlvbnMgPSB7IG1vbnRoOiAnbG9uZycsIGRheTogJ251bWVyaWMnIH07XG5cbiAgICAvLyBjb3VudHJ5XG4gICAgdmFyIGNvdW50cnkgPSBnZXRDb3VudHJ5KCk7XG5cbiAgICAvLyBzZXQgZGF0ZVxuICAgIHZhciBuZXdEYXRlID0gc3RyaW5nRGF0ZS50b0xvY2FsZURhdGVTdHJpbmcoY291bnRyeSwgb3B0aW9ucyk7XG5cbiAgICByZXR1cm4gISFuZXdEYXRlID8gbmV3RGF0ZSA6IG51bGw7XG4gIH07XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgYXBwbHlJbnB1dE1ha3NcbiAgICogQXBwbHkgemlwY29kZSBtYXNrIDAwMDAwLTAwMFxuICAgKiBAcmV0dXJuIHt9XG4gICAqL1xuICB2YXIgYXBwbHlJbnB1dE1ha3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1zaGlwcGluZy1mb3JtXScpO1xuICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnB1YignZmllbGRNYXNrLmxvYWQnLCBmb3JtKTtcbiAgfTtcblxuICAvKipcbiAgICogQG1ldGhvZCBoaWRlT3JTaG93RWxlbXNcbiAgICogQXV4IGZvciBoaWRlL3Nob3cgZWxlbWVudHMgYWZ0ZXIgY2FsY3VsYXRlIHNoaXBwaW5nXG4gICAqIEBwYXJhbSAge3N0cmluZ30gY2xhc3NOYW1lIFtoaWRlOiB0byBoaWRlIGVsZW1lbnRzfHNob3c6IHRvIHNob3cgZWxlbWVudHNdXG4gICAqIEBwYXJhbSAge2Jvb2xlYW59IG1vZGFsIFtlbGVtZW50IGh0bWxdXG4gICAqIEByZXR1cm4ge31cbiAgICovXG4gIHZhciBoaWRlT3JTaG93RWxlbXMgPSBmdW5jdGlvbiAoY2xhc3NOYW1lLCBtb2RhbCkge1xuICAgIGlmIChnZXRDb29raWUoJ3ppcGNvZGUnKSAhPT0gbnVsbCAmJiBtb2RhbCkge1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtc2hpcHBpbmctYnV0dG9uLWNvbnN1bHRdJykuY2xhc3NMaXN0LmFkZChjbGFzc05hbWUpO1xuICAgICAgQkxPQ0tfU0hJUFBJTkdfREFURS5jbGFzc0xpc3QuYWRkKCdhdmFpbGFibGUnKTtcbiAgICAgIEJMT0NLX1NISVBQSU5HX0RBVEUuY2xhc3NMaXN0LnJlbW92ZShjbGFzc05hbWUpO1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtc2hpcHBpbmctZGF0ZXMtdGFibGVdJykuY2xhc3NMaXN0LnJlbW92ZShjbGFzc05hbWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1zaGlwcGluZy1idXR0b24tY29uc3VsdF0nKS5jbGFzc0xpc3QucmVtb3ZlKGNsYXNzTmFtZSk7XG4gICAgfVxuICB9O1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIHNoaXBwaW5nRXJyb3JcbiAgICogQVBJIGVycm9yXG4gICAqIEByZXR1cm4ge31cbiAgICovXG4gIHZhciBzaGlwcGluZ0Vycm9yID0gZnVuY3Rpb24gKCkge1xuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXNoaXBwaW5nLWNvbnRhaW5lci1pbnB1dF0nKS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG4gICAgQkxPQ0tfU0hJUFBJTkdfREFURS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG4gICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIucHViKCdvdmVybGF5LmRpc3BsYXknLCAnaGlkZScpO1xuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaGlwcGluZ19faW5wdXQtZmFpbC1lcnInKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJyk7XG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtc2hpcHBpbmctYnV0dG9uLWNvbnN1bHRdJykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpO1xuICAgIGFqYXhMb2FkaW5nKGZhbHNlKTtcbiAgfTtcblxuICAvKipcbiAgICogQG1ldGhvZCB2YWxpZGF0ZVppcGNvZGVcbiAgICogVGVzdCB0byB2YWxpZGF0ZSBpZiB0aGUgaW5wdXQgemlwY29kZSBpcyB2YWxpZCBhY2NvcmRpbmcgdG8gdGhlIG51bWJlciBvZiBjaGFyYWN0ZXJzXG4gICAqIEBwYXJhbSAge3N0cmluZ30geiBbemlwY29kZV1cbiAgICogQHBhcmFtICB7c3RyaW5nfSBjIFtjb3VudHJ5XVxuICAgKiBAcmV0dXJuIHtib29sZWFufSBbdHJ1ZSBvciBmYWxzZV1cbiAgICovXG4gIHZhciB2YWxpZGF0ZVppcGNvZGUgPSBmdW5jdGlvbiAoeiwgYykge1xuICAgIGlmICh6ICE9PSAnJykge1xuICAgICAgLy8gcmVtb3ZlcyBhbnkgY2hhcmFjdGVyIHRoYXQgaXMgbm90IGEgZGlnaXQgY2hhcmFjdGVyICgwLTkpXG4gICAgICB2YXIgemlwY29kZSA9IHoucmVwbGFjZSgvXFxEL2csICcnKTtcblxuICAgICAgLy8gOCBkaWdpdHMgMCB0byA5XG4gICAgICB2YXIgcmVnZXggPSAvXlswLTldezh9JC87XG5cbiAgICAgIC8vIDQgZGlnaXRzIDAgdG8gOVxuICAgICAgaWYgKGMgPT09ICdlcy1BUicpIHtcbiAgICAgICAgcmVnZXggPSAvXlswLTldezR9JC87XG5cbiAgICAgICAgLy8gNSBkaWdpdHMgMCB0byA5XG4gICAgICB9IGVsc2UgaWYgKGMgPT09ICdlcy1NWCcpIHtcbiAgICAgICAgcmVnZXggPSAvXlswLTldezV9JC87XG4gICAgICB9XG5cbiAgICAgIHJldHVybiByZWdleC50ZXN0KHppcGNvZGUpO1xuXG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgaGlkZU9yU2hvd0xhYmVsXG4gICAqIGF1eCBmb3IgaGlkZS9zaG93IGxhYmVsIG9mIGlucHV0XG4gICAqIEByZXR1cm4ge31cbiAgICovXG5cbiAgdmFyIGhpZGVPclNob3dMYWJlbCA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtc2hpcHBpbmctaW5wdXRdJykudmFsdWUgIT09ICcnKSB7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1zaGlwcGluZy1idXR0b24tY29uc3VsdF0gbGFiZWwnKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXNoaXBwaW5nLWJ1dHRvbi1jb25zdWx0XSBsYWJlbCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgYXBwZW5kZVppcGNvZGVCZXN0U2VsbGVyc1xuICAgKiBBcHBlbmRlIGRlbGl2ZXJ5IGRhdGUgZm9yIGJlc3Qgc2VsbGVyc1xuICAgKiBAcmV0dXJuIHt9XG4gICAqL1xuICB2YXIgYXBwZW5kZVppcGNvZGVCZXN0U2VsbGVycyA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5ib3gtYmVzdC1zZWxsZXIgPiAuc2VsbGVyLW1vZGFsLXRpbmdsZSBbZGF0YS1zZWxsZXItaWRdJykubGVuZ3RoID4gMCkge1xuICAgICAgdmFyICRhbGxTZWxsZXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmJveC1iZXN0LXNlbGxlciA+IC5zZWxsZXItbW9kYWwtdGluZ2xlIFtkYXRhLXNlbGxlci1pZF0nKTtcblxuICAgICAgJGFsbFNlbGxlcnMuZm9yRWFjaChmdW5jdGlvbiAoJGVsKSB7XG5cbiAgICAgICAgJGVsLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcblxuICAgICAgICB2YXIgc2VsbGVySWQgPSAkZWwuZ2V0QXR0cmlidXRlKCdkYXRhLXNlbGxlci1pZCcpO1xuICAgICAgICBpZiAoZGF0YVtzZWxsZXJJZF0pIHtcblxuICAgICAgICAgIC8vIEZvcm1hdCBkYXRlIGFuZCBhcHBlbmRcbiAgICAgICAgICB2YXIgZGF0ZSA9IGRhdGFbc2VsbGVySWRdWzBdLmRlbGl2ZXJ5RGF0ZTtcbiAgICAgICAgICB2YXIgZGF0ZUZvcm1hdHRlZCA9IGZvcm1hdERhdGUoZGF0ZSk7XG5cbiAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYm94LWJlc3Qtc2VsbGVyIFtkYXRhLXNlbGxlci1pZD1cIicgKyBzZWxsZXJJZCArICdcIl0gLmRhdGUnKS5mb3JFYWNoKGZ1bmN0aW9uICgkdGhpcykge1xuICAgICAgICAgICAgaWYgKCR0aGlzKSB7XG4gICAgICAgICAgICAgICR0aGlzLmlubmVyVGV4dCA9IGRhdGVGb3JtYXR0ZWQ7XG4gICAgICAgICAgICAgICR0aGlzLnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgY2hlY2tCZXN0VGltZUluRGF5c1xuICAgKiBhcHBlbmQgbWVzc2FnZVxuICAgKiBAcmV0dXJuIHt9XG4gICAqL1xuICB2YXIgY2hlY2tCZXN0VGltZUluRGF5cyA9IGZ1bmN0aW9uIChyZXMsIGN1cnJlbnRGb3JtYXR0ZWRaaXBjb2RlLCB0b2RheSwgdG9tb3Jyb3cpIHtcbiAgICB2YXIgZmFzdGVzdERlbGl2ZXJ5ID0gcmVzWzBdO1xuICAgIHZhciBmYXN0ZXN0RGVsaXZlcnlEYXRlID0gZmFzdGVzdERlbGl2ZXJ5Lm1pbkRlbGl2ZXJ5RGF0ZTtcbiAgICB2YXIgZmFzdGVzdERlbGl2ZXJ5VHlwZSA9IGZhc3Rlc3REZWxpdmVyeS50eXBlO1xuXG4gICAgdmFyIGZvcm1hdGVkRGF0ZSA9IGZvcm1hdERhdGUoZmFzdGVzdERlbGl2ZXJ5RGF0ZSk7XG5cbiAgICAvL0NoZWNrIHRoZSBtZXNzYWdlIHRvIHNob3cgdG8gdGhlIGNsaWVudFxuICAgIGlmIChmYXN0ZXN0RGVsaXZlcnlUeXBlID09PSBcIlNVUEVSX0VYUFJFU1NcIikge1xuICAgICAgaWYgKGZhc3Rlc3REZWxpdmVyeURhdGUgPT09IHRvZGF5KSB7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5iZXN0LXNoaXBwaW5nLW1lc3NhZ2UnKS5pbm5lckhUTUwgPSAnPGI+UmVjZWJhIGhvamU8L2I+IGFvIGZpbmFsaXphciBvIHBlZGlkbyBhdMOpIMOgcyAxMmggY29tIGEgb3DDp8OjbyBkZSBlbnRyZWdhIFN1cGVyIEV4cHJlc3NhIHBhcmEgbyBDRVAgJyArXG4gICAgICAgICAgY3VycmVudEZvcm1hdHRlZFppcGNvZGUgKyAnLic7XG4gICAgICB9IGVsc2UgaWYgKGZhc3Rlc3REZWxpdmVyeURhdGUgPT09IHRvbW9ycm93KSB7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5iZXN0LXNoaXBwaW5nLW1lc3NhZ2UnKS5pbm5lckhUTUwgPSAnPGI+UmVjZWJhIGFtYW5ow6M8L2I+IGFvIGVzY29saGVyIGEgb3DDp8OjbyBkZSBlbnRyZWdhIFN1cGVyIEV4cHJlc3NhIHBhcmEgbyBDRVAgJyArXG4gICAgICAgICAgY3VycmVudEZvcm1hdHRlZFppcGNvZGUgKyAnLic7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYmVzdC1zaGlwcGluZy1tZXNzYWdlJykuaW5uZXJIVE1MID0gJzxiPlJlY2ViYSBkaWEgJyArIGZvcm1hdGVkRGF0ZSArICc8L2I+IGFvIGVzY29saGVyIGEgb3DDp8OjbyBkZSBlbnRyZWdhIFN1cGVyIEV4cHJlc3NhIHBhcmEgbyBDRVAgJyArXG4gICAgICAgICAgY3VycmVudEZvcm1hdHRlZFppcGNvZGUgKyAnLic7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChmYXN0ZXN0RGVsaXZlcnlUeXBlID09PSBcIkVYUFJFU1NcIikge1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJlc3Qtc2hpcHBpbmctbWVzc2FnZScpLmlubmVySFRNTCA9ICc8Yj5SZWNlYmEgYSBwYXJ0aXIgZG8gZGlhICcgKyBmb3JtYXRlZERhdGUgKyAnPC9iPiBhbyBlc2NvbGhlciBhIG9ww6fDo28gZGUgZW50cmVnYSBFeHByZXNzYSBwYXJhIG8gQ0VQICcgK1xuICAgICAgICBjdXJyZW50Rm9ybWF0dGVkWmlwY29kZSArICcuJztcbiAgICB9IGVsc2UgaWYgKGZhc3Rlc3REZWxpdmVyeVR5cGUgPT09IFwiTk9STUFMXCIpIHtcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5iZXN0LXNoaXBwaW5nLW1lc3NhZ2UnKS5pbm5lckhUTUwgPSAnPGI+UmVjZWJhIGEgcGFydGlyIGRvIGRpYSAnICsgZm9ybWF0ZWREYXRlICsgJzwvYj4gYW8gZXNjb2xoZXIgYSBvcMOnw6NvIGRlIGVudHJlZ2EgTm9ybWFsIHBhcmEgbyBDRVAgJyArXG4gICAgICAgIGN1cnJlbnRGb3JtYXR0ZWRaaXBjb2RlICsgJy4nO1xuICAgIH1cbiAgfTtcblxuICAvKipcbiAgICogQG1ldGhvZCBkZWxpdmVyeVVuYXZhaWxhYmxlXG4gICAqIGFwcGVuZCBkZWxpdmVyeSBkYXRlXG4gICAqIEByZXR1cm4ge31cbiAgICovXG4gIHZhciBkZWxpdmVyeVVuYXZhaWxhYmxlID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciB6aXBjb2RlVGFnID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm5vLWRlbGl2ZXJ5LW9wdGlvbiAuemlwY29kZScpO1xuICAgIHppcGNvZGVUYWcuaW5uZXJIVE1MID0gZ2V0Q29va2llKCd6aXBjb2RlJyk7XG4gICAgQkxPQ0tfU0hJUFBJTkdfREFURS5jbGFzc0xpc3QuYWRkKCd1bmF2YWlsYWJsZScpO1xuICAgIEJMT0NLX1NISVBQSU5HX0RBVEUuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpO1xuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXNoaXBwaW5nLWJ1dHRvbi1jb25zdWx0XScpLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgfTtcblxuICAvKipcbiAgICogQG1ldGhvZCBhcHBlbmRlcnNcbiAgICogYXBwZW5kIGRlbGl2ZXJ5IGRhdGVcbiAgICogQHJldHVybiB7fVxuICAgKi9cbiAgdmFyIGFwcGVuZGVycyA9IGZ1bmN0aW9uIChyZXMsIHJlcVR5cGUpIHtcbiAgICBpZiAoZ2V0Q29va2llKCd6aXBjb2RlJykgIT09IG51bGwgJiYgcmVzICE9PSBudWxsKSB7XG5cbiAgICAgIHZhciBzaGlwcGluZ05vdEVtcHR5ID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMocmVzKS5sZW5ndGggPiAwO1xuXG4gICAgICBpZiAoc2hpcHBpbmdOb3RFbXB0eSkge1xuICAgICAgICAvLyBBcHBlbmQgZGVsaXZlcnkgZm9yIGFsbCBzZWxsZXJzXG4gICAgICAgIGFwcGVuZGVaaXBjb2RlQmVzdFNlbGxlcnMocmVzKTtcblxuICAgICAgICAvLyBVcGRhdGUgdGFibGUgb2YgbWFpbiBzZWxsZXJcbiAgICAgICAgdmFyIHRhYmxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNoaXBwaW5nX190YWJsZScpO1xuICAgICAgICB0YWJsZS5xdWVyeVNlbGVjdG9yKCd0Ym9keScpLmlubmVySFRNTCA9ICcnO1xuXG4gICAgICAgIC8vVXBkYXRlIGluZm8gRGVsaXZlcnkgTWFnYWx1XG4gICAgICAgIGlmKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaGlwcGluZ19fZGVsaXZlcnktbWFnYWx1JykpIHtcbiAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2hpcHBpbmdfX2RlbGl2ZXJ5LW1hZ2FsdScpLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2hpcHBpbmdfX2RlbGl2ZXJ5LW1hZ2FsdSBzcGFuJykuaW5uZXJIVE1MID0gJyc7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgc2VsbGVySWRDdXJyZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNoaXBwaW5nX19pbnB1dCcpLmdldEF0dHJpYnV0ZSgnZGF0YS1zZWxsZXJpZCcpO1xuICAgICAgICB2YXIgYXJyRGVsaXZlcnlEYXRlID0gcmVzW3NlbGxlcklkQ3VycmVudF07XG5cbiAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgICAgICB2YXIgY3VycmVudERhdGUgPSBkYXRlLnRvTG9jYWxlRGF0ZVN0cmluZygncHQtQlInKS5tYXRjaCgvKF5cXGR7Mn0pXFwvKFxcZHsyfSlcXC8oXFxkezR9KS8pO1xuICAgICAgICBjdXJyZW50RGF0ZSA9IGN1cnJlbnREYXRlLnJlZHVjZVJpZ2h0KGZ1bmN0aW9uIChhY2MsIGVsLCBpbmRleCkge1xuICAgICAgICAgIGlmICghaW5kZXgpIHJldHVybiBhY2M7XG4gICAgICAgICAgaWYgKGluZGV4ID09PSAxKSByZXR1cm4gYWNjICsgZWw7XG4gICAgICAgICAgcmV0dXJuIGFjYyArIGVsICsgJy0nO1xuICAgICAgICB9LCAnJyk7XG5cbiAgICAgICAgZGF0ZS5zZXREYXRlKGRhdGUuZ2V0RGF0ZSgpICsgMSk7XG4gICAgICAgIHZhciB0b21vcnJvd0RhdGUgPSBkYXRlLnRvTG9jYWxlRGF0ZVN0cmluZygncHQtQlInKS5tYXRjaCgvKF5cXGR7Mn0pXFwvKFxcZHsyfSlcXC8oXFxkezR9KS8pO1xuICAgICAgICB0b21vcnJvd0RhdGUgPSB0b21vcnJvd0RhdGUucmVkdWNlUmlnaHQoZnVuY3Rpb24gKGFjYywgZWwsIGluZGV4KSB7XG4gICAgICAgICAgaWYgKCFpbmRleCkgcmV0dXJuIGFjYztcbiAgICAgICAgICBpZiAoaW5kZXggPT09IDEpIHJldHVybiBhY2MgKyBlbDtcbiAgICAgICAgICByZXR1cm4gYWNjICsgZWwgKyAnLSc7XG4gICAgICAgIH0sICcnKTtcblxuICAgICAgICBhcnJEZWxpdmVyeURhdGUuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSwga2V5KSB7XG4gICAgICAgICAgLy8gRm9ybWF0IGRhdGVcbiAgICAgICAgICB2YXIgZGVsaXZlcnlEYXRlID0gaXRlbS5taW5EZWxpdmVyeURhdGU7XG4gICAgICAgICAgLy8gdmFyIGRhdGVGb3JtYXR0ZWQgPSBmb3JtYXREYXRlKGRlbGl2ZXJ5RGF0ZSk7XG4gICAgICAgICAgdmFyIGRhdGVGb3JtYXR0ZWQgPSBcIlwiO1xuXG4gICAgICAgICAgLy8gVGV4dCBvZiBkZWxpdmVyeSB0eXBlXG4gICAgICAgICAgdmFyIHJvd0NvdW50ID0gdGFibGUucm93cy5sZW5ndGg7XG4gICAgICAgICAgdmFyIHJvdyA9IHRhYmxlLmluc2VydFJvdyhyb3dDb3VudCk7XG4gICAgICAgICAgdmFyIGNvbDEgPSByb3cuaW5zZXJ0Q2VsbCgwKTtcbiAgICAgICAgICB2YXIgY29sMiA9IHJvdy5pbnNlcnRDZWxsKDEpO1xuICAgICAgICAgIHZhciBkZWxpdmVyeVR5cGUgPSBpdGVtLnR5cGU7XG4gICAgICAgICAgdmFyIHRleHRUeXBlID0gJyc7XG4gICAgICAgICAgdmFyIHRleHQgPSAnJztcblxuICAgICAgICAgIGlmICh3aW5kb3cuZnJlZWRvbS5pMThuLmRlbGl2ZXJ5TXNnW2RlbGl2ZXJ5VHlwZV0gJiZcbiAgICAgICAgICAgIHdpbmRvdy5mcmVlZG9tLmkxOG4uZGVsaXZlcnlNc2dbZGVsaXZlcnlUeXBlXS50eXBlICYmXG4gICAgICAgICAgICB3aW5kb3cuZnJlZWRvbS5pMThuLmRlbGl2ZXJ5TXNnW2RlbGl2ZXJ5VHlwZV0udGV4dFxuICAgICAgICAgICkge1xuICAgICAgICAgICAgaWYgKGRlbGl2ZXJ5VHlwZSA9PT0gXCJTVVBFUl9FWFBSRVNTXCIpIHtcbiAgICAgICAgICAgICAgaWYgKGRlbGl2ZXJ5RGF0ZSA9PT0gY3VycmVudERhdGUpIHtcbiAgICAgICAgICAgICAgICB0ZXh0VHlwZSA9IHdpbmRvdy5mcmVlZG9tLmkxOG4uZGVsaXZlcnlNc2dbXCJTVVBFUl9FWFBSRVNTXCJdLnR5cGU7XG4gICAgICAgICAgICAgICAgdGV4dCA9IFwiUmVjZWJhIGhvamVcIjtcbiAgICAgICAgICAgICAgfSBlbHNlIGlmIChkZWxpdmVyeURhdGUgPT09IHRvbW9ycm93RGF0ZSkge1xuICAgICAgICAgICAgICAgIHRleHRUeXBlID0gd2luZG93LmZyZWVkb20uaTE4bi5kZWxpdmVyeU1zZ1tcIlNVUEVSX0VYUFJFU1NcIl0udHlwZTtcbiAgICAgICAgICAgICAgICB0ZXh0ID0gXCJSZWNlYmEgYW1hbmjDo1wiO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRleHRUeXBlID0gd2luZG93LmZyZWVkb20uaTE4bi5kZWxpdmVyeU1zZ1tcIlNVUEVSX0VYUFJFU1NcIl0udHlwZTtcbiAgICAgICAgICAgICAgICB0ZXh0ID0gJ1JlY2ViYSBkaWEgJztcbiAgICAgICAgICAgICAgICBkYXRlRm9ybWF0dGVkID0gZm9ybWF0RGF0ZShkZWxpdmVyeURhdGUpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0ZXh0VHlwZSA9IHdpbmRvdy5mcmVlZG9tLmkxOG4uZGVsaXZlcnlNc2dbZGVsaXZlcnlUeXBlXS50eXBlO1xuICAgICAgICAgICAgICB0ZXh0ID0gd2luZG93LmZyZWVkb20uaTE4bi5kZWxpdmVyeU1zZ1tkZWxpdmVyeVR5cGVdLnRleHQ7XG4gICAgICAgICAgICAgIGRhdGVGb3JtYXR0ZWQgPSBmb3JtYXREYXRlKGRlbGl2ZXJ5RGF0ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY29sMS5pbm5lckhUTUwgPSB0ZXh0VHlwZTtcbiAgICAgICAgICBjb2wyLmlubmVySFRNTCA9IHRleHQgKyAnICcgKyBkYXRlRm9ybWF0dGVkO1xuXG4gICAgICAgICAgaWYoZGVsaXZlcnlUeXBlID09PSBcIkNPTExFQ1RfTUFHQUxVXCIpIHtcbiAgICAgICAgICAgIGlmKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaGlwcGluZ19fZGVsaXZlcnktbWFnYWx1JykpIHtcbiAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNoaXBwaW5nX19kZWxpdmVyeS1tYWdhbHUnKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJyk7XG4gICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaGlwcGluZ19fZGVsaXZlcnktbWFnYWx1IHNwYW4nKS5pbm5lckhUTUwgPSB0ZXh0ICsgJyAnICsgZGF0ZUZvcm1hdHRlZDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRhYmxlLmRlbGV0ZVJvdyhrZXkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gRm9ybWF0IHppcGNvZGVcbiAgICAgICAgdmFyIGN1cnJlbnRaaXBjb2RlID0gZ2V0Q29va2llKCd6aXBjb2RlJyk7XG4gICAgICAgIHZhciBjdXJyZW50Rm9ybWF0dGVkWmlwY29kZSA9IGZvcm1hdFppcGNvZGUoY3VycmVudFppcGNvZGUpO1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2hpcHBpbmdfX3ppcGNvZGUtY3VycmVudCcpLmlubmVySFRNTCA9IGN1cnJlbnRGb3JtYXR0ZWRaaXBjb2RlO1xuXG4gICAgICAgIGNoZWNrQmVzdFRpbWVJbkRheXMoYXJyRGVsaXZlcnlEYXRlLCBjdXJyZW50Rm9ybWF0dGVkWmlwY29kZSwgY3VycmVudERhdGUsIHRvbW9ycm93RGF0ZSk7XG4gICAgICAgIGhpZGVPclNob3dFbGVtcygnaGlkZScsIHRydWUpO1xuICAgICAgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhyZXMpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBpZiAocmVxVHlwZSA9PT0gJ1BEUF9NQU5VQUwnKSB7XG4gICAgICAgICAgZGVsaXZlcnlVbmF2YWlsYWJsZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmICghRlJFRVNISVBQSU5HX0VOQUJMRUQpIGRvY3VtZW50LmNvb2tpZSA9IFwiemlwY29kZT1cIjtcbiAgICAgICAgICBCTE9DS19TSElQUElOR19EQVRFLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2hpcHBpbmdfX2J1dHRvbi0tY29uc3VsdCcpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGUnKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKCFGUkVFU0hJUFBJTkdfRU5BQkxFRCkgZG9jdW1lbnQuY29va2llID0gXCJ6aXBjb2RlPVwiO1xuICAgICAgICBzaGlwcGluZ0Vycm9yKCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICghRlJFRVNISVBQSU5HX0VOQUJMRUQpIGRvY3VtZW50LmNvb2tpZSA9IFwiemlwY29kZT1cIjtcbiAgICAgIHNoaXBwaW5nRXJyb3IoKTtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0VSUk9SIHwgU2hpcHBpbmcnKTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgZ2V0U2VsbGVyc0lkc1xuICAgKlxuICAgKiBAcmV0dXJuIHt9XG4gICAqL1xuICB2YXIgZ2V0U2VsbGVyc0lkcyA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgYXJyc2VsbGVySWQgPSBbXTtcbiAgICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmJveC1iZXN0LXNlbGxlciA+IC5zZWxsZXItbW9kYWwtdGluZ2xlIFtkYXRhLXNlbGxlci1pZF0nKS5sZW5ndGggPiAwKSB7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYm94LWJlc3Qtc2VsbGVyID4gLnNlbGxlci1tb2RhbC10aW5nbGUgW2RhdGEtc2VsbGVyLWlkXScpLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgdmFyIHNlbGxlciA9IGl0ZW0uZ2V0QXR0cmlidXRlKCdkYXRhLXNlbGxlci1pZCcpO1xuICAgICAgICBhcnJzZWxsZXJJZC5wdXNoKHNlbGxlcik7XG4gICAgICB9KTtcbiAgICAgIGFycnNlbGxlcklkID0gYXJyc2VsbGVySWQudG9TdHJpbmcoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYXJyc2VsbGVySWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2hpcHBpbmdfX2lucHV0W2RhdGEtc2VsbGVyaWRdJykuZ2V0QXR0cmlidXRlKCdkYXRhLXNlbGxlcmlkJyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGFycnNlbGxlcklkO1xuICB9O1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIHN1Ym1pdFNoaXBwaW5nUmVxdWVzdFxuICAgKiByZXF1ZXN0IGZvciBnZXQgZGVsaXZlcnkgZGF0ZVxuICAgKiBAcmV0dXJuIHt9XG4gICAqL1xuICB2YXIgc3VibWl0U2hpcHBpbmdSZXF1ZXN0ID0gZnVuY3Rpb24gKHR5cGUsIHppcGNvZGUpIHtcbiAgICB2YXIgaGVhZGVyVHlwZSA9IHR5cGUgPT09ICdQRFBfQVVUTycgPyAnUERQX0FVVE8nIDogJ1BEUF9NQU5VQUwnO1xuICAgIHZhciAkZWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1zaGlwcGluZy1pbnB1dF0nKTtcbiAgICB2YXIgc2VsbGVySWQgPSBnZXRTZWxsZXJzSWRzKCk7XG4gICAgQkxPQ0tfU0hJUFBJTkdfREFURSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXNoaXBwaW5nLWRhdGVdJyk7XG5cbiAgICB2YXIgemlwQ29kZSA9IHppcGNvZGUsXG4gICAgICBza3UgPSAkZWwuZ2V0QXR0cmlidXRlKCdkYXRhLXNrdScpLFxuICAgICAgaGVpZ2h0ID0gJGVsLmdldEF0dHJpYnV0ZSgnZGF0YS1oZWlnaHQnKSxcbiAgICAgIHdlaWdodCA9ICRlbC5nZXRBdHRyaWJ1dGUoJ2RhdGEtd2VpZ2h0JyksXG4gICAgICBkZXB0aCA9ICRlbC5nZXRBdHRyaWJ1dGUoJ2RhdGEtZGVwdGgnKSxcbiAgICAgIHdpZHRoID0gJGVsLmdldEF0dHJpYnV0ZSgnZGF0YS13aWR0aCcpLFxuICAgICAgcHJlU2FsZSA9ICRlbC5nZXRBdHRyaWJ1dGUoJ2RhdGEtcHJlU2FsZScpIHx8IGZhbHNlLFxuICAgICAgY2FuYmV0cmFuc3BvcnRlZGJ5YWlyID0gJGVsLmdldEF0dHJpYnV0ZSgnZGF0YS1jYW5iZXRyYW5zcG9ydGVkYnlhaXInKSB8fCBmYWxzZTtcblxuICAgIHdpbmRvdy5mcmVlZG9tLnJlc3RDbGllbnQucmVxdWVzdCgnL3JlZmFjdG9yaW5nL3NoaXBwaW5nJywge1xuICAgICAgZGlzcGxheUxvYWRpbmc6IGZhbHNlLFxuICAgICAgbWV0aG9kOiAnZ2V0JyxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgemlwQ29kZTogemlwQ29kZSxcbiAgICAgICAgc2VsbGVySWQ6IHNlbGxlcklkLFxuICAgICAgICBza3U6IHNrdSxcbiAgICAgICAgaGVpZ2h0OiBoZWlnaHQsXG4gICAgICAgIHdlaWdodDogd2VpZ2h0LFxuICAgICAgICBkZXB0aDogZGVwdGgsXG4gICAgICAgIHdpZHRoOiB3aWR0aCxcbiAgICAgICAgcHJlU2FsZTogcHJlU2FsZSxcbiAgICAgICAgY2FuYmV0cmFuc3BvcnRlZGJ5YWlyOiBjYW5iZXRyYW5zcG9ydGVkYnlhaXIsXG4gICAgICAgIGhhc1BlcnNvbmE6IGhhc1BlcnNvbmEsXG4gICAgICAgIGFkZGl0aW9uYWxEZWxpdmVyeURheXM6IGFkZGl0aW9uYWxEZWxpdmVyeURheXMsXG4gICAgICAgIGhlYWRlclR5cGU6IGhlYWRlclR5cGVcbiAgICAgIH0sXG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgIGlmICh6aXBDb2RlICYmIGhlYWRlclR5cGUgPT09ICdQRFBfTUFOVUFMJykge1xuICAgICAgICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnB1YignY2hlY2tGcmVlU2hpcHBpbmdFbGlnaWJpbGl0eScsIHppcENvZGUsICdQRFBfWklQQ09ERS1GT1JNJyk7XG4gICAgICAgICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIucHViKCdnZXRaaXBjb2RlRnVsbEluZm8nLCB6aXBDb2RlKTtcbiAgICAgICAgICB3aW5kb3cuemlwY29kZUFQSXNBamF4ID0gZmFsc2U7XG4gICAgICAgICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIucHViKCdjaGFuZ2VIZWFkZXJaaXBjb2RlJywgemlwQ29kZSk7XG4gICAgICAgICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIucHViKCd6aXBjb2RlQ29va2llLnJlaW5pdCcpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChyZXMuc3RhdHVzID09PSAyMDQpIHtcbiAgICAgICAgICBzaGlwcGluZ0Vycm9yKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYXBwZW5kZXJzKHJlcywgaGVhZGVyVHlwZSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBlcnJvcjogc2hpcHBpbmdFcnJvcixcbiAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGFqYXhMb2FkaW5nKGZhbHNlKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICB9O1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIHZhbGlkYXRlQ29va2llXG4gICAqIHZhbGlkYXRlIGNvb2tpZSB0byBzdGFydCB0aGUgcmVxdWVzdFxuICAgKiBAcmV0dXJuIHt9XG4gICAqL1xuICB2YXIgdmFsaWRhdGVDb29raWUgPSBmdW5jdGlvbiAoc2hvdykge1xuICAgIGlmIChnZXRDb29raWUoJ3ppcGNvZGUnKSAhPT0gbnVsbCAmJiBnZXRDb29raWUoJ3ppcGNvZGUnKSAhPT0gJycpIHtcbiAgICAgIGlmIChzaG93KSBhamF4TG9hZGluZyh0cnVlKTtcbiAgICAgIHN1Ym1pdFNoaXBwaW5nUmVxdWVzdCgnUERQX0FVVE8nLCBnZXRDb29raWUoJ3ppcGNvZGUnKSk7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1zaGlwcGluZy1pbnB1dF0nKS52YWx1ZSA9IGdldENvb2tpZSgnemlwY29kZScpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNoaXBwaW5nX19idXR0b24tLWNvbnN1bHQnKS5jbGFzc0xpc3QuY29udGFpbnMoJ2hpZGUnKSkge1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2hpcHBpbmdfX2J1dHRvbi0tY29uc3VsdCcpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGUnKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICogQG1ldGhvZCB1cGRhdGVIYXNQZXJzb25hU3RhdGVcbiAgKiBhcHBlbmQgbWVzc2FnZVxuICAqIEByZXR1cm4ge31cbiAgKi9cbiAgdmFyIHVwZGF0ZUhhc1BlcnNvbmFTdGF0ZSA9IGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgIGhhc1BlcnNvbmEgPSBzdGF0ZTtcbiAgICBpZiAoc3RhdGUpIHtcbiAgICAgIGFkZGl0aW9uYWxEZWxpdmVyeURheXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1zaGlwcGluZy1pbnB1dF0nKS5nZXRBdHRyaWJ1dGUoJ2RhdGEtYWRkZGVsaXZlcnlkYXlzJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGFkZGl0aW9uYWxEZWxpdmVyeURheXMgPSAwO1xuICAgIH1cbiAgICB2YWxpZGF0ZUNvb2tpZSgnc2hvdycpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIHZhbGlkYXRpb25DYWxsYmFja1xuICAgKiBjaGVjayBmb3IgZmllbGQgZXJyb3JcbiAgICogQHBhcmFtICB7Ym9vbGVhbn0gZXJyb3JcbiAgICogQHJldHVybiB7fVxuICAgKi9cbiAgdmFyIHZhbGlkYXRpb25DYWxsYmFjayA9IGZ1bmN0aW9uIChlcnJvcikge1xuICAgIGlmIChlcnJvcikge1xuICAgICAgYWpheExvYWRpbmcoZmFsc2UpO1xuICAgICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaGlwcGluZ19faW5wdXQtYm94PmlucHV0W3R5cGU9dGVsXScpLnZhbHVlICE9PSBcIlwiKSB7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXNoaXBwaW5nLWNvbnRhaW5lci1pbnB1dF0nKS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG4gICAgICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnB1Yignb3ZlcmxheS5kaXNwbGF5JywgJ2hpZGUnKTtcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNoaXBwaW5nX19pbnB1dC1lcnInKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJyk7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaGlwcGluZ19faW5wdXQtZW1wdHknKS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaGlwcGluZ19faW5wdXQtZmFpbC1lcnInKS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1zaGlwcGluZy1jb250YWluZXItaW5wdXRdJykuY2xhc3NMaXN0LmFkZCgnaGlkZScpO1xuICAgICAgICB3aW5kb3cuZnJlZWRvbS5uc1B1YlN1Yi5wdWIoJ292ZXJsYXkuZGlzcGxheScsICdoaWRlJyk7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaGlwcGluZ19faW5wdXQtZXJyJykuY2xhc3NMaXN0LmFkZCgnaGlkZScpO1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2hpcHBpbmdfX2lucHV0LWVtcHR5JykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpO1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2hpcHBpbmdfX2lucHV0LWZhaWwtZXJyJykuY2xhc3NMaXN0LmFkZCgnaGlkZScpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2hpcHBpbmdfX2lucHV0LWVycicpLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaGlwcGluZ19faW5wdXQtZW1wdHknKS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2hpcHBpbmdfX2lucHV0LWZhaWwtZXJyJykuY2xhc3NMaXN0LmFkZCgnaGlkZScpO1xuXG4gICAgICBpZiAoRlJFRVNISVBQSU5HX0VOQUJMRUQgfHwgR0VUX1pJUENPREVfSU5GT19FTkFCTEVEKSB7XG4gICAgICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnB1YignbnNMb2FkaW5nLnNob3cnLCBkb2N1bWVudC5ib2R5KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGFqYXhMb2FkaW5nKHRydWUpO1xuICAgICAgfVxuXG4gICAgICB2YXIgbmV3WmlwY29kZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXNoaXBwaW5nLWlucHV0XScpLnZhbHVlLnJlcGxhY2UoL1xcRC9nLCAnJykgfHwgZ2V0Q29va2llKCd6aXBjb2RlJyk7XG4gICAgICBzdWJtaXRTaGlwcGluZ1JlcXVlc3QobnVsbCwgbmV3WmlwY29kZSk7XG4gICAgfVxuICB9O1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIG9uZm9jdXNcbiAgICogYWRkIGV2ZW50IHRvIGlucHV0IGZvY3VzXG4gICAqIFthdXhTZXRGb2N1c10gYXV4IGZvciBub3QgdG8gZHVwbGljYXRlIGV2ZW50c1xuICAgKiBAcmV0dXJuIHt9XG4gICAqL1xuICB2YXIgYXV4U2V0Rm9jdXMgPSB0cnVlO1xuICB2YXIgb25mb2N1cyA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoYXV4U2V0Rm9jdXMpIHtcbiAgICAgIGF1eFNldEZvY3VzID0gZmFsc2U7XG5cbiAgICAgIHdpbmRvdy5mcmVlZG9tLmxpdmUoJ1tkYXRhLXNoaXBwaW5nLWlucHV0XScsICdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaGlkZU9yU2hvd0xhYmVsKCk7XG4gICAgICB9KTtcbiAgICAgIHdpbmRvdy5mcmVlZG9tLmxpdmUoJ1tkYXRhLXNoaXBwaW5nLWlucHV0XScsICdibHVyJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBoaWRlT3JTaG93TGFiZWwoKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfTtcblxuICAvKipcbiAgICogQG1ldGhvZCBzZXRMaXN0ZW5lcnNcbiAgICogZXZlbnRzIGNsaWNrXG4gICAqIEByZXR1cm4ge31cbiAgICovXG4gIHZhciBzZXRMaXN0ZW5lcnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgLy8gQnV0dG9uIGNvbnN1bHQgZnJlaWd0aFxuICAgIHdpbmRvdy5mcmVlZG9tLmxpdmUoJ1tkYXRhLXNoaXBwaW5nLWJ1dHRvbi1jb25zdWx0XSBidXR0b24nLCAnY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgYXBwbHlJbnB1dE1ha3MoKTtcbiAgICB9KTtcblxuICAgIC8vIEJ1dHRvbiBjaGFuZ2UgZnJlaWd0aFxuICAgIHdpbmRvdy5mcmVlZG9tLmxpdmUoJ1tkYXRhLXNoaXBwaW5nLWJ1dHRvbi1jaGFuZ2VdJywgJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgYXBwbHlJbnB1dE1ha3MoKTtcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXNoaXBwaW5nLWJ1dHRvbi1jb25zdWx0XScpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGUnKTtcbiAgICAgIEJMT0NLX1NISVBQSU5HX0RBVEUuY2xhc3NMaXN0LmFkZCgnaGlkZScpO1xuICAgICAgQkxPQ0tfU0hJUFBJTkdfREFURS5jbGFzc0xpc3QucmVtb3ZlKCd1bmF2YWlsYWJsZScpO1xuICAgICAgQkxPQ0tfU0hJUFBJTkdfREFURS5jbGFzc0xpc3QucmVtb3ZlKCdhdmFpbGFibGUnKTtcbiAgICB9KTtcblxuICAgIC8vIEJ1dHRvbiBjaGFuZ2UgZnJlaWd0aCBpbnRlcm5hbFxuICAgIHdpbmRvdy5mcmVlZG9tLmxpdmUoJ1tpbnRlcm5hbC1kYXRhLXNoaXBwaW5nLWJ1dHRvbi1jaGFuZ2VdJywgJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtc2hpcHBpbmctY29udGFpbmVyLWlucHV0XScpLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnB1Yignb3ZlcmxheS5kaXNwbGF5JywgJ2hpZGUnKTtcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXNoaXBwaW5nLWJ1dHRvbi1jb25zdWx0XScpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGUnKTtcbiAgICAgIEJMT0NLX1NISVBQSU5HX0RBVEUuY2xhc3NMaXN0LmFkZCgnaGlkZScpO1xuICAgICAgQkxPQ0tfU0hJUFBJTkdfREFURS5jbGFzc0xpc3QucmVtb3ZlKCd1bmF2YWlsYWJsZScpO1xuICAgICAgQkxPQ0tfU0hJUFBJTkdfREFURS5jbGFzc0xpc3QucmVtb3ZlKCdhdmFpbGFibGUnKTtcblxuICAgICAgYXBwbHlJbnB1dE1ha3MoKTtcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXNoaXBwaW5nLWlucHV0XScpLmZvY3VzKCk7XG4gICAgfSk7XG5cbiAgICAvLyBDbG9zZSAoYnV0dG9uIG9yIG92ZXJsYXkpXG4gICAgd2luZG93LmZyZWVkb20ubGl2ZSgnW2RhdGEtc2hpcHBpbmctY2xvc2VdLCAjb3ZlcmxheScsICdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnB1Yignb3ZlcmxheS5kaXNwbGF5JywgJ2hpZGUnKTtcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXNoaXBwaW5nLWNvbnRhaW5lci1pbnB1dF0nKS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG4gICAgfSk7XG5cbiAgICAvLyBTdWJtaXRcbiAgICB3aW5kb3cuZnJlZWRvbS5saXZlKCdbZGF0YS1zaGlwcGluZy1idXR0b24tc3VibWl0XScsICdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB2YXIgemlwY29kZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXNoaXBwaW5nLWlucHV0XScpLnZhbHVlO1xuICAgICAgdmFyIGNvdW50cnkgPSBnZXRDb3VudHJ5KCk7XG5cbiAgICAgIHZhbGlkYXRlWmlwY29kZSh6aXBjb2RlLCBjb3VudHJ5KSA/IHZhbGlkYXRpb25DYWxsYmFjayhmYWxzZSkgOiB2YWxpZGF0aW9uQ2FsbGJhY2sodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICAvL2RhdGEtc2hpcHBpbmctYnV0dG9uLW9wZW4tZm9ybVxuICAgIGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1zaGlwcGluZy1idXR0b24tb3Blbi1mb3JtXScpKSB7XG4gICAgICB3aW5kb3cuZnJlZWRvbS5saXZlKCdbZGF0YS1zaGlwcGluZy1idXR0b24tb3Blbi1mb3JtXScsICdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIucHViKCdvdmVybGF5LmRpc3BsYXknLCAnc2hvdycpO1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1zaGlwcGluZy1jb250YWluZXItaW5wdXRdJykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQ2FsbCB0byBldmVudCBmb2N1c1xuICAgIHdpbmRvdy5mcmVlZG9tLmxpdmUoJ1tkYXRhLXNoaXBwaW5nLWlucHV0XScsICdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaGlwcGluZ19faW5wdXQtZXJyJykuY2xhc3NMaXN0LmFkZCgnaGlkZScpO1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNoaXBwaW5nX19pbnB1dC1lbXB0eScpLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaGlwcGluZ19faW5wdXQtZmFpbC1lcnInKS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG4gICAgICBvbmZvY3VzKCk7XG4gICAgfSk7XG4gIH07XG5cbiAgLy8gSW5pdGlhbGl6ZSBhcHBsaWNhdGlvblxuICB0cnkge1xuICAgIHNldExpc3RlbmVycygpO1xuICAgIGFwcGx5SW5wdXRNYWtzKCk7XG4gICAgd2luZG93LmZyZWVkb20ubnNQdWJTdWIuc3ViKCdTaGlwcGluZy5yZXN0YXJ0JywgdmFsaWRhdGVDb29raWUpO1xuICAgIHdpbmRvdy5mcmVlZG9tLm5zUHViU3ViLnN1YigndXBkYXRlLmhhc1BlcnNvbmEuc3RhdGUnLCB1cGRhdGVIYXNQZXJzb25hU3RhdGUpO1xuXG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0VSUk9SIHwgU2hpcHBpbmcgJyArIGVycik7XG4gIH1cbn0oKSk7XG4iXX0=
