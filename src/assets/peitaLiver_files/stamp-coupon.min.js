"use strict";!function(e){var t=e.freedom,o=window.freedom.nsPubSub||{},r=function(){try{var e=document.querySelector(".buy-button-now");return(e=e&&e.getAttribute("data-seller"))?+e:(e=document.querySelector("[product-data-seller]"),e=e&&e.getAttribute("product-data-seller"),e?+e:0)}catch(t){return console.error("call-to-action.getSeller",t),0}},a=function(){return t&&t.nsStorage&&t.nsStorage.get?t.nsStorage.get("cp_sku")||void 0:void 0},n=function(e,o,r){t&&t.nsStorage&&t.nsStorage.set&&t.nsStorage.set(e,o,r)},u=function(){var e=document.querySelector("#buy-button-now"),o=document.querySelector("#stamp-coupon");if(o&&e){t.addClass(o,"loaded");var n,u=JSON.parse(sessionStorage.getItem("cp_sku"))||[],s=a(),c=r().toString(),l=o.querySelectorAll(".text__stamp_coupon p"),d=o.querySelector("span.link-coupon-sku"),i=o.querySelector(".stamp-coupon-readMore"),p=o.getAttribute("data-template"),m=o.getAttribute("data-discount"),g=e.getAttribute("data-sku"),S=g.split("-");if(S.length&&(S[0]&&(n=S[0]),S[1]&&(n+="-"+S[1]),S[2]&&(n+="-"+S[2])),"1"===p&&sessionStorage.removeItem("stamp-coupon-template"),s&&g&&s.find(function(e){return e.skuFather===n&&e.sellerId===c})){t.addClass(o,"coupon-actived");for(var v=0,f=l.length;v<f;v++)l[v].innerHTML="2"===sessionStorage.getItem("stamp-coupon-template")?"Parabéns! Seu desconto foi ativado e será aplicado no carrinho":m+" de desconto aplicado";i&&i.remove(),d&&d.remove()}var k={sku:g,skuFather:n,sellerId:c};u=u.filter(function(e){return e.sku!==g}),u.push(k),sessionStorage.setItem("cp_sku",JSON.stringify(u))}},s=function(){var e=document.querySelector("#buy-button-now"),o=document.querySelector("#stamp-coupon");if(o&&e){t.addClass(o,"coupon-actived");var r,u=e.getAttribute("data-seller"),s=a(),c=o.querySelectorAll(".text__stamp_coupon p"),l=o.querySelector("span.link-coupon-sku"),d=o.querySelector(".stamp-coupon-readMore"),i=o.getAttribute("data-discount"),p=e.getAttribute("data-sku"),m=p.split("-");m.length&&(m[0]&&(r=m[0]),m[1]&&(r+="-"+m[1]),m[2]&&(r+="-"+m[2]));var g={sku:p,skuFather:r,sellerId:u};s||(s=[]);var S=s.find(function(e){return e.skuFather===g.skuFather});if(!S){s.push(g),n("cp_sku",s,1880),d&&d.remove(),l&&l.remove();for(var v=0,f=c.length;v<f;v++)c[v].innerHTML="2"===sessionStorage.getItem("stamp-coupon-template")?"Parabéns! Seu desconto foi ativado e será aplicado no carrinho":i+" de desconto aplicado";window.WansTools&&(window.WansTools.trackEvent("Produto","clique","aplicar_cupom_clicavel",1),window.WansTools.ecProduct("add"))}}},c=function(e){e.preventDefault(),o.pub("modal.toggle","stamp-coupon-modal",!0)};t.addEvent("load",e,u),t.live(".couponSku-readMore","click",c),t.live(".addCoupon-sku","click",s),t.live(".stamp-coupon-modal-close","click",function(){o.pub("modal.toggle","stamp-coupon-modal",!1)})}(window);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl9yZWZhY3RvcmluZy9fY29tcG9uZW50cy9wcm9kdWN0L3N0YW1wLWNvdXBvbi0yL2Rlc2t0b3Avc3RhbXAtY291cG9uLm1pbi5qcyJdLCJuYW1lcyI6WyJ3aW4iLCJmcmVlZG9tIiwiUFVCU1VCIiwid2luZG93IiwibnNQdWJTdWIiLCJnZXRTZWxsZXIiLCJzZWxsZXIiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJnZXRBdHRyaWJ1dGUiLCJlcnJvciIsImNvbnNvbGUiLCJnZXRTa3VzIiwibnNTdG9yYWdlIiwiZ2V0IiwidW5kZWZpbmVkIiwic2V0TG9jYWxTdG9yYWdlIiwibmFtZSIsImRhdGEiLCJ0aW1lIiwic2V0IiwidmVyaWZ5Q291cG9uQ2hlY2tlZCIsImVsZW1lbnQiLCJzdGFtcFBkcCIsImFkZENsYXNzIiwic2t1RmF0aGVyIiwic2t1c1Nlc3Npb24iLCJKU09OIiwicGFyc2UiLCJzZXNzaW9uU3RvcmFnZSIsImdldEl0ZW0iLCJza3VzIiwic2VsbGVySWQiLCJ0b1N0cmluZyIsInRleHRDb3Vwb25QZHAiLCJxdWVyeVNlbGVjdG9yQWxsIiwibGlua0NvdXBvblBkcCIsImljb25JbmZvIiwidGVtcGxhdGUiLCJkaXNjb3VudCIsInNrdSIsInNrdUZhdGhlckZ1bGwiLCJzcGxpdCIsImxlbmd0aCIsInJlbW92ZUl0ZW0iLCJmaW5kIiwicHJvZHVjdCIsImluZGV4IiwiaW5uZXJIVE1MIiwicmVtb3ZlIiwiZmlsdGVyIiwiaXRlbSIsInB1c2giLCJzZXRJdGVtIiwic3RyaW5naWZ5IiwiYWRkQ291cG9uVG9JdGVtIiwidmVyaWZ5Q291cG9uIiwiZSIsIldhbnNUb29scyIsInRyYWNrRXZlbnQiLCJlY1Byb2R1Y3QiLCJvcGVuUmVhZE1vcmUiLCJldmVudCIsInByZXZlbnREZWZhdWx0IiwicHViIiwiYWRkRXZlbnQiLCJsaXZlIl0sIm1hcHBpbmdzIjoiQUFBQSxjQUNDLFNBQVVBLEdBQ1QsR0FBSUMsR0FBVUQsRUFBSUMsUUFDZEMsRUFB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Z0IsRUFBYyxJQUcvQkEsRUFBYyxLQUNoQmhCLEdBQWEsSUFBTWdCLEVBQWMsSUFJckMsSUFBSUssSUFBWU4sSUFBS0EsRUFBS2YsVUFBV0EsRUFBV08sU0FBVUEsRUFFckRELEtBQ0hBLEtBR0YsSUFBSXlCLEdBQWV6QixFQUFLYyxLQUFLLFNBQVNZLEdBQUssTUFBT0EsR0FBRWhDLFlBQWNxQixFQUFRckIsV0FFMUUsS0FBSStCLEVBQWMsQ0FDaEJ6QixFQUFLcUIsS0FBS04sR0FDVjlCLEVBQWdCLFNBQVVlLEVBQU0sTUFDNUJNLEdBQVVBLEVBQVNZLFNBQ25CYixHQUFlQSxFQUFjYSxRQUdqQyxLQURBLEdBQUlGLEdBQVEsRUFBR0osRUFBU1QsRUFBY1MsT0FDOUJJLEVBQVFKLEVBQVFJLElBQ3RCYixFQUFjYSxHQUFPQyxVQUFnRSxNQUFwRG5CLGVBQWVDLFFBQVEseUJBQW1DLGlFQUFtRVMsRUFBVyx1QkFHdktwQyxRQUFPdUQsWUFDVHZELE9BQU91RCxVQUFVQyxXQUFXLFVBQVcsU0FBVSx5QkFBMEIsR0FDM0V4RCxPQUFPdUQsVUFBVUUsVUFBVSxXQU0vQkMsRUFBZSxTQUFVQyxHQUMzQkEsRUFBTUMsaUJBQ043RCxFQUFPOEQsSUFBSSxlQUFnQixzQkFBc0IsR0FHbkQvRCxHQUFRZ0UsU0FBUyxPQUFRakUsRUFBS3FCLEdBRTlCcEIsRUFBUWlFLEtBQUssc0JBQXVCLFFBQVNMLEdBQzdDNUQsRUFBUWlFLEtBQUssaUJBQWtCLFFBQVNYLEdBRXhDdEQsRUFBUWlFLEtBQUssNEJBQTZCLFFBQVMsV0FDakRoRSxFQUFPOEQsSUFBSSxlQUFnQixzQkFBc0IsTUFHbEQ3RCIsImZpbGUiOiJfcmVmYWN0b3JpbmcvX2NvbXBvbmVudHMvcHJvZHVjdC9zdGFtcC1jb3Vwb24tMi9kZXNrdG9wL3N0YW1wLWNvdXBvbi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG4oKGZ1bmN0aW9uKHdpbikge1xuICB2YXIgZnJlZWRvbSA9IHdpbi5mcmVlZG9tO1xuICB2YXIgUFVCU1VCID0gd2luZG93LmZyZWVkb20ubnNQdWJTdWIgfHwge307XG5cbiAgdmFyIGdldFNlbGxlciA9IGZ1bmN0aW9uKCkge1xuICAgIHRyeSB7XG4gICAgICAvL2hhcyBzZWxsZXIgb24gdGhlIGJ1dHRvblxuICAgICAgdmFyIHNlbGxlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5idXktYnV0dG9uLW5vdycpO1xuICAgICAgc2VsbGVyID0gc2VsbGVyICYmIHNlbGxlci5nZXRBdHRyaWJ1dGUoJ2RhdGEtc2VsbGVyJyk7XG4gICAgICBpZihzZWxsZXIpIHJldHVybiArc2VsbGVyO1xuXG4gICAgICAvL2lmIGhhcyBubyBzZWxsZXIgb24gdGhlIGJ1dHRvblxuICAgICAgc2VsbGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW3Byb2R1Y3QtZGF0YS1zZWxsZXJdJyk7XG4gICAgICBzZWxsZXIgPSBzZWxsZXIgJiYgc2VsbGVyLmdldEF0dHJpYnV0ZSgncHJvZHVjdC1kYXRhLXNlbGxlcicpO1xuICAgICAgaWYoc2VsbGVyKSByZXR1cm4gK3NlbGxlcjtcblxuICAgICAgLy9kZWZhdWx0XG4gICAgICByZXR1cm4gMDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignY2FsbC10by1hY3Rpb24uZ2V0U2VsbGVyJywgZXJyb3IpO1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICB9O1xuXG4gIHZhciBnZXRTa3VzID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIGZyZWVkb20gJiYgZnJlZWRvbS5uc1N0b3JhZ2UgJiYgZnJlZWRvbS5uc1N0b3JhZ2UuZ2V0ID8gKGZyZWVkb20ubnNTdG9yYWdlLmdldCgnY3Bfc2t1JykgfHwgdW5kZWZpbmVkKSA6IHVuZGVmaW5lZDtcbiAgfTtcblxuICB2YXIgc2V0TG9jYWxTdG9yYWdlID0gZnVuY3Rpb24obmFtZSwgZGF0YSwgdGltZSkge1xuICAgIGlmIChmcmVlZG9tICYmIGZyZWVkb20ubnNTdG9yYWdlICYmIGZyZWVkb20ubnNTdG9yYWdlLnNldCkge1xuICAgICAgZnJlZWRvbS5uc1N0b3JhZ2Uuc2V0KG5hbWUsIGRhdGEsIHRpbWUpO1xuICAgIH1cbiAgfTtcblxuICB2YXIgdmVyaWZ5Q291cG9uQ2hlY2tlZCA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBlbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2J1eS1idXR0b24tbm93JyksXG4gICAgICBzdGFtcFBkcCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNzdGFtcC1jb3Vwb24nKTtcbiAgICBpZiAoc3RhbXBQZHAgJiYgZWxlbWVudCkge1xuICAgICAgZnJlZWRvbS5hZGRDbGFzcyhzdGFtcFBkcCwgJ2xvYWRlZCcpO1xuXG4gICAgICB2YXIgc2t1c1Nlc3Npb24gPSBKU09OLnBhcnNlKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ2NwX3NrdScpKSB8fCBbXSxcbiAgICAgICAgc2t1cyA9IGdldFNrdXMoKSxcbiAgICAgICAgc2VsbGVySWQgPSBnZXRTZWxsZXIoKS50b1N0cmluZygpLFxuXG4gICAgICAgIHRleHRDb3Vwb25QZHAgPSBzdGFtcFBkcC5xdWVyeVNlbGVjdG9yQWxsKCcudGV4dF9fc3RhbXBfY291cG9uIHAnKSxcbiAgICAgICAgbGlua0NvdXBvblBkcCA9IHN0YW1wUGRwLnF1ZXJ5U2VsZWN0b3IoJ3NwYW4ubGluay1jb3Vwb24tc2t1JyksXG4gICAgICAgIGljb25JbmZvID0gc3RhbXBQZHAucXVlcnlTZWxlY3RvcignLnN0YW1wLWNvdXBvbi1yZWFkTW9yZScpLFxuXG4gICAgICAgIHRlbXBsYXRlID0gc3RhbXBQZHAuZ2V0QXR0cmlidXRlKCdkYXRhLXRlbXBsYXRlJyksXG4gICAgICAgIGRpc2NvdW50ID0gc3RhbXBQZHAuZ2V0QXR0cmlidXRlKCdkYXRhLWRpc2NvdW50JyksXG5cbiAgICAgICAgc2t1ID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEtc2t1JyksXG4gICAgICAgIHNrdUZhdGhlckZ1bGwgPSBza3Uuc3BsaXQoJy0nKSxcbiAgICAgICAgc2t1RmF0aGVyO1xuXG4gICAgICBpZiAoc2t1RmF0aGVyRnVsbC5sZW5ndGgpIHtcbiAgICAgICAgaWYgKHNrdUZhdGhlckZ1bGxbMF0pIHtcbiAgICAgICAgICBza3VGYXRoZXIgPSBza3VGYXRoZXJGdWxsWzBdO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHNrdUZhdGhlckZ1bGxbMV0pIHtcbiAgICAgICAgICBza3VGYXRoZXIgKz0gJy0nICsgc2t1RmF0aGVyRnVsbFsxXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChza3VGYXRoZXJGdWxsWzJdKSB7XG4gICAgICAgICAgc2t1RmF0aGVyICs9ICctJyArIHNrdUZhdGhlckZ1bGxbMl07XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKHRlbXBsYXRlID09PSAnMScpIHtcbiAgICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgnc3RhbXAtY291cG9uLXRlbXBsYXRlJyk7XG4gICAgICB9XG5cbiAgICAgIGlmKHNrdXMgJiYgc2t1ICYmIHNrdXMuZmluZChmdW5jdGlvbihwcm9kdWN0KSB7IHJldHVybiBwcm9kdWN0LnNrdUZhdGhlciA9PT0gc2t1RmF0aGVyICYmIHByb2R1Y3Quc2VsbGVySWQgPT09IHNlbGxlcklkOyB9KSkge1xuICAgICAgICBmcmVlZG9tLmFkZENsYXNzKHN0YW1wUGRwLCAnY291cG9uLWFjdGl2ZWQnKTtcblxuICAgICAgICB2YXIgaW5kZXggPSAwLCBsZW5ndGggPSB0ZXh0Q291cG9uUGRwLmxlbmd0aDtcbiAgICAgICAgZm9yICggOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgICAgIHRleHRDb3Vwb25QZHBbaW5kZXhdLmlubmVySFRNTCA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ3N0YW1wLWNvdXBvbi10ZW1wbGF0ZScpID09PSAnMicgPyAnUGFyYWLDqW5zISBTZXUgZGVzY29udG8gZm9pIGF0aXZhZG8gZSBzZXLDoSBhcGxpY2FkbyBubyBjYXJyaW5obycgOiBkaXNjb3VudCArICcgZGUgZGVzY29udG8gYXBsaWNhZG8nO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGljb25JbmZvKSBpY29uSW5mby5yZW1vdmUoKTtcbiAgICAgICAgaWYgKGxpbmtDb3Vwb25QZHApIGxpbmtDb3Vwb25QZHAucmVtb3ZlKCk7XG4gICAgICB9XG5cbiAgICAgIHZhciBwcm9kdWN0ID0geyBza3U6IHNrdSwgc2t1RmF0aGVyOiBza3VGYXRoZXIsIHNlbGxlcklkOiBzZWxsZXJJZCB9O1xuICAgICAgc2t1c1Nlc3Npb24gPSBza3VzU2Vzc2lvbi5maWx0ZXIoZnVuY3Rpb24oaXRlbSkgeyByZXR1cm4gaXRlbS5za3UgIT09IHNrdTsgfSk7XG4gICAgICBza3VzU2Vzc2lvbi5wdXNoKHByb2R1Y3QpO1xuICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgnY3Bfc2t1JywgSlNPTi5zdHJpbmdpZnkoc2t1c1Nlc3Npb24pKTtcbiAgICB9XG4gIH07XG5cbiAgdmFyIGFkZENvdXBvblRvSXRlbSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBlbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2J1eS1idXR0b24tbm93JyksXG4gICAgICBzdGFtcFBkcCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNzdGFtcC1jb3Vwb24nKTtcbiAgICBpZiAoc3RhbXBQZHAgJiYgZWxlbWVudCkge1xuXG4gICAgICBmcmVlZG9tLmFkZENsYXNzKHN0YW1wUGRwLCAnY291cG9uLWFjdGl2ZWQnKTtcblxuICAgICAgdmFyIHNlbGxlcklkID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEtc2VsbGVyJyksXG4gICAgICAgIHNrdXMgPSBnZXRTa3VzKCksXG5cbiAgICAgICAgdGV4dENvdXBvblBkcCA9IHN0YW1wUGRwLnF1ZXJ5U2VsZWN0b3JBbGwoJy50ZXh0X19zdGFtcF9jb3Vwb24gcCcpLFxuICAgICAgICBsaW5rQ291cG9uUGRwID0gc3RhbXBQZHAucXVlcnlTZWxlY3Rvcignc3Bhbi5saW5rLWNvdXBvbi1za3UnKSxcbiAgICAgICAgaWNvbkluZm8gPSBzdGFtcFBkcC5xdWVyeVNlbGVjdG9yKCcuc3RhbXAtY291cG9uLXJlYWRNb3JlJyksXG5cbiAgICAgICAgZGlzY291bnQgPSBzdGFtcFBkcC5nZXRBdHRyaWJ1dGUoJ2RhdGEtZGlzY291bnQnKSxcbiAgICAgICAgLy8gdGVtcGxhdGUgPSBzdGFtcFBkcC5nZXRBdHRyaWJ1dGUoJ2RhdGEtdGVtcGxhdGUnKSxcblxuICAgICAgICBza3UgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1za3UnKSxcbiAgICAgICAgc2t1RmF0aGVyRnVsbCA9IHNrdS5zcGxpdCgnLScpLFxuICAgICAgICBza3VGYXRoZXI7XG5cbiAgICAgIGlmIChza3VGYXRoZXJGdWxsLmxlbmd0aCkge1xuICAgICAgICBpZiAoc2t1RmF0aGVyRnVsbFswXSkge1xuICAgICAgICAgIHNrdUZhdGhlciA9IHNrdUZhdGhlckZ1bGxbMF07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoc2t1RmF0aGVyRnVsbFsxXSkge1xuICAgICAgICAgIHNrdUZhdGhlciArPSAnLScgKyBza3VGYXRoZXJGdWxsWzFdO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHNrdUZhdGhlckZ1bGxbMl0pIHtcbiAgICAgICAgICBza3VGYXRoZXIgKz0gJy0nICsgc2t1RmF0aGVyRnVsbFsyXTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB2YXIgcHJvZHVjdCA9IHsgc2t1OiBza3UsIHNrdUZhdGhlcjogc2t1RmF0aGVyLCBzZWxsZXJJZDogc2VsbGVySWQgfTtcblxuICAgICAgaWYgKCFza3VzKSB7XG4gICAgICAgIHNrdXMgPSBbXTtcbiAgICAgIH1cblxuICAgICAgdmFyIHZlcmlmeUNvdXBvbiA9IHNrdXMuZmluZChmdW5jdGlvbihlKSB7IHJldHVybiBlLnNrdUZhdGhlciA9PT0gcHJvZHVjdC5za3VGYXRoZXI7IH0pO1xuXG4gICAgICBpZighdmVyaWZ5Q291cG9uKSB7XG4gICAgICAgIHNrdXMucHVzaChwcm9kdWN0KTtcbiAgICAgICAgc2V0TG9jYWxTdG9yYWdlKCdjcF9za3UnLCBza3VzLCAxODgwKTtcbiAgICAgICAgaWYgKGljb25JbmZvKSBpY29uSW5mby5yZW1vdmUoKTtcbiAgICAgICAgaWYgKGxpbmtDb3Vwb25QZHApIGxpbmtDb3Vwb25QZHAucmVtb3ZlKCk7XG4gICAgICAgIFxuICAgICAgICB2YXIgaW5kZXggPSAwLCBsZW5ndGggPSB0ZXh0Q291cG9uUGRwLmxlbmd0aDtcbiAgICAgICAgZm9yICggOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgICAgIHRleHRDb3Vwb25QZHBbaW5kZXhdLmlubmVySFRNTCA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ3N0YW1wLWNvdXBvbi10ZW1wbGF0ZScpID09PSAnMicgPyAnUGFyYWLDqW5zISBTZXUgZGVzY29udG8gZm9pIGF0aXZhZG8gZSBzZXLDoSBhcGxpY2FkbyBubyBjYXJyaW5obycgOiBkaXNjb3VudCArICcgZGUgZGVzY29udG8gYXBsaWNhZG8nO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHdpbmRvdy5XYW5zVG9vbHMpIHtcbiAgICAgICAgICB3aW5kb3cuV2Fuc1Rvb2xzLnRyYWNrRXZlbnQoJ1Byb2R1dG8nLCAnY2xpcXVlJywgJ2FwbGljYXJfY3Vwb21fY2xpY2F2ZWwnLCAxKTtcbiAgICAgICAgICB3aW5kb3cuV2Fuc1Rvb2xzLmVjUHJvZHVjdCgnYWRkJyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgdmFyIG9wZW5SZWFkTW9yZSA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgUFVCU1VCLnB1YignbW9kYWwudG9nZ2xlJywgJ3N0YW1wLWNvdXBvbi1tb2RhbCcsIHRydWUpO1xuICB9O1xuXG4gIGZyZWVkb20uYWRkRXZlbnQoJ2xvYWQnLCB3aW4sIHZlcmlmeUNvdXBvbkNoZWNrZWQpO1xuXG4gIGZyZWVkb20ubGl2ZSgnLmNvdXBvblNrdS1yZWFkTW9yZScsICdjbGljaycsIG9wZW5SZWFkTW9yZSk7XG4gIGZyZWVkb20ubGl2ZSgnLmFkZENvdXBvbi1za3UnLCAnY2xpY2snLCBhZGRDb3Vwb25Ub0l0ZW0pO1xuXG4gIGZyZWVkb20ubGl2ZSgnLnN0YW1wLWNvdXBvbi1tb2RhbC1jbG9zZScsICdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgIFBVQlNVQi5wdWIoJ21vZGFsLnRvZ2dsZScsICdzdGFtcC1jb3Vwb24tbW9kYWwnLCBmYWxzZSk7XG4gIH0pO1xuXG59KSh3aW5kb3cpKTtcbiJdfQ==
